<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì‹¤ ì–´íœ˜ í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }
        /* ë²„íŠ¼ ë¹„í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        .option-btn:disabled {
            opacity: 0.7;
        }
        /* ì •ë‹µ ë²„íŠ¼ */
        .option-btn.correct {
            background-color: #22c55e; /* green-500 */
            color: white;
            transform: scale(1.05);
            border-color: #16a34a; /* green-600 */
        }
        /* ì˜¤ë‹µ ë²„íŠ¼ */
        .option-btn.wrong {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: #dc2626; /* red-600 */
        }
        /* ì„ íƒë˜ì§€ ì•Šì€ ë²„íŠ¼ (ì •ë‹µ ê³µê°œ í›„) */
        .option-btn.faded {
            background-color: #f3f4f6; /* gray-100 */
            color: #9ca3af; /* gray-400 */
        }
        /* ë¹ˆì¹¸ì„ ëˆˆì— ë„ê²Œ í‘œì‹œ */
        #quiz-question .blank {
            color: #3b82f6; /* blue-500 */
            font-weight: 700;
            display: inline-block;
            width: 150px; /* ë¹ˆì¹¸ì˜ ë„ˆë¹„ */
            border-bottom: 3px solid #3b82f6;
            margin: 0 8px;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col justify-between items-center p-8">

    <!-- 1. ì„ íƒì§€ (ìƒë‹¨) -->
    <div id="quiz-options-container" class="w-full flex flex-wrap justify-center gap-4 mb-6">
        <!-- ì„ íƒì§€ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>

    <!-- 2. í€´ì¦ˆ ë©”ì¸ ì½˜í…ì¸  (ì¤‘ì•™) -->
    <div id="quiz-main-content" class="flex-grow flex flex-col justify-center items-center w-full max-w-5xl text-center">
        <p id="quiz-category" class="text-3xl font-bold text-blue-600 mb-4"></p>
        <p id="quiz-question-number" class="text-xl text-gray-500 mb-6"></p>
        
        <!-- ì§ˆë¬¸ (ë¹ˆì¹¸ ì±„ìš°ê¸° ë˜ëŠ” ì •ì˜) -->
        <h2 id="quiz-question" class="text-5xl font-bold text-gray-800 my-8 leading-relaxed">
            <!-- í€´ì¦ˆ ì§ˆë¬¸ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </h2>

        <!-- í”¼ë“œë°± (ì¤‘ì•™ í•˜ë‹¨) -->
        <div id="feedback-container" class="mt-8 h-32">
            <p id="quiz-feedback-message" class="text-4xl font-bold"></p>
            <p id="quiz-correct-answer" class="text-3xl text-gray-700 mt-4 hidden"></p>
        </div>
    </div>

    <!-- 3. ë„¤ë¹„ê²Œì´ì…˜ (í•˜ë‹¨) -->
    <div id="navigation-container" class="w-full flex justify-between items-center">
        <!-- ì¹´í…Œê³ ë¦¬ ë°”ë¡œê°€ê¸° ë²„íŠ¼ (ì™¼ìª½/ì¤‘ì•™ ì •ë ¬) -->
        <div id="category-jump-container" class="flex-grow flex flex-col justify-center gap-2">
            <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ (2ì¤„ë¡œ) -->
        </div>

        <!-- ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì •ë ¬) -->
        <div class="flex-shrink-0">
            <button id="next-question-btn" class="px-8 py-4 text-2xl font-bold bg-blue-500 text-white rounded-lg shadow-lg hover:bg-blue-600 transition-colors hidden">
                ë‹¤ìŒ ë¬¸ì œ â†’
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // 1. í€´ì¦ˆ ë°ì´í„° ì •ì˜ (ì¹´í…Œê³ ë¦¬ë³„ ìˆœì„œ ê³ ì • + ì‰¬ìš´ í‘œí˜„)
            const allQuizData = [
                {
                    category: "ìƒí™œ ì‹œì„¤ ë¬¸ì œ",
                    quizzes: [
                        { korean: "ìˆ˜ë—ë¬¼ì´ ì•ˆ ë‚˜ì˜¤ë‹¤", type: "definition", question: "ë¬¼ ì•ˆ ë‚˜ì™€ìš”." },
                        { korean: "ìˆ˜ë—ë¬¼ì´ ì•ˆ ë‚˜ì˜¤ë‹¤", type: "fill-in-the-blank", question: "ìƒ¤ì›Œë¥¼ í•˜ë ¤ëŠ”ë° ê°‘ìê¸° [ ](ì´)ê°€ ì•ˆ ë‚˜ì™”ì–´ìš”." },
                        { korean: "ì „ê¸°ê°€ ë‚˜ê°€ë‹¤", type: "definition", question: "ë¶ˆ êº¼ì¡Œì–´ìš”. (ì „ê¸° ì•ˆ ë“¤ì–´ì™€ìš”)" },
                        { korean: "ì „ê¸°ê°€ ë‚˜ê°€ë‹¤", type: "fill-in-the-blank", question: "ì–´ì ¯ë°¤ì— [ ](ì´)ê°€ ë‚˜ê°€ì„œ í…”ë ˆë¹„ì „ì´ êº¼ì¡Œì–´ìš”." },
                        { korean: "ë³€ê¸°ê°€ ë§‰íˆë‹¤", type: "definition", question: "í™”ì¥ì‹¤ ë³€ê¸° ë§‰í˜”ì–´ìš”." },
                        { korean: "ë³€ê¸°ê°€ ë§‰íˆë‹¤", type: "fill-in-the-blank", question: "í™”ì¥ì‹¤ [ ](ì´)ê°€ ë§‰í˜€ì„œ ë¬¼ì´ ì•ˆ ë‚´ë ¤ê°€ìš”." },
                        { korean: "ë¬¼ì´ ìƒˆë‹¤", type: "definition", question: "ì²œì¥ì´ë‚˜ ë²½ì—ì„œ ë¬¼ì´ ë–¨ì–´ì ¸ìš”." },
                        { korean: "ë¬¼ì´ ìƒˆë‹¤", type: "fill-in-the-blank", question: "ë¹„ê°€ ì˜¤ë©´ ì²œì¥ì—ì„œ [ ](ì´)ê°€ ìƒˆìš”." },
                        { korean: "ì†ŒìŒì´ ì‹¬í•˜ë‹¤", type: "definition", question: "ë„ˆë¬´ ì‹œë„ëŸ¬ì›Œìš”." },
                        { korean: "ì†ŒìŒì´ ì‹¬í•˜ë‹¤", type: "fill-in-the-blank", question: "ìœ—ì§‘ ê³µì‚¬ ë•Œë¬¸ì— [ ](ì´)ê°€ ì‹¬í•´ì„œ ê³µë¶€ì— ì§‘ì¤‘ì´ ì•ˆ ë¼ìš”." },
                        { korean: "ë‚œë°©ì´ ì•ˆ ë˜ë‹¤", type: "definition", question: "ë°©ì´ ì¶”ì›Œìš”. (ë³´ì¼ëŸ¬ ì•ˆ ë¼ìš”)" },
                        { korean: "ë‚œë°©ì´ ì•ˆ ë˜ë‹¤", type: "fill-in-the-blank", question: "ê²¨ìš¸ì— [ ](ì´)ê°€ ì•ˆ ë¼ì„œ ë„ˆë¬´ ì¶”ì›Œìš”." },
                        { korean: "ì´ìƒí•œ ëƒ„ìƒˆê°€ ë‚˜ë‹¤", type: "definition", question: "ëƒ„ìƒˆê°€ ì´ìƒí•´ìš”." },
                        { korean: "ì´ìƒí•œ ëƒ„ìƒˆê°€ ë‚˜ë‹¤", type: "fill-in-the-blank", question: "ëƒ‰ì¥ê³ ì—ì„œ [ ](ì´)ê°€ ë‚˜ìš”." },
                        { korean: "ë¬¼ì´ ì•ˆ ë‚´ë ¤ê°€ë‹¤", type: "definition", question: "ì‹±í¬ëŒ€ë‚˜ í™”ì¥ì‹¤ì— ë¬¼ì´ ì•ˆ ë¹ ì ¸ìš”." },
                        { korean: "ë¬¼ì´ ì•ˆ ë‚´ë ¤ê°€ë‹¤", type: "fill-in-the-blank", question: "ì„¤ê±°ì§€ë¥¼ í•˜ëŠ”ë° ì‹±í¬ëŒ€ì— [ ](ì´)ê°€ ì•ˆ ë‚´ë ¤ê°€ìš”." }
                    ]
                },
                {
                    category: "ê³„ì•½ ë° ìš”ê¸ˆ",
                    quizzes: [
                        { korean: "ê³„ì•½ì„œ", type: "definition", question: "ì§‘ì´ë‚˜ ë¬¼ê±´ì„ ë¹Œë¦´ ë•Œ ì“°ëŠ” ì„œë¥˜." },
                        { korean: "ê³„ì•½ì„œ", type: "fill-in-the-blank", question: "ì§‘ì„ ê³„ì•½í•  ë•Œ [ ](ì„)ë¥¼ ê¼¼ê¼¼íˆ ì½ì–´ë´ì•¼ í•´ìš”." },
                        { korean: "ê³„ì•½ ê¸°ê°„", type: "definition", question: "ì§‘ì„ ë¹Œë¦¬ê¸°ë¡œ í•œ ì‹œê°„ (ì˜ˆ: 2ë…„)." },
                        { korean: "ê³„ì•½ ê¸°ê°„", type: "fill-in-the-blank", question: "ì´ ì§‘ì˜ [ ](ì€)ëŠ” 2ë…„ì…ë‹ˆë‹¤." },
                        { korean: "ê³„ì•½í•˜ë‹¤", type: "definition", question: "ì§‘ì„ ë¹Œë¦¬ê¸°ë¡œ ì•½ì†í•˜ëŠ” ê²ƒ." },
                        { korean: "ê³„ì•½í•˜ë‹¤", type: "fill-in-the-blank", question: "ë§ˆìŒì— ë“œëŠ” ì§‘ì´ ìˆì–´ì„œ ì˜¤ëŠ˜ [ ](ì„)ë¥¼ í–ˆì–´ìš”." },
                        { korean: "ë³´ì¦ê¸ˆ", type: "definition", question: "ì§‘ ë¹Œë¦´ ë•Œ ë¯¸ë¦¬ ë§¡ê¸°ëŠ” í°ëˆ." },
                        { korean: "ë³´ì¦ê¸ˆ", type: "fill-in-the-blank", question: "ì›”ì„¸ë°©ì„ ì–»ìœ¼ë ¤ë©´ [ ](ì´)ê°€ í•„ìš”í•´ìš”." },
                        { korean: "ê³µê³¼ê¸ˆ", type: "definition", question: "ì „ê¸°, ìˆ˜ë„ ìš”ê¸ˆ ë“±ì„ í•©ì³ì„œ ë¶€ë¥´ëŠ” ë§." },
                        { korean: "ê³µê³¼ê¸ˆ", type: "fill-in-the-blank", question: "ì´ë²ˆ ë‹¬ [ ](ì´)ê°€ ë§ì´ ë‚˜ì™”ì–´ìš”." },
                        { korean: "ì—°ì²´ë£Œ", type: "definition", question: "ìš”ê¸ˆì„ ëŠ¦ê²Œ ëƒˆì„ ë•Œ ë” ë‚´ëŠ” ëˆ." },
                        { korean: "ì—°ì²´ë£Œ", type: "fill-in-the-blank", question: "ìš”ê¸ˆì„ ëŠ¦ê²Œ ë‚´ë©´ [ ](ì„)ë¥¼ ë‚´ì•¼ í•´ìš”." },
                        { korean: "í¬í•¨ë˜ë‹¤", type: "definition", question: "ì–´ë–¤ ê²ƒì— ê°™ì´ ë“¤ì–´ ìˆì–´ìš”." },
                        { korean: "í¬í•¨ë˜ë‹¤", type: "fill-in-the-blank", question: "ê´€ë¦¬ë¹„ì— ìˆ˜ë„ ìš”ê¸ˆì´ [ ](ì´)ê°€ ìˆì–´ìš”." },
                        { korean: "ë‚©ë¶€í•˜ë‹¤", type: "definition", question: "ìš”ê¸ˆì„ ë‚´ìš”." },
                        { korean: "ë‚©ë¶€í•˜ë‹¤", type: "fill-in-the-blank", question: "ì „ê¸° ìš”ê¸ˆì„ ì˜¤ëŠ˜ê¹Œì§€ [ ](ì„)ë¥¼ í•´ì•¼ í•´ìš”." },
                        { korean: "ë°€ë¦¬ë‹¤", type: "definition", question: "ìš”ê¸ˆì„ ì œë•Œ ëª» ëƒˆì–´ìš”." },
                        { korean: "ë°€ë¦¬ë‹¤", type: "fill-in-the-blank", question: "ì›”ì„¸ê°€ ë‘ ë‹¬ì´ë‚˜ [ ](ì´)ê°€ ìˆì–´ìš”." }
                    ]
                },
                {
                    category: "ì¬ì • ë° ì ˆì•½",
                    quizzes: [
                        { korean: "ì§€ì¶œ", type: "definition", question: "ëˆì„ ì¨ìš”." },
                        { korean: "ì§€ì¶œ", type: "fill-in-the-blank", question: "ì´ë²ˆ ë‹¬ì€ [ ](ì´)ê°€ ë„ˆë¬´ ë§ì•˜ì–´ìš”." },
                        { korean: "ìˆ˜ì…", type: "definition", question: "ëˆì„ ë²Œì–´ìš”." },
                        { korean: "ìˆ˜ì…", type: "fill-in-the-blank", question: "[ ](ì´)ê°€ ì§€ì¶œë³´ë‹¤ ì ìœ¼ë©´ ì•ˆ ë¼ìš”." },
                        { korean: "ëŠ˜ë‹¤", type: "definition", question: "ë§ì•„ì¡Œì–´ìš”." },
                        { korean: "ëŠ˜ë‹¤", type: "fill-in-the-blank", question: "ì›”ê¸‰ì´ [ ](ì´)ê°€ ë‚˜ì„œ ê¸°ë¶„ì´ ì¢‹ì•„ìš”." },
                        { korean: "ì¤„ë‹¤", type: "definition", question: "ì ì–´ì¡Œì–´ìš”." },
                        { korean: "ì¤„ë‹¤", type: "fill-in-the-blank", question: "ìš©ëˆì´ [ ](ì´)ê°€ ë“¤ì–´ì„œ ì•„ê»´ ì¨ì•¼ í•´ìš”." },
                        { korean: "ì•„ë¼ë‹¤", type: "definition", question: "ì†Œì¤‘í•˜ê²Œ ì‚¬ìš©í•´ìš”." },
                        { korean: "ì•„ë¼ë‹¤", type: "fill-in-the-blank", question: "ë¬¼ê±´ì„ [ ](ì´)ê°€ ì“°ëŠ” ìŠµê´€ì„ ë“¤ì—¬ì•¼ í•´ìš”." },
                        { korean: "ì ˆì•½í•˜ë‹¤", type: "definition", question: "ì•„ê»´ ì¨ìš”." },
                        { korean: "ì ˆì•½í•˜ë‹¤", type: "fill-in-the-blank", question: "ì „ê¸°ë¥¼ [ ](ì´)ê°€ í•˜ë©´ ìš”ê¸ˆì„ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”." },
                        { korean: "ë‚­ë¹„í•˜ë‹¤", type: "definition", question: "ëˆì´ë‚˜ ë¬¼ê±´ì„ í•¨ë¶€ë¡œ ë§‰ ì¨ìš”." },
                        { korean: "ë‚­ë¹„í•˜ë‹¤", type: "fill-in-the-blank", question: "í•„ìš” ì—†ëŠ” ë¬¼ê±´ì„ ì‚¬ì„œ ëˆì„ [ ](ì„)ë¥¼ í–ˆì–´ìš”." },
                        { korean: "ì €ì¶•í•˜ë‹¤", type: "definition", question: "ëˆì„ ëª¨ì•„ìš”." },
                        { korean: "ì €ì¶•í•˜ë‹¤", type: "fill-in-the-blank", question: "ë§¤ë‹¬ ì›”ê¸‰ì˜ ì¼ë¶€ë¥¼ [ ](ì„)ë¥¼ í•´ìš”." }
                    ]
                }
            ];

            // 2. DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const quizOptionsContainer = document.getElementById('quiz-options-container');
            const quizCategoryEl = document.getElementById('quiz-category');
            const quizQuestionNumberEl = document.getElementById('quiz-question-number');
            const quizQuestionEl = document.getElementById('quiz-question');
            const quizFeedbackMessageEl = document.getElementById('quiz-feedback-message');
            const quizCorrectAnswerEl = document.getElementById('quiz-correct-answer');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            const categoryJumpContainer = document.getElementById('category-jump-container'); // New

            // 3. í€´ì¦ˆ ìƒíƒœ ë³€ìˆ˜
            let allVocabularyWords = [];
            let quizList = [];
            let currentQuestionIndex = 0;
            let isAnswered = false;
            let categoryStartIndices = {}; // New: Will store {fill: index, def: index}

            // 4. í—¬í¼ í•¨ìˆ˜
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // ëª¨ë“  ê³ ìœ  ì–´íœ˜ ëª©ë¡ ìƒì„± (ì„ íƒì§€ìš©)
            function getAllWords() {
                const words = allQuizData.flatMap(category => 
                    category.quizzes.map(q => q.korean)
                );
                return [...new Set(words)]; // Setì„ ì‚¬ìš©í•´ ê³ ìœ í•œ ê°’ë§Œ ì¶”ì¶œ
            }

            // 5. í€´ì¦ˆ í•µì‹¬ ë¡œì§
            
            // í€´ì¦ˆ ì‹œì‘
            function startQuiz() {
                // *** ë³€ê²½ëœ í€´ì¦ˆ ìˆœì„œ ë¡œì§ ***
                let fillInBlankQuizzes = [];
                let definitionQuizzes = [];

                categoryStartIndices = {}; // Reset
                let fillInBlankIndex = 0; // Index counter for fill-in-the-blank quizzes
                let definitionIndex = 0; // Relative index counter for definition quizzes

                // 1. ì¹´í…Œê³ ë¦¬ë³„ë¡œ í€´ì¦ˆë¥¼ ë¶„ë¦¬í•˜ê³  ì„ìŒ
                allQuizData.forEach(categoryObj => {
                    const categoryName = categoryObj.category;
                    categoryStartIndices[categoryName] = {}; // Initialize object for category

                    // --- Fill in the Blank ---
                    let fillIns = categoryObj.quizzes.filter(q => q.type === 'fill-in-the-blank');
                    let shuffledFillIns = shuffleArray(fillIns);
                    
                    categoryStartIndices[categoryName].fill = fillInBlankIndex; // Store start index
                    fillInBlankQuizzes.push(...shuffledFillIns);
                    fillInBlankIndex += shuffledFillIns.length; // Increment for next category

                    // --- Definition ---
                    let defs = categoryObj.quizzes.filter(q => q.type === 'definition');
                    let shuffledDefs = shuffleArray(defs);

                    categoryStartIndices[categoryName].def = definitionIndex; // Store *relative* start index
                    definitionQuizzes.push(...shuffledDefs);
                    definitionIndex += shuffledDefs.length; // Increment for next category
                });

                // Now, offset all definition indices by the total number of fill-in-blanks
                const totalFillInBlanks = fillInBlankQuizzes.length;
                allQuizData.forEach(categoryObj => {
                    const categoryName = categoryObj.category;
                    categoryStartIndices[categoryName].def += totalFillInBlanks;
                });

                // 2. ë¹ˆì¹¸ ì±„ìš°ê¸° ë¬¸ì œ ë¨¼ì €, ê·¸ ë‹¤ìŒ ëœ» ë§ì¶”ê¸° ë¬¸ì œ
                quizList = [...fillInBlankQuizzes, ...definitionQuizzes];
                
                allVocabularyWords = getAllWords();
                currentQuestionIndex = 0;
                
                createCategoryButtons(); // New
                showQuestion(currentQuestionIndex);
            }

            // New function: ì¹´í…Œê³ ë¦¬ ë°”ë¡œê°€ê¸° ë²„íŠ¼ ìƒì„±
            function createCategoryButtons() {
                categoryJumpContainer.innerHTML = ''; // Clear container

                // Create Row 1: ë¹ˆì¹¸ ê³ ë¥´ê¸°
                const fillRow = document.createElement('div');
                fillRow.className = "flex-grow flex justify-center items-center gap-4";
                
                const fillLabel = document.createElement('span');
                fillLabel.className = "px-4 py-3 text-lg font-bold text-gray-600 w-20 text-right";
                fillLabel.textContent = "ë¹ˆì¹¸:";
                fillRow.appendChild(fillLabel);

                allQuizData.forEach(categoryObj => {
                    const categoryName = categoryObj.category;
                    const jumpIndex = categoryStartIndices[categoryName].fill;
                    
                    const buttonEl = document.createElement('button');
                    buttonEl.textContent = categoryName;
                    // Styling for category buttons
                    buttonEl.className = "category-btn px-6 py-3 text-lg font-semibold bg-white border-2 border-gray-300 rounded-lg shadow-md hover:bg-gray-100 hover:border-blue-400 transition-all duration-200";
                    buttonEl.dataset.category = categoryName; // Store category
                    buttonEl.dataset.type = 'fill-in-the-blank'; // Store type
                    
                    buttonEl.onclick = () => {
                        currentQuestionIndex = jumpIndex;
                        showQuestion(currentQuestionIndex);
                    };
                    fillRow.appendChild(buttonEl);
                });
                categoryJumpContainer.appendChild(fillRow);

                // Create Row 2: ëœ» ë§ì¶”ê¸°
                const defRow = document.createElement('div');
                defRow.className = "flex-grow flex justify-center items-center gap-4";

                const defLabel = document.createElement('span');
                defLabel.className = "px-4 py-3 text-lg font-bold text-gray-600 w-20 text-right";
                defLabel.textContent = "ëœ»:";
                defRow.appendChild(defLabel);

                allQuizData.forEach(categoryObj => {
                    const categoryName = categoryObj.category;
                    const jumpIndex = categoryStartIndices[categoryName].def;
                    
                    const buttonEl = document.createElement('button');
                    buttonEl.textContent = categoryName;
                    buttonEl.className = "category-btn px-6 py-3 text-lg font-semibold bg-white border-2 border-gray-300 rounded-lg shadow-md hover:bg-gray-100 hover:border-blue-400 transition-all duration-200";
                    buttonEl.dataset.category = categoryName; // Store category
                    buttonEl.dataset.type = 'definition'; // Store type
                    
                    buttonEl.onclick = () => {
                        currentQuestionIndex = jumpIndex;
                        showQuestion(currentQuestionIndex);
                    };
                    defRow.appendChild(buttonEl);
                });
                categoryJumpContainer.appendChild(defRow);
            }

            // ì§ˆë¬¸ í‘œì‹œ
            function showQuestion(index) {
                if (index >= quizList.length) {
                    showQuizComplete();
                    return;
                }

                isAnswered = false;
                const currentItem = quizList[index];
                const currentCategory = allQuizData.find(cat => 
                    cat.quizzes.some(q => q.korean === currentItem.korean)
                ).category;
                const currentType = currentItem.type; // Get the type

                // UI ì—…ë°ì´íŠ¸
                quizCategoryEl.textContent = `[${currentCategory}]`;
                quizQuestionNumberEl.textContent = `ë¬¸ì œ ${index + 1} / ${quizList.length}`;
                
                // ë¹ˆì¹¸ ì±„ìš°ê¸° ì§ˆë¬¸ í˜•ì‹ ë³€ê²½
                if (currentItem.type === 'fill-in-the-blank') {
                    quizQuestionEl.innerHTML = currentItem.question.replace(
                        /\[ \]/, 
                        '<span class="blank"></span>'
                    );
                } else {
                    quizQuestionEl.textContent = currentItem.question;
                }

                quizFeedbackMessageEl.textContent = '';
                quizCorrectAnswerEl.classList.add('hidden');
                nextQuestionBtn.classList.add('hidden');

                // ì„ íƒì§€ ìƒì„± (ì •ë‹µ 1 + ì˜¤ë‹µ 3)
                const correctAnswer = currentItem.korean;
                const distractors = [];
                while (distractors.length < 3) {
                    const randomWord = allVocabularyWords[Math.floor(Math.random() * allVocabularyWords.length)];
                    if (randomWord !== correctAnswer && !distractors.includes(randomWord)) {
                        distractors.push(randomWord);
                    }
                }

                const options = shuffleArray([correctAnswer, ...distractors]);
                
                // ì„ íƒì§€ ë²„íŠ¼ ë Œë”ë§ (ìƒë‹¨)
                quizOptionsContainer.innerHTML = '';
                options.forEach(option => {
                    const buttonEl = document.createElement('button');
                    buttonEl.textContent = option;
                    buttonEl.className = "option-btn px-6 py-4 text-2xl font-semibold bg-white border-2 border-gray-300 rounded-lg shadow-md hover:bg-gray-100 hover:border-blue-400 transition-all duration-200";
                    buttonEl.onclick = () => handleAnswer(option, correctAnswer);
                    quizOptionsContainer.appendChild(buttonEl);
                });

                // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í™œì„±/ë¹„í™œì„± ìŠ¤íƒ€ì¼
                Array.from(categoryJumpContainer.querySelectorAll('.category-btn')).forEach(btn => {
                    if (btn.dataset.category === currentCategory && btn.dataset.type === currentType) {
                        btn.classList.add('bg-blue-100', 'border-blue-400');
                    } else {
                        btn.classList.remove('bg-blue-100', 'border-blue-400');
                    }
                });
            }

            // ë‹µì•ˆ ì²˜ë¦¬
            function handleAnswer(selectedAnswer, correctAnswer) {
                if (isAnswered) return; // ì¤‘ë³µ í´ë¦­ ë°©ì§€
                isAnswered = true;

                const isCorrect = selectedAnswer === correctAnswer;

                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ë§ (ì •ë‹µ/ì˜¤ë‹µ/ë¹„í™œì„±)
                Array.from(quizOptionsContainer.children).forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    } else if (btn.textContent === selectedAnswer) {
                        btn.classList.add('wrong');
                    } else {
                        btn.classList.add('faded');
                    }
                });

                // í”¼ë“œë°± ë©”ì‹œì§€ í‘œì‹œ
                if (isCorrect) {
                    quizFeedbackMessageEl.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘';
                    quizFeedbackMessageEl.className = 'text-4xl font-bold text-green-600';
                } else {
                    quizFeedbackMessageEl.textContent = 'ì•„ì‰½ë„¤ìš”!';
                    quizFeedbackMessageEl.className = 'text-4xl font-bold text-red-600';
                    quizCorrectAnswerEl.textContent = `ì •ë‹µ: ${correctAnswer}`;
                    quizCorrectAnswerEl.classList.remove('hidden');
                }

                // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í‘œì‹œ
                nextQuestionBtn.classList.remove('hidden');
            }

            // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
            nextQuestionBtn.addEventListener('click', () => {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            });

            // í€´ì¦ˆ ì™„ë£Œ ì²˜ë¦¬
            function showQuizComplete() {
                quizOptionsContainer.innerHTML = '';
                categoryJumpContainer.innerHTML = ''; // Hide category buttons
                quizCategoryEl.textContent = 'í€´ì¦ˆ ì™„ë£Œ!';
                quizQuestionNumberEl.textContent = `ì´ ${quizList.length}ê°œì˜ ë¬¸ì œë¥¼ ëª¨ë‘ í’€ì—ˆìŠµë‹ˆë‹¤.`;
                quizQuestionEl.textContent = 'ğŸ‰ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‰';
                quizFeedbackMessageEl.textContent = '';
                quizCorrectAnswerEl.classList.add('hidden');
                
                nextQuestionBtn.textContent = 'ë‹¤ì‹œ í’€ê¸°';
                nextQuestionBtn.onclick = () => {
                    location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ê°„ë‹¨íˆ ë‹¤ì‹œ ì‹œì‘
                };
            }

            // 6. í€´ì¦ˆ ì‹œì‘
            startQuiz();
        });
    </script>
</body>
</html>



