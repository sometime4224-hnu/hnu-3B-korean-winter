<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ì“°ê¸° ì—°ìŠµ - ìƒí™œ ì†ì˜ ìš´ë™</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        
        /* Print Styles */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                padding: 40px;
                background: white;
                color: black;
            }
            .no-print { display: none !important; }
        }

        /* Custom Scrollbar for Textareas */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">

    <!-- Header -->
    <header class="bg-emerald-600 text-white p-4 shadow-md sticky top-0 z-50 no-print">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="bg-white/20 p-2 rounded-lg">
                    <i data-lucide="pen-tool" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold">ì£¼ì œ: ìƒí™œ ì†ì˜ ìš´ë™</h1>
                    <p class="text-xs text-emerald-100">Chá»§ Ä‘á»: Thá»ƒ dá»¥c trong Ä‘á»i sá»‘ng</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="save-status" class="hidden md:flex flex-col items-end text-xs text-emerald-100">
                    <span class="flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> ì €ì¥ë¨ (ÄÃ£ lÆ°u)</span>
                </div>
                <button onclick="resetData()" class="p-2 hover:bg-emerald-700 rounded-full transition-colors text-emerald-100 hover:text-white" title="ì´ˆê¸°í™” (LÃ m má»›i)">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 md:p-6">
        
        <!-- Progress Steps -->
        <div class="mb-8 no-print">
            <div class="grid grid-cols-4 gap-2">
                <button onclick="goToStep(0)" class="step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-white shadow-md border-b-4 border-emerald-600" id="btn-step-0">
                    <div class="text-emerald-600 mb-1"><i data-lucide="book-open" class="w-5 h-5"></i></div>
                    <span class="text-sm font-bold text-gray-800">ë‚´ìš© êµ¬ìƒ</span>
                    <span class="text-[10px] text-gray-400 hidden sm:block">TÃ¬m Ã½ tÆ°á»Ÿng</span>
                </button>
                <button onclick="goToStep(1)" class="step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-gray-50 text-gray-400 hover:bg-gray-100" id="btn-step-1">
                    <div class="mb-1"><i data-lucide="lightbulb" class="w-5 h-5"></i></div>
                    <span class="text-sm font-bold">í‘œí˜„ ìµíˆê¸°</span>
                    <span class="text-[10px] hidden sm:block">Há»c tá»« vá»±ng</span>
                </button>
                <button onclick="goToStep(2)" class="step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-gray-50 text-gray-400 hover:bg-gray-100" id="btn-step-2">
                    <div class="mb-1"><i data-lucide="layout" class="w-5 h-5"></i></div>
                    <span class="text-sm font-bold">ê°œìš” ì‘ì„±</span>
                    <span class="text-[10px] hidden sm:block">Láº­p dÃ n Ã½</span>
                </button>
                <button onclick="goToStep(3)" class="step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-gray-50 text-gray-400 hover:bg-gray-100" id="btn-step-3">
                    <div class="mb-1"><i data-lucide="file-text" class="w-5 h-5"></i></div>
                    <span class="text-sm font-bold">ê¸€ì“°ê¸°</span>
                    <span class="text-[10px] hidden sm:block">Viáº¿t bÃ i</span>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="bg-white rounded-xl shadow-lg p-6 min-h-[500px] transition-all duration-300 relative">
            
            <!-- STEP 1: Ideas -->
            <div id="step-0" class="step-content fade-in">
                <div class="border-b pb-3 mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">1. ë‚´ìš© êµ¬ìƒí•˜ê¸°</h2>
                    <p class="text-sm text-gray-500 mt-1">TÃ¬m Ã½ tÆ°á»Ÿng cho bÃ i viáº¿t</p>
                </div>

                <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100 mb-6 flex gap-3">
                    <i data-lucide="alert-circle" class="w-6 h-6 text-emerald-600 flex-shrink-0"></i>
                    <div>
                        <h4 class="font-bold text-emerald-900 text-sm">ê°€ì´ë“œ (HÆ°á»›ng dáº«n)</h4>
                        <p class="text-sm text-emerald-800 mt-1">
                            ì§ˆë¬¸ì— ë‹µí•˜ë©´ì„œ ê¸€ì˜ í•µì‹¬ ë‚´ìš©ì„ í•œêµ­ì–´ë¡œ ê°„ë‹¨íˆ ë©”ëª¨í•´ë³´ì„¸ìš”.<br>
                            <span class="text-xs opacity-75">(HÃ£y tráº£ lá»i cÃ¡c cÃ¢u há»i Ä‘á»ƒ ghi láº¡i ná»™i dung chÃ­nh báº±ng tiáº¿ng HÃ n.)</span>
                        </p>
                    </div>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block mb-2">
                            <span class="font-bold text-gray-800">Q1. ìš°ë¦¬ëŠ” ì™œ ìš´ë™ì„ í•´ì•¼ í• ê¹Œìš”?</span>
                            <span class="block text-xs text-gray-500">Táº¡i sao chÃºng ta pháº£i táº­p thá»ƒ dá»¥c? (Sá»©c khá»e, CÄƒng tháº³ng...)</span>
                        </label>
                        <input type="text" id="input-q1" oninput="saveData()" placeholder="ì˜ˆ: ê±´ê°•ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ, ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í’€ê¸° ìœ„í•´ì„œ..." 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none bg-gray-50 focus:bg-white transition-colors">
                    </div>

                    <div>
                        <label class="block mb-2">
                            <span class="font-bold text-gray-800">Q2. ìƒí™œ ì†ì—ì„œ ì‰½ê²Œ í•  ìˆ˜ ìˆëŠ” ìš´ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?</span>
                            <span class="block text-xs text-gray-500">Nhá»¯ng bÃ i táº­p nÃ o dá»… dÃ ng thá»±c hiá»‡n trong Ä‘á»i sá»‘ng?</span>
                        </label>
                        <input type="text" id="input-q2" oninput="saveData()" placeholder="ì˜ˆ: ì—˜ë¦¬ë² ì´í„° ëŒ€ì‹  ê³„ë‹¨ ì´ìš©í•˜ê¸°, ê°€ê¹Œìš´ ê±°ë¦¬ ê±·ê¸°..." 
                        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none bg-gray-50 focus:bg-white transition-colors">
                    </div>

                    <div>
                        <label class="block mb-2">
                            <span class="font-bold text-gray-800">ë©”ëª¨ì¥ (í•„ìš”í•œ ë‹¨ì–´ ì ê¸°)</span>
                            <span class="block text-xs text-gray-500">Ghi chÃº tá»« vá»±ng cáº§n thiáº¿t</span>
                        </label>
                        <textarea id="input-keywords" oninput="saveData()" class="w-full p-3 border rounded-lg h-24 resize-none focus:ring-2 focus:ring-emerald-500 outline-none"
                        placeholder="ì‚¬ìš©í•˜ê³  ì‹¶ì€ ë‹¨ì–´ë‚˜ í‘œí˜„ì„ ììœ ë¡­ê²Œ ì ìœ¼ì„¸ìš”."></textarea>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Vocab -->
            <div id="step-1" class="step-content hidden fade-in">
                <div class="border-b pb-3 mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">2. ì£¼ì œ ê´€ë ¨ í‘œí˜„ ìµíˆê¸°</h2>
                    <p class="text-sm text-gray-500 mt-1">Há»c tá»« vá»±ng vÃ  ngá»¯ phÃ¡p liÃªn quan</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Vocab List -->
                    <div class="border rounded-xl overflow-hidden shadow-sm">
                        <div class="bg-blue-50 p-3 border-b border-blue-100 flex items-center gap-2">
                            <i data-lucide="book" class="w-4 h-4 text-blue-600"></i>
                            <h3 class="font-bold text-blue-900">ìš´ë™ ê´€ë ¨ ì–´íœ˜ (Tá»« vá»±ng)</h3>
                        </div>
                        <ul class="divide-y divide-gray-100 bg-white text-sm">
                            <li class="p-3 flex justify-between"><span>ê±´ê°•ì„ ìœ ì§€í•˜ë‹¤</span><span class="text-gray-500">Duy trÃ¬ sá»©c khá»e</span></li>
                            <li class="p-3 flex justify-between"><span>ì²´ë ¥ì„ ê¸°ë¥´ë‹¤</span><span class="text-gray-500">RÃ¨n luyá»‡n thá»ƒ lá»±c</span></li>
                            <li class="p-3 flex justify-between"><span>ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ì†Œí•˜ë‹¤</span><span class="text-gray-500">Giáº£i tá»a cÄƒng tháº³ng</span></li>
                            <li class="p-3 flex justify-between"><span>ë¹„ë§Œì„ ì˜ˆë°©í•˜ë‹¤</span><span class="text-gray-500">PhÃ²ng ngá»«a bÃ©o phÃ¬</span></li>
                            <li class="p-3 flex justify-between"><span>ê³„ë‹¨ì„ ì´ìš©í•˜ë‹¤</span><span class="text-gray-500">Sá»­ dá»¥ng cáº§u thang</span></li>
                        </ul>
                    </div>

                    <!-- Grammar List -->
                    <div class="border rounded-xl overflow-hidden shadow-sm">
                        <div class="bg-orange-50 p-3 border-b border-orange-100 flex items-center gap-2">
                            <i data-lucide="check-circle" class="w-4 h-4 text-orange-600"></i>
                            <h3 class="font-bold text-orange-900">í•„ìˆ˜ ë¬¸ë²• (Ngá»¯ phÃ¡p)</h3>
                        </div>
                        <ul class="divide-y divide-gray-100 bg-white text-sm">
                            <li class="p-3">
                                <span class="font-bold block text-gray-800">-ëŠ” ê²ƒì´ ì¢‹ë‹¤</span>
                                <span class="text-xs text-gray-500">Tá»‘t hÆ¡n lÃ  nÃªn... (KhuyÃªn nhá»§)</span>
                            </li>
                            <li class="p-3">
                                <span class="font-bold block text-gray-800">-ì•„/ì–´ì•¼ í•œë‹¤</span>
                                <span class="text-xs text-gray-500">Pháº£i... (Sá»± cáº§n thiáº¿t)</span>
                            </li>
                            <li class="p-3">
                                <span class="font-bold block text-gray-800">-ê¸° ìœ„í•´ì„œ</span>
                                <span class="text-xs text-gray-500">Äá»ƒ... (Má»¥c Ä‘Ã­ch)</span>
                            </li>
                            <li class="p-3">
                                <span class="font-bold block text-gray-800">-ë¿ë§Œ ì•„ë‹ˆë¼</span>
                                <span class="text-xs text-gray-500">KhÃ´ng nhá»¯ng... mÃ  cÃ²n</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="mt-6 bg-gray-50 p-4 rounded-lg text-sm text-gray-600 border border-gray-200">
                    <p class="font-bold mb-2">ğŸ’¡ í™œìš© ì˜ˆì‹œ (VÃ­ dá»¥):</p>
                    <ul class="list-disc list-inside space-y-1">
                        <li>ê±´ê°•ì„ <span class="text-blue-600 font-bold">ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ</span> ë§¤ì¼ ìš´ë™ì„ <span class="text-orange-600 font-bold">í•´ì•¼ í•©ë‹ˆë‹¤</span>.</li>
                        <li>ì—˜ë¦¬ë² ì´í„° ëŒ€ì‹  <span class="text-blue-600 font-bold">ê³„ë‹¨ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤</span>.</li>
                    </ul>
                </div>
            </div>

            <!-- STEP 3: Outline -->
            <div id="step-2" class="step-content hidden fade-in">
                <div class="border-b pb-3 mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">3. ê°œìš” ì‘ì„± (ë¬¸ì¥ ë§Œë“¤ê¸°)</h2>
                    <p class="text-sm text-gray-500 mt-1">Láº­p dÃ n Ã½ chi tiáº¿t</p>
                </div>

                <div class="space-y-8">
                    <!-- Intro -->
                    <div class="relative pl-6 border-l-4 border-emerald-200">
                        <h3 class="font-bold text-lg text-emerald-800 mb-1">ì„œë¡ : ë¬¸ì œ ì œê¸°</h3>
                        <p class="text-sm text-gray-500 mb-3">Má»Ÿ bÃ i: NÃªu váº¥n Ä‘á»</p>
                        <p class="text-xs bg-emerald-50 p-2 rounded mb-2 text-emerald-700 font-medium">
                            Tip: "ìš”ì¦˜ í˜„ëŒ€ì¸ë“¤ì€ ë°”ìœ ìƒí™œ ë•Œë¬¸ì— ìš´ë™í•  ì‹œê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤."ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.
                        </p>
                        <textarea id="input-intro" oninput="saveData()" class="w-full h-24 p-3 border rounded-lg focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="ì„œë¡ ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
                    </div>

                    <!-- Body -->
                    <div class="relative pl-6 border-l-4 border-emerald-400">
                        <h3 class="font-bold text-lg text-emerald-800 mb-1">ë³¸ë¡ : ìš´ë™ì˜ í•„ìš”ì„± & ë°©ë²•</h3>
                        <p class="text-sm text-gray-500 mb-3">ThÃ¢n bÃ i: Táº¡i sao cáº§n táº­p & CÃ¡ch táº­p</p>
                        <p class="text-xs bg-emerald-50 p-2 rounded mb-2 text-emerald-700 font-medium">
                            Tip: "ì²«ì§¸, ìš´ë™ì„ í•˜ë©´ ê±´ê°•ì„ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤." (1ë‹¨ê³„ ë©”ëª¨ í™œìš©)
                        </p>
                        <textarea id="input-body" oninput="saveData()" class="w-full h-40 p-3 border rounded-lg focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="ìš´ë™ì´ í•„ìš”í•œ ì´ìœ ì™€ êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì“°ì„¸ìš”."></textarea>
                    </div>

                    <!-- Conclusion -->
                    <div class="relative pl-6 border-l-4 border-emerald-600">
                        <h3 class="font-bold text-lg text-emerald-800 mb-1">ê²°ë¡ : ê¶Œìœ  ë° ë‹¤ì§</h3>
                        <p class="text-sm text-gray-500 mb-3">Káº¿t bÃ i: KhuyÃªn nhá»§</p>
                        <p class="text-xs bg-emerald-50 p-2 rounded mb-2 text-emerald-700 font-medium">
                            Tip: "ë”°ë¼ì„œ ìš°ë¦¬ ëª¨ë‘ ê±´ê°•ì„ ìœ„í•´ ê¾¸ì¤€íˆ ìš´ë™ì„ í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤."
                        </p>
                        <textarea id="input-conclusion" oninput="saveData()" class="w-full h-24 p-3 border rounded-lg focus:ring-1 focus:ring-emerald-500 outline-none" placeholder="ê²°ë¡ ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Final Write -->
            <div id="step-3" class="step-content hidden fade-in h-full flex flex-col">
                <div class="flex justify-between items-end border-b pb-4 mb-4 no-print">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">4. ê¸€ì“°ê¸° ì™„ì„±</h2>
                        <p class="text-sm text-gray-500">Viáº¿t bÃ i hoÃ n chá»‰nh</p>
                    </div>
                    <div id="char-count" class="px-3 py-1 rounded-full text-sm font-mono font-bold bg-emerald-100 text-emerald-600">
                        0ì (chá»¯)
                    </div>
                </div>

                <!-- Web Editor -->
                <div class="no-print mb-4">
                    <textarea id="input-final" oninput="saveData(); updateCharCount();" 
                    class="w-full h-[400px] p-6 border rounded-lg bg-white shadow-inner focus:ring-2 focus:ring-emerald-500 outline-none leading-loose font-medium text-lg resize-none text-gray-800"
                    placeholder="ê°œìš”ì—ì„œ ì‘ì„±í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ê¸€ì„ ì™„ì„±í•˜ì„¸ìš”..." spellcheck="false"></textarea>
                </div>

                <!-- Printable Area (Hidden on screen, shown on print) -->
                <div id="print-area" class="hidden">
                    <div class="text-center mb-10 border-b-2 border-black pb-4">
                        <h1 class="text-3xl font-serif font-bold mb-2">ìƒí™œ ì†ì˜ ìš´ë™</h1>
                        <p class="text-gray-500">í•œêµ­ì–´ ì“°ê¸° ê³¼ì œ</p>
                    </div>
                    <div class="mb-6 p-4 bg-gray-50 border rounded text-sm text-gray-600">
                         <p><strong>ì£¼ì œ(Chá»§ Ä‘á»):</strong> ìƒí™œ ì†ì˜ ìš´ë™</p>
                         <p><strong>í‚¤ì›Œë“œ(Tá»« khÃ³a):</strong> <span id="print-keywords"></span></p>
                    </div>
                    <div id="print-content" class="text-lg leading-loose font-serif text-justify whitespace-pre-wrap px-4"></div>
                    <div class="mt-20 pt-4 border-t flex justify-between text-sm text-gray-500">
                        <span>ì‘ì„±ì ì„œëª…: ________________</span>
                        <span>ì‘ì„±ì¼: <span id="print-date"></span></span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-auto flex flex-col sm:flex-row gap-3 no-print">
                    <button onclick="copyToClipboard()" class="flex-1 flex items-center justify-center px-4 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors shadow-sm">
                        <i data-lucide="copy" class="w-4 h-4 mr-2"></i>
                        <span id="copy-btn-text">í´ë¦½ë³´ë“œ ë³µì‚¬ (Sao chÃ©p)</span>
                    </button>
                    <button onclick="printDoc()" class="flex-1 flex items-center justify-center px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-sm">
                        <i data-lucide="printer" class="w-4 h-4 mr-2"></i>
                        ì´ë¯¸ì§€/PDF ì €ì¥ (LÆ°u áº£nh/PDF)
                    </button>
                </div>
            </div>

            <!-- Footer Navigation -->
            <div class="flex justify-between mt-8 pt-4 border-t no-print">
                <button id="btn-prev" onclick="prevStep()" class="flex items-center px-5 py-2.5 rounded-lg font-bold bg-gray-200 text-gray-400 cursor-not-allowed" disabled>
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i>
                    ì´ì „ (TrÆ°á»›c)
                </button>
                <button id="btn-next" onclick="nextStep()" class="flex items-center px-5 py-2.5 rounded-lg font-bold bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg">
                    ë‹¤ìŒ (Tiáº¿p theo)
                    <i data-lucide="chevron-right" class="w-5 h-5 ml-1"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        // --- Init Icons ---
        lucide.createIcons();

        // --- State Management ---
        let currentStep = 0;
        const totalSteps = 4;
        const STORAGE_KEY = 'korean_writing_exercise_data_v1';

        // --- Data Loading & Saving ---
        function saveData() {
            const data = {
                q1: document.getElementById('input-q1').value,
                q2: document.getElementById('input-q2').value,
                keywords: document.getElementById('input-keywords').value,
                intro: document.getElementById('input-intro').value,
                body: document.getElementById('input-body').value,
                conclusion: document.getElementById('input-conclusion').value,
                final: document.getElementById('input-final').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            
            // Show save indicator
            const status = document.getElementById('save-status');
            if(status) {
                status.classList.remove('opacity-0');
                setTimeout(() => status.classList.add('opacity-0'), 2000);
            }
            updateCharCount();
            updatePrintContent();
        }

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('input-q1').value = data.q1 || '';
                document.getElementById('input-q2').value = data.q2 || '';
                document.getElementById('input-keywords').value = data.keywords || '';
                document.getElementById('input-intro').value = data.intro || '';
                document.getElementById('input-body').value = data.body || '';
                document.getElementById('input-conclusion').value = data.conclusion || '';
                document.getElementById('input-final').value = data.final || '';
                updateCharCount();
                updatePrintContent();
            }
        }

        function resetData() {
            if(confirm('ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.\n(Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a háº¿t khÃ´ng?)')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // --- Navigation Logic ---
        function goToStep(step) {
            // Update Current Step
            currentStep = step;

            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            // Show current step
            document.getElementById(`step-${step}`).classList.remove('hidden');

            // Update Header Buttons Styling
            for (let i = 0; i < totalSteps; i++) {
                const btn = document.getElementById(`btn-step-${i}`);
                if (i === step) {
                    btn.className = "step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-white shadow-md border-b-4 border-emerald-600";
                    btn.querySelector('.text-sm').classList.add('text-gray-800');
                    btn.querySelector('div').classList.add('text-emerald-600');
                } else {
                    btn.className = "step-btn flex flex-col items-center p-2 rounded-lg transition-all bg-gray-50 text-gray-400 hover:bg-gray-100";
                    btn.querySelector('.text-sm').classList.remove('text-gray-800');
                    btn.querySelector('div').classList.remove('text-emerald-600');
                }
            }

            // Update Footer Buttons
            const prevBtn = document.getElementById('btn-prev');
            const nextBtn = document.getElementById('btn-next');

            if (step === 0) {
                prevBtn.disabled = true;
                prevBtn.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                prevBtn.classList.remove('bg-white', 'text-gray-700', 'hover:bg-gray-50', 'border', 'border-gray-300');
            } else {
                prevBtn.disabled = false;
                prevBtn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                prevBtn.classList.add('bg-white', 'text-gray-700', 'hover:bg-gray-50', 'border', 'border-gray-300');
            }

            if (step === totalSteps - 1) {
                nextBtn.classList.add('hidden');
            } else {
                nextBtn.classList.remove('hidden');
            }

            // Logic: Auto-combine text when entering Final Step
            if (step === 3) {
                const finalArea = document.getElementById('input-final');
                if (!finalArea.value.trim()) {
                    const intro = document.getElementById('input-intro').value;
                    const body = document.getElementById('input-body').value;
                    const conclusion = document.getElementById('input-conclusion').value;
                    
                    const combined = [intro, body, conclusion].filter(Boolean).join('\n\n');
                    if(combined) {
                        finalArea.value = combined;
                        saveData();
                    }
                }
                updatePrintContent();
            }
        }

        function nextStep() {
            if (currentStep < totalSteps - 1) goToStep(currentStep + 1);
        }

        function prevStep() {
            if (currentStep > 0) goToStep(currentStep - 1);
        }

        // --- Utility Functions ---
        function updateCharCount() {
            const text = document.getElementById('input-final').value;
            const countEl = document.getElementById('char-count');
            countEl.innerText = `${text.length}ì (chá»¯)`;
            
            if(text.length > 700) {
                countEl.classList.remove('bg-emerald-100', 'text-emerald-600');
                countEl.classList.add('bg-red-100', 'text-red-600');
            } else {
                countEl.classList.add('bg-emerald-100', 'text-emerald-600');
                countEl.classList.remove('bg-red-100', 'text-red-600');
            }
        }

        function copyToClipboard() {
            const text = document.getElementById('input-final').value;
            navigator.clipboard.writeText(text).then(() => {
                const btnText = document.getElementById('copy-btn-text');
                const originalText = btnText.innerText;
                btnText.innerText = "ë³µì‚¬ ì™„ë£Œ! (ÄÃ£ xong)";
                setTimeout(() => {
                    btnText.innerText = originalText;
                }, 2000);
            });
        }

        function updatePrintContent() {
            // Update hidden print div
            const finalText = document.getElementById('input-final').value;
            const keywords = document.getElementById('input-keywords').value;
            document.getElementById('print-content').innerText = finalText;
            document.getElementById('print-keywords').innerText = keywords || '(ì—†ìŒ)';
            document.getElementById('print-date').innerText = new Date().toLocaleDateString();
        }

        function printDoc() {
            updatePrintContent();
            window.print();
        }

        // --- Initialize ---
        window.onload = loadData;

    </script>
</body>
</html>

