<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œêµ­ì–´ ë¬¸ë²•: -ì•„ì•¼/ì–´ì•¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Nunito:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            -webkit-tap-highlight-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            color: #2563eb;
            font-weight: 700;
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #2563eb;
            border-radius: 3px 3px 0 0;
        }

        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .speak-btn:active { transform: scale(0.9); color: #2563eb; }
        
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-30">
        <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 text-white p-2 rounded-lg shadow-sm">
                    <i class="fas fa-layer-group"></i>
                </div>
                <h1 class="text-lg md:text-xl font-bold text-slate-800 tracking-tight" id="app-title">í•œêµ­ì–´ ë¬¸ë²•</h1>
            </div>
            
            <div class="relative">
                <select id="language-selector" class="appearance-none bg-slate-100 border border-slate-200 text-slate-700 py-2 pl-3 pr-8 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer transition-colors hover:bg-slate-200">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="jp">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="cn">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <nav class="flex border-b border-slate-200 bg-white">
            <button onclick="switchTab('explanation')" id="tab-explanation" class="tab-btn active flex-1 py-3 text-slate-500 font-medium text-center hover:bg-slate-50">
                <i class="fas fa-book-open mr-1"></i> <span data-key="tab_explanation">ì„¤ëª…</span>
            </button>
            <button onclick="switchTab('practice')" id="tab-practice" class="tab-btn flex-1 py-3 text-slate-500 font-medium text-center hover:bg-slate-50">
                <i class="fas fa-pencil-alt mr-1"></i> <span data-key="tab_practice">ì—°ìŠµ</span>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="flex-grow w-full max-w-5xl mx-auto p-4 md:p-6 pb-20">
        
        <!-- Explanation View -->
        <div id="view-explanation" class="fade-in space-y-6">
            
            <!-- Intro Card -->
            <div class="bg-blue-50 border border-blue-100 rounded-xl p-6 shadow-sm">
                <div class="flex items-start gap-4">
                    <i class="fas fa-info-circle text-blue-600 text-2xl mt-1"></i>
                    <div>
                        <h2 class="text-2xl font-bold text-blue-800 mb-2">-ì•„ì•¼/ì–´ì•¼</h2>
                        <p id="content-meaning" class="text-slate-700 text-lg leading-relaxed">
                            ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ê¸° ìœ„í•´ <strong>ê¼­ í•„ìš”í•œ ì¡°ê±´</strong>ì„ ë§í•  ë•Œ ì‚¬ìš©í•´ìš”.
                        </p>
                        <div class="mt-3 inline-block bg-white/60 px-3 py-1 rounded text-sm text-blue-700 font-medium">
                            <i class="fas fa-lightbulb mr-1 text-yellow-500"></i> "A í•´ì•¼ B í•  ìˆ˜ ìˆë‹¤" (Must do A to do B)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conjugation Grid -->
            <div>
                <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center">
                    <i class="fas fa-link text-slate-400 mr-2"></i> <span data-key="conjugation_title">ê²°í•© ì •ë³´</span>
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Rule 1 -->
                    <div class="card bg-white p-5 rounded-xl border border-slate-200">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-bold text-slate-400 uppercase">ã…, ã…—</span>
                            <span class="bg-pink-100 text-pink-600 px-2 py-1 rounded text-sm font-bold">-ì•„ì•¼</span>
                        </div>
                        <ul class="space-y-2 text-slate-600">
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('ì¢‹ì•„ì•¼')">
                                <span>ì¢‹ë‹¤</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">ì¢‹ì•„ì•¼</span>
                            </li>
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('ê°€ì•¼')">
                                <span>ê°€ë‹¤</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">ê°€ì•¼</span>
                            </li>
                        </ul>
                    </div>
                    <!-- Rule 2 -->
                    <div class="card bg-white p-5 rounded-xl border border-slate-200">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-bold text-slate-400 uppercase">Other Vowels</span>
                            <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-sm font-bold">-ì–´ì•¼</span>
                        </div>
                        <ul class="space-y-2 text-slate-600">
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('ë¨¹ì–´ì•¼')">
                                <span>ë¨¹ë‹¤</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">ë¨¹ì–´ì•¼</span>
                            </li>
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('ê³µë¶€í•´ì•¼')">
                                <span>í•˜ë‹¤</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">í•´ì•¼</span>
                            </li>
                        </ul>
                    </div>
                    <!-- Rule 3 -->
                    <div class="card bg-white p-5 rounded-xl border border-slate-200">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-bold text-slate-400 uppercase">Noun (ëª…ì‚¬)</span>
                            <span class="bg-purple-100 text-purple-600 px-2 py-1 rounded text-sm font-bold">-ì´ì–´ì•¼/ì—¬ì•¼</span>
                        </div>
                        <ul class="space-y-2 text-slate-600">
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('í•™ìƒì´ì–´ì•¼')">
                                <span>í•™ìƒ</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">í•™ìƒì´ì–´ì•¼</span>
                            </li>
                            <li class="flex justify-between items-center group cursor-pointer" onclick="speak('ì˜ì‚¬ì—¬ì•¼')">
                                <span>ì˜ì‚¬</span> <i class="fas fa-arrow-right text-xs text-slate-300"></i> <span class="font-medium text-slate-800 group-hover:text-blue-600">ì˜ì‚¬ì—¬ì•¼</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Examples -->
            <div>
                <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center">
                    <i class="fas fa-quote-left text-slate-400 mr-2"></i> <span data-key="examples_title">ì˜ˆë¬¸</span>
                </h3>
                <div class="space-y-3" id="examples-list">
                    <!-- Examples injected via JS -->
                </div>
            </div>
        </div>

        <!-- Practice View -->
        <div id="view-practice" class="fade-in hidden space-y-6">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800" data-key="practice_title">ì—°ìŠµ ë¬¸ì œ</h2>
                <p class="text-slate-500" data-key="practice_desc">ë¬¸ì¥ì„ ì™„ì„±í•´ ë³´ì„¸ìš”.</p>
            </div>

            <div class="space-y-6" id="quiz-container">
                <!-- Quiz Items -->
            </div>
        </div>

    </main>

    <script>
        // --- Data ---
        const data = {
            ko: {
                tab_explanation: "ì„¤ëª…",
                tab_practice: "ì—°ìŠµ",
                meaning: "'A/V-ì•„ì•¼/ì–´ì•¼, N-(ì´)ì–´ì•¼/ì—¬ì•¼'ëŠ” ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ê¸° ìœ„í•´ ê¼­ í•„ìš”í•œ ì¡°ê±´ì„ ë§í•  ë•Œ ì‚¬ìš©í•´ìš”.",
                conjugation_title: "ê²°í•© ì •ë³´",
                examples_title: "ì˜ˆë¬¸",
                examples: [
                    "í•™ìƒì¦ì´ <strong>ìˆì–´ì•¼</strong> ë„ì„œê´€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆì–´ìš”.",
                    "ìš´ë™ì„ ê¾¸ì¤€íˆ <strong>í•´ì•¼</strong> ê±´ê°•ì„ ì§€í‚¬ ìˆ˜ ìˆì–´ìš”.",
                    "ìŠ¤ë¬´ ì‚´ ì´ìƒ<strong>ì´ì–´ì•¼</strong> ì´ ì˜í™”ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”."
                ],
                practice_title: "ì—°ìŠµ ë¬¸ì œ",
                practice_desc: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì¨ë³´ì„¸ìš”.",
                btn_hint: "íŒíŠ¸",
                btn_check: "ì •ë‹µ í™•ì¸",
                btn_model: "ëª¨ë²” ë‹µì•ˆ ë³´ê¸°",
                your_answer: "ë‚˜ì˜ ë‹µì•ˆ:",
                model_answer: "ëª¨ë²” ë‹µì•ˆ:",
                quizzes: [
                    { q: "ì™¸êµ­ì–´ë¥¼ ì˜í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•´ìš”?", hint: "ê¾¸ì¤€íˆ ê³µë¶€í•˜ë‹¤", model: "ê¾¸ì¤€íˆ ê³µë¶€í•´ì•¼ í•´ìš”." },
                    { q: "ë©´ì ‘ì„ ì˜ ë³´ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•´ìš”?", hint: "ìì‹ ê°ì„ ê°€ì§€ë‹¤", model: "ìì‹ ê°ì„ ê°€ì ¸ì•¼ í•´ìš”." },
                    { q: "ê±´ê°•í•˜ê²Œ ì‚´ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•´ìš”?", hint: "ìš´ë™ì„ ì—´ì‹¬íˆ í•˜ë‹¤", model: "ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì•¼ í•´ìš”." },
                    { q: "ë¼ë©´ì„ ë§›ìˆê²Œ ë“ì´ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•´ìš”?", hint: "ë¬¼ì„ ì˜ ë§ì¶”ë‹¤", model: "ë¬¼ì„ ì˜ ë§ì¶°ì•¼ í•´ìš”." }
                ]
            },
            en: {
                tab_explanation: "Explanation",
                tab_practice: "Practice",
                meaning: "Expresses a necessary condition for the following action/state. Equivalent to 'Must do A to do B'.",
                conjugation_title: "Conjugation",
                examples_title: "Examples",
                examples: [
                    "You <strong>must have</strong> a student ID to enter the library.",
                    "You <strong>must exercise</strong> consistently to maintain health.",
                    "You <strong>must be</strong> over 20 to watch this movie."
                ],
                practice_title: "Practice",
                practice_desc: "Complete the sentences.",
                btn_hint: "Hint",
                btn_check: "Check",
                btn_model: "Show Answer",
                your_answer: "Your Answer:",
                model_answer: "Model Answer:",
                quizzes: [
                    { q: "How can I be good at foreign languages?", hint: "study consistently", model: "ê¾¸ì¤€íˆ ê³µë¶€í•´ì•¼ í•´ìš”." },
                    { q: "How can I do well in an interview?", hint: "have confidence", model: "ìì‹ ê°ì„ ê°€ì ¸ì•¼ í•´ìš”." },
                    { q: "How can I live healthily?", hint: "exercise hard", model: "ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì•¼ í•´ìš”." },
                    { q: "How can I cook ramen deliciously?", hint: "adjust water well", model: "ë¬¼ì„ ì˜ ë§ì¶°ì•¼ í•´ìš”." }
                ]
            },
            jp: {
                tab_explanation: "èª¬æ˜",
                tab_practice: "ç·´ç¿’",
                meaning: "ã‚ã‚‹ã“ã¨ãŒèµ·ã“ã‚‹ãŸã‚ã«å¿…è¦ãªæ¡ä»¶ã‚’è¡¨ã—ã¾ã™ã€‚ã€Œã€œã—ã¦ã“ãã€œã§ãã‚‹ã€ã€Œã€œã—ãªã„ã¨ã€œã§ããªã„ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
                conjugation_title: "æ´»ç”¨",
                examples_title: "ä¾‹æ–‡",
                examples: [
                    "å­¦ç”Ÿè¨¼ãŒ<strong>ã‚ã£ã¦ã“ã</strong>(ãªã‘ã‚Œã°)å›³æ›¸é¤¨ã«å…¥ã‚Œã¾ã™ã€‚",
                    "é‹å‹•ã‚’ç€å®Ÿã«<strong>ã—ã¦ã“ã</strong>å¥åº·ã‚’å®ˆã‚Œã¾ã™ã€‚",
                    "20æ­³ä»¥ä¸Š<strong>ã§ãªã‘ã‚Œã°</strong>ã“ã®æ˜ ç”»ã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚"
                ],
                practice_title: "ç·´ç¿’å•é¡Œ",
                practice_desc: "æ–‡ç« ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„ã€‚",
                btn_hint: "ãƒ’ãƒ³ãƒˆ",
                btn_check: "ç¢ºèª",
                btn_model: "æ¨¡ç¯„è§£ç­”",
                your_answer: "ã‚ãªãŸã®ç­”ãˆ:",
                model_answer: "æ¨¡ç¯„è§£ç­”:",
                quizzes: [
                    { q: "å¤–å›½èªãŒä¸Šæ‰‹ã«ãªã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ", hint: "ç€å®Ÿã«å‹‰å¼·ã™ã‚‹", model: "ê¾¸ì¤€íˆ ê³µë¶€í•´ì•¼ í•´ìš”." },
                    { q: "é¢æ¥ã§ã†ã¾ãã„ãã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ", hint: "è‡ªä¿¡ã‚’æŒã¤", model: "ìì‹ ê°ì„ ê°€ì ¸ì•¼ í•´ìš”." },
                    { q: "å¥åº·ã«ç”Ÿãã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ", hint: "ä¸€ç”Ÿæ‡¸å‘½é‹å‹•ã™ã‚‹", model: "ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì•¼ í•´ìš”." },
                    { q: "ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚’ç¾å‘³ã—ãä½œã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ", hint: "æ°´ã‚’ã‚ˆãåˆã‚ã›ã‚‹", model: "ë¬¼ì„ ì˜ ë§ì¶°ì•¼ í•´ìš”." }
                ]
            },
            cn: {
                tab_explanation: "è¯´æ˜",
                tab_practice: "ç»ƒä¹ ",
                meaning: "è¡¨ç¤ºä¸ºäº†å®ç°æŸäº‹å¿…é¡»å…·å¤‡çš„æ¡ä»¶ã€‚ç›¸å½“äºâ€œåªæœ‰â€¦â€¦æ‰â€¦â€¦â€æˆ–â€œå¿…é¡»â€¦â€¦æ‰èƒ½â€¦â€¦â€ã€‚",
                conjugation_title: "ç»“åˆè§„åˆ™",
                examples_title: "ä¾‹å¥",
                examples: [
                    "<strong>å¿…é¡»æœ‰</strong>å­¦ç”Ÿè¯æ‰èƒ½è¿›å…¥å›¾ä¹¦é¦†ã€‚",
                    "<strong>å¿…é¡»</strong>åšæŒè¿åŠ¨æ‰èƒ½ä¿æŒå¥åº·ã€‚",
                    "<strong>å¿…é¡»</strong>æ˜¯20å²ä»¥ä¸Šæ‰èƒ½çœ‹è¿™éƒ¨ç”µå½±ã€‚"
                ],
                practice_title: "ç»ƒä¹ é¢˜",
                practice_desc: "è¯·å®Œæˆå¥å­ã€‚",
                btn_hint: "æç¤º",
                btn_check: "ç¡®è®¤",
                btn_model: "æŸ¥çœ‹ç­”æ¡ˆ",
                your_answer: "ä½ çš„å›ç­”:",
                model_answer: "å‚è€ƒç­”æ¡ˆ:",
                quizzes: [
                    { q: "æƒ³è¦å­¦å¥½å¤–è¯­è¯¥æ€ä¹ˆåšï¼Ÿ", hint: "åšæŒå­¦ä¹ ", model: "ê¾¸ì¤€íˆ ê³µë¶€í•´ì•¼ í•´ìš”." },
                    { q: "æƒ³è¦é¢è¯•è¡¨ç°å¥½è¯¥æ€ä¹ˆåšï¼Ÿ", hint: "æœ‰è‡ªä¿¡", model: "ìì‹ ê°ì„ ê°€ì ¸ì•¼ í•´ìš”." },
                    { q: "æƒ³è¦å¥åº·ç”Ÿæ´»è¯¥æ€ä¹ˆåšï¼Ÿ", hint: "åŠªåŠ›è¿åŠ¨", model: "ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì•¼ í•´ìš”." },
                    { q: "æƒ³è¦ç…®å¥½æ‹‰é¢è¯¥æ€ä¹ˆåšï¼Ÿ", hint: "æ§åˆ¶å¥½æ°´é‡", model: "ë¬¼ì„ ì˜ ë§ì¶°ì•¼ í•´ìš”." }
                ]
            },
            vi: {
                tab_explanation: "Giáº£i thÃ­ch",
                tab_practice: "Luyá»‡n táº­p",
                meaning: "Diá»…n táº£ Ä‘iá»u kiá»‡n cáº§n thiáº¿t Ä‘á»ƒ má»™t viá»‡c gÃ¬ Ä‘Ã³ xáº£y ra. TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i 'Pháº£i... thÃ¬ má»›i...'.",
                conjugation_title: "CÃ¡ch chia",
                examples_title: "VÃ­ dá»¥",
                examples: [
                    "<strong>Pháº£i cÃ³</strong> tháº» sinh viÃªn thÃ¬ má»›i vÃ o thÆ° viá»‡n Ä‘Æ°á»£c.",
                    "<strong>Pháº£i</strong> táº­p thá»ƒ dá»¥c Ä‘á»u Ä‘áº·n thÃ¬ má»›i khá»e máº¡nh.",
                    "<strong>Pháº£i</strong> trÃªn 20 tuá»•i thÃ¬ má»›i Ä‘Æ°á»£c xem phim nÃ y."
                ],
                practice_title: "Luyá»‡n táº­p",
                practice_desc: "HÃ£y hoÃ n thÃ nh cÃ¢u.",
                btn_hint: "Gá»£i Ã½",
                btn_check: "Kiá»ƒm tra",
                btn_model: "ÄÃ¡p Ã¡n máº«u",
                your_answer: "CÃ¢u tráº£ lá»i cá»§a báº¡n:",
                model_answer: "ÄÃ¡p Ã¡n máº«u:",
                quizzes: [
                    { q: "LÃ m tháº¿ nÃ o Ä‘á»ƒ giá»i ngoáº¡i ngá»¯?", hint: "há»c chÄƒm chá»‰", model: "ê¾¸ì¤€íˆ ê³µë¶€í•´ì•¼ í•´ìš”." },
                    { q: "LÃ m tháº¿ nÃ o Ä‘á»ƒ phá»ng váº¥n tá»‘t?", hint: "tá»± tin", model: "ìì‹ ê°ì„ ê°€ì ¸ì•¼ í•´ìš”." },
                    { q: "LÃ m tháº¿ nÃ o Ä‘á»ƒ sá»‘ng khá»e máº¡nh?", hint: "táº­p thá»ƒ dá»¥c chÄƒm chá»‰", model: "ìš´ë™ì„ ì—´ì‹¬íˆ í•´ì•¼ í•´ìš”." },
                    { q: "LÃ m tháº¿ nÃ o Ä‘á»ƒ náº¥u mÃ¬ ngon?", hint: "cÄƒn nÆ°á»›c chuáº©n", model: "ë¬¼ì„ ì˜ ë§ì¶°ì•¼ í•´ìš”." }
                ]
            }
        };

        // --- State ---
        let currentLang = 'ko';

        // --- Functions ---
        function speak(text) {
            window.speechSynthesis.cancel();
            // Remove HTML tags for clean speech
            const cleanText = text.replace(/<[^>]*>?/gm, '');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            document.getElementById('view-explanation').classList.add('hidden');
            document.getElementById('view-practice').classList.add('hidden');
            
            document.getElementById(`view-${tabName}`).classList.remove('hidden');
            document.getElementById(`view-${tabName}`).classList.add('fade-in');
        }

        function renderContent() {
            const t = data[currentLang];
            
            // Static text
            document.querySelectorAll('[data-key]').forEach(el => {
                el.innerText = t[el.dataset.key];
            });
            document.getElementById('content-meaning').innerHTML = t.meaning;

            // Render Examples
            const exampleList = document.getElementById('examples-list');
            exampleList.innerHTML = t.examples.map(ex => `
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:border-blue-300 transition-colors flex gap-3 items-start">
                    <button class="speak-btn text-slate-400 hover:text-blue-500 mt-0.5 shrink-0" onclick="speak('${ex.replace(/'/g, "\\'")}')">
                        <i class="fas fa-volume-up text-lg"></i>
                    </button>
                    <p class="text-slate-700 leading-relaxed">${ex}</p>
                </div>
            `).join('');

            // Render Quiz
            const quizContainer = document.getElementById('quiz-container');
            // If inputs exist, try to preserve values (simple check)
            const existingInputs = {};
            document.querySelectorAll('.quiz-input').forEach((inp, idx) => existingInputs[idx] = inp.value);

            quizContainer.innerHTML = t.quizzes.map((quiz, idx) => `
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                    <div class="mb-3">
                        <span class="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded mb-1 inline-block">Q${idx + 1}</span>
                        <p class="text-slate-800 font-medium text-lg">${quiz.q}</p>
                    </div>
                    
                    <div class="mb-4 hidden" id="hint-${idx}">
                        <p class="text-sm text-slate-500 bg-slate-50 p-2 rounded border border-slate-100">
                            <i class="fas fa-lightbulb text-yellow-400 mr-1"></i> Hint: ${quiz.hint}
                        </p>
                    </div>

                    <div class="flex gap-2 mb-3">
                        <input type="text" id="input-${idx}" class="quiz-input flex-1 border-2 border-slate-200 rounded-lg p-3 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all" placeholder="..." value="${existingInputs[idx] || ''}">
                    </div>

                    <div class="flex flex-wrap gap-2">
                         <button onclick="toggleHint(${idx})" class="text-sm px-3 py-2 rounded-lg bg-yellow-50 text-yellow-700 hover:bg-yellow-100 font-medium transition-colors">
                            <i class="far fa-lightbulb mr-1"></i> ${t.btn_hint}
                        </button>
                        <button onclick="checkAnswer(${idx})" class="text-sm px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 font-bold transition-colors shadow-sm shadow-blue-200">
                            ${t.btn_check}
                        </button>
                         <button onclick="showModel(${idx})" class="text-sm px-3 py-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 font-medium transition-colors ml-auto">
                            ${t.btn_model}
                        </button>
                    </div>

                    <div id="feedback-${idx}" class="mt-4 hidden p-4 bg-slate-50 rounded-lg border border-slate-100 animate-pulse-fast">
                        <!-- Feedback content -->
                    </div>
                </div>
            `).join('');
        }

        function toggleHint(idx) {
            document.getElementById(`hint-${idx}`).classList.toggle('hidden');
        }

        function checkAnswer(idx) {
            const input = document.getElementById(`input-${idx}`);
            const feedback = document.getElementById(`feedback-${idx}`);
            const val = input.value.trim();
            const t = data[currentLang];

            // Simple validation: check if it contains 'ì•¼' (core grammar point)
            const isCorrect = val.includes('ì•¼'); 
            
            feedback.classList.remove('hidden');
            feedback.classList.remove('animate-pulse-fast');
            void feedback.offsetWidth; // trigger reflow
            feedback.classList.add('animate-pulse-fast');

            if (isCorrect) {
                feedback.innerHTML = `
                    <div class="flex items-center text-green-600 font-bold mb-1">
                        <i class="fas fa-check-circle mr-2"></i> Great Job!
                    </div>
                    <p class="text-slate-600 text-sm">${t.model_answer} <span class="text-blue-600 font-medium">${data[currentLang].quizzes[idx].model}</span></p>
                `;
                input.classList.add('border-green-500');
                speak(data[currentLang].quizzes[idx].model);
            } else {
                feedback.innerHTML = `
                    <div class="flex items-center text-orange-500 font-bold mb-1">
                        <i class="fas fa-exclamation-circle mr-2"></i> Try again!
                    </div>
                    <p class="text-slate-500 text-sm">Don't forget to use <strong>-ì•„ì•¼/ì–´ì•¼</strong>.</p>
                `;
                input.classList.add('border-orange-300');
            }
        }

        function showModel(idx) {
            const feedback = document.getElementById(`feedback-${idx}`);
            const t = data[currentLang];
            
            feedback.classList.remove('hidden');
            feedback.innerHTML = `
                <p class="text-slate-500 text-sm font-bold mb-1">${t.model_answer}</p>
                <p class="text-blue-600 text-lg font-medium">${data[currentLang].quizzes[idx].model}</p>
                <button class="mt-2 text-slate-400 hover:text-blue-500 text-sm" onclick="speak('${data[currentLang].quizzes[idx].model}')">
                    <i class="fas fa-volume-up mr-1"></i> Listen
                </button>
            `;
            // Trigger TTS immediately
            speak(data[currentLang].quizzes[idx].model);
        }

        // --- Event Listeners ---
        document.getElementById('language-selector').addEventListener('change', (e) => {
            currentLang = e.target.value;
            renderContent();
        });

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            renderContent();
        });

    </script>
</body>
</html>
