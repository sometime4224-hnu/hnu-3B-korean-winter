<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ë¬¸ë²• ìª½ì§€ ì‹œí—˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ë² íŠ¸ë‚¨ì–´ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .vi-notice {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            color: #d97706;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden min-h-[600px] flex flex-col relative">
        
        <!-- Header -->
        <header class="bg-indigo-600 text-white p-5 text-center shadow-md z-10">
            <h1 class="text-xl font-bold">í•œêµ­ì–´ ë¬¸ë²• ìª½ì§€ ì‹œí—˜</h1>
            <p class="text-xs opacity-80 mt-1">Level 3 Grammar Quiz</p>
        </header>

        <!-- Main Content Area -->
        <main id="app-container" class="flex-1 overflow-y-auto p-6 relative">
            
            <!-- 1. Start Screen -->
            <div id="screen-start" class="flex flex-col items-center justify-center h-full space-y-6 fade-in">
                <div class="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 mb-4">
                    <i class="fas fa-book-open text-4xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800">ë¬¸ë²• ì‹¤ë ¥ í™•ì¸í•˜ê¸°</h2>
                <p class="text-slate-500 text-center text-sm px-4">
                    í•™ìŠµí•œ ë¬¸ë²• ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ<br>ìª½ì§€ ì‹œí—˜ì„ ë´…ë‹ˆë‹¤. (ì´ 20ë¬¸ì œ)
                </p>
                
                <div class="w-full space-y-3 mt-8">
                    <button onclick="startQuiz()" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold text-lg shadow-lg hover:bg-indigo-700 transition transform hover:-translate-y-1">
                        ì‹œí—˜ ì‹œì‘ (Báº¯t Ä‘áº§u)
                    </button>
                    <button onclick="showHistory()" class="w-full py-4 bg-white border-2 border-slate-200 text-slate-600 rounded-xl font-bold text-lg hover:bg-slate-50 transition">
                        ê¸°ë¡ ë³´ê¸° (Lá»‹ch sá»­)
                    </button>
                </div>
            </div>

            <!-- 2. Quiz Screen -->
            <div id="screen-quiz" class="hidden flex-col h-full fade-in">
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                    <div id="progress-bar" class="bg-indigo-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>

                <div class="flex-1 flex flex-col justify-center">
                    <span id="question-count" class="text-indigo-600 font-bold text-sm mb-2">Question 1/20</span>
                    <h3 id="question-text" class="text-xl font-bold text-slate-800 mb-8 leading-relaxed">
                        ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                    </h3>

                    <div id="options-container" class="space-y-3">
                        <!-- Options will be injected here -->
                    </div>
                </div>
            </div>

            <!-- 3. Result Screen -->
            <div id="screen-result" class="hidden flex-col h-full fade-in pb-20">
                <!-- Vietnamese Notice for Teacher -->
                <div class="vi-notice p-4 rounded-xl text-center mb-6">
                    <i class="fas fa-exclamation-circle text-2xl mb-1 block"></i>
                    <p class="font-bold text-lg">HÃ£y Ä‘Æ°a mÃ n hÃ¬nh nÃ y cho giÃ¡o viÃªn xem</p>
                    <p class="text-xs opacity-80">(ì´ í™”ë©´ì„ ì„ ìƒë‹˜ì—ê²Œ ë³´ì—¬ì£¼ì„¸ìš”)</p>
                </div>

                <div class="text-center mb-8">
                    <p class="text-slate-500 text-sm mb-1">ìµœì¢… ì ìˆ˜</p>
                    <div class="text-5xl font-bold text-indigo-600 mb-2">
                        <span id="final-score">0</span><span class="text-2xl text-slate-400">/100</span>
                    </div>
                    <p id="score-message" class="text-slate-600 font-medium"></p>
                </div>

                <!-- Review Section -->
                <div class="bg-slate-50 rounded-xl p-4 border border-slate-200 mb-4">
                    <h4 class="font-bold text-slate-700 mb-3 flex items-center">
                        <i class="fas fa-clipboard-check mr-2 text-indigo-500"></i> ì˜¤ë‹µ ë…¸íŠ¸
                    </h4>
                    <div id="review-list" class="space-y-4 text-sm">
                        <!-- Wrong answers will be injected here -->
                    </div>
                </div>
            </div>

            <!-- 4. History Screen -->
            <div id="screen-history" class="hidden flex-col h-full fade-in">
                <div class="flex items-center mb-6">
                    <button onclick="goHome()" class="text-slate-400 hover:text-indigo-600 mr-4">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <h2 class="text-xl font-bold text-slate-800">ì‹œí—˜ ê¸°ë¡</h2>
                </div>

                <div id="history-list" class="space-y-3 overflow-y-auto max-h-[400px]">
                    <!-- History items injected here -->
                    <div class="text-center text-slate-400 py-10">
                        ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer Button (Only for Result Screen) -->
        <div id="result-footer" class="hidden absolute bottom-0 left-0 w-full p-4 bg-white border-t border-slate-100">
             <button onclick="goHome()" class="w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-700 transition">
                ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>

    </div>

    <script>
        // --- Quiz Data ---
        const quizData = [
            // 1~10ë²ˆ: ë¬¸ë²• í˜•íƒœ ë° í™œìš© ë¬¸ì œ
            {
                id: 1,
                question: "ì£¼ë§ì— ì§‘ì—ì„œ í‘¹ ( ì‰¬ë‹¤ ) ______.",
                options: ["ì‰¬ì„ ìƒê°ì´ì—ìš”", "ì‰´ ìƒê°ì´ì—ìš”", "ì‰° ìƒê°ì´ì—ìš”", "ì‰¬ëŠ” ìƒê°ì´ì—ìš”"],
                correct: 1,
                grammar: "V-(ìœ¼)ã„¹ ìƒê°ì´ë‹¤ (Future Plan)"
            },
            {
                id: 2,
                question: "í•œêµ­ ìŒì‹ì„ ( ë§Œë“¤ë‹¤ ) ______.",
                options: ["ë§Œë“¤ ê³„íšì´ì—ìš”", "ë§Œë“¤ì„ ê³„íšì´ì—ìš”", "ë§Œë“  ê³„íšì´ì—ìš”", "ë§Œë“œ ê³„íšì´ì—ìš”"],
                correct: 0,
                grammar: "V-(ìœ¼)ã„¹ ê³„íšì´ë‹¤ (Irregular ã„¹)"
            },
            {
                id: 3,
                question: "ì œê°€ ì˜›ë‚ ì— ìì£¼ ( ê°€ë‹¤ ) ______ ì¹´í˜ì˜ˆìš”.", // ë¬¸ë§¥ ë³´ê°•: ì˜›ë‚ ì— ì¶”ê°€
                options: ["ê°€ëŠ”", "ê°€ë˜", "ê°„", "ê°ˆ"],
                correct: 1,
                grammar: "-ë˜ (Retrospective)"
            },
            {
                id: 4,
                question: "í•œêµ­ë§ì„ ì˜í•˜ë ¤ë©´ ì•„ì§ ( ë©€ë‹¤ ) ______.",
                options: ["ë©€ì—ˆì–´ìš”", "ë©€ì´ìš”", "ë©€ì–´ìš”", "ë©€ê² ì–´ìš”"],
                correct: 0,
                grammar: "V-(ìœ¼)ë ¤ë©´ ë©€ì—ˆë‹¤ (Far from...)"
            },
            {
                id: 5,
                question: "ì˜¤ëŠ˜ì€ ë‚ ì”¨ê°€ ( ì¶¥ë‹¤ ) ______. ë”°ëœ»í•˜ê²Œ ì…ìœ¼ì„¸ìš”.",
                options: ["ì¶¥ì–ì•„ìš”", "ì¶¥ê±°ë“ ìš”", "ì¶”ìš´ë°ìš”", "ì¶”ì›Œìš”"],
                correct: 0,
                grammar: "-ì–ì•„ìš” (You know/Confirmation)"
            },
            {
                id: 6,
                question: "ì—„ë§ˆê°€ ì•„ì´ì—ê²Œ ë°¥ì„ ( ë¨¹ë‹¤ ) ______.",
                options: ["ë¨¹ì–´ìš”", "ë¨¹ì—¬ìš”", "ë¨¹íˆìš”", "ë¨¹ë‚´ìš”"],
                correct: 1,
                grammar: "ì‚¬ë™ì‚¬ (Causative: ì´/íˆ/ë¦¬/ê¸°...)"
            },
            {
                id: 7,
                question: "ì„ ìƒë‹˜ì´ í•™ìƒë“¤ì—ê²Œ ì‚¬ì§„ì„ ( ë³´ë‹¤ ) ______.",
                options: ["ë³´ì•˜ì–´ìš”", "ë³´ëƒˆì–´ìš”", "ë³´ì—¬ ì£¼ì—ˆì–´ìš”", "ë³´ì´ê²Œ ì¤¬ì–´ìš”"], // ì˜¤ë‹µ ì„ ì§€ ìˆ˜ì • (ëª…í™•í•œ ì˜¤ë‹µ)
                correct: 2,
                grammar: "ì‚¬ë™ì‚¬ (ë³´ì´ë‹¤ -> ë³´ì—¬ ì£¼ë‹¤)"
            },
            {
                id: 8,
                question: "ë§Œì•½ ë³µê¶Œì— ( ë‹¹ì²¨ë˜ë‹¤ ) ______ ì°¨ë¥¼ ì‚´ ê±°ì˜ˆìš”.",
                options: ["ë‹¹ì²¨ë˜ë ¤ë©´", "ë‹¹ì²¨ëœë‹¤ë©´", "ë‹¹ì²¨ë˜ë¼ë©´", "ë‹¹ì²¨ë˜ìë©´"], // ì¤‘ë³µ ë° ì˜¤ë‹µ ì‹œë¹„ ìˆ˜ì •
                correct: 1,
                grammar: "-(ã„´/ëŠ”)ë‹¤ë©´ (Hypothetical)"
            },
            {
                id: 9,
                question: "ì œê°€ ( ì˜ì‚¬ ) ______ í™˜ìë¥¼ ê³ ì³ ì¤„ ê±°ì˜ˆìš”.",
                options: ["ì˜ì‚¬ë¼ë©´", "ì˜ì‚¬ë‹¤ë©´", "ì˜ì‚¬ì´ë©´", "ì˜ì‚¬ëœë‹¤ë©´"],
                correct: 0,
                grammar: "N(ì´)ë¼ë©´ (Hypothetical Noun)"
            },
            {
                id: 10,
                question: "( ë¬´ì—‡ ) ______ ì—´ì‹¬íˆ í• ê²Œìš”.",
                options: ["ë¬´ì—‡ì´ë“ ì§€", "ë¬´ì—‡ë¼ë„", "ë¬´ì—‡ì´ë‚˜", "ë¬´ì—‡ë“ ì§€"],
                correct: 0,
                grammar: "-ë“ ì§€ (Whatever)"
            },
            
            // 11~20ë²ˆ: ë¬¸ë§¥ì— ë§ëŠ” ë¬¸ë²• ê³ ë¥´ê¸° (Grammar Selection)
            {
                id: 11,
                question: "ê°€: ì´ë²ˆ ë°©í•™ì— ê³ í–¥ì— ê°ˆ ê±°ì˜ˆìš”?<br>ë‚˜: ë„¤, ê³ í–¥ì— ______.",
                options: ["ê°€ì–ì•„ìš”", "ê°€ë˜ë°ìš”", "ê°ˆ ìƒê°ì´ì—ìš”", "ê°€ë ¤ë©´ ë©€ì—ˆì–´ìš”"], // ê°ˆ ìƒê°ì´ì—ìš”ë¡œ ìˆ˜ì •
                correct: 2,
                grammar: "-(ìœ¼)ã„¹ ìƒê°ì´ë‹¤ (ê³„íš ë§í•˜ê¸°)"
            },
            {
                id: 12,
                question: "ê°€: ì™œ ì´ë ‡ê²Œ ê¸¸ì´ ë§‰í˜€ìš”?<br>ë‚˜: ì§€ê¸ˆ í‡´ê·¼ ______.",
                options: ["ì‹œê°„ì´ì–ì•„ìš”", "ì‹œê°„ì´ë¼ë©´", "ì‹œê°„ì´ë“ ì§€", "ì‹œê°„ì¼ ê³„íšì´ì—ìš”"],
                correct: 0,
                grammar: "-ì–ì•„ìš” (ì´ìœ  í™•ì¸)"
            },
            {
                id: 13,
                question: "ê°€: ìˆ™ì œ ë‹¤ í–ˆì–´ìš”?<br>ë‚˜: ì•„ë‹ˆìš”, ë‹¤ ______.",
                options: ["ëë‚¸ë‹¤ë©´ìš”", "ëë‚´ë ¤ë©´ ë©€ì—ˆì–´ìš”", "ëë‚´ë˜ ì°¸ì´ì—ìš”", "ëë‚´ê²Œ ì‹œì¼°ì–´ìš”"],
                correct: 1,
                grammar: "-(ìœ¼)ë ¤ë©´ ë©€ì—ˆë‹¤ (ì•„ì§ ë¶€ì¡±í•¨)"
            },
            {
                id: 14,
                question: "ê°€: ì´ ë…¸ë˜ ì•Œì•„ìš”?<br>ë‚˜: ë„¤, ì œê°€ ëŒ€í•™ìƒ ë•Œ ìì£¼ ______ ë…¸ë˜ì˜ˆìš”.",
                options: ["ë“£ëŠ”", "ë“£ë˜", "ë“¤ì„", "ë“£ê¸°"],
                correct: 1,
                grammar: "-ë˜ (ê³¼ê±°ì˜ íšŒìƒ)"
            },
            {
                id: 15,
                question: "ê°€: ì•„ì´ê°€ ë°¥ì„ ì•ˆ ë¨¹ì–´ìš”.<br>ë‚˜: ê·¸ëŸ¼ ì—„ë§ˆê°€ ì§ì ‘ ______ ì£¼ì„¸ìš”.",
                options: ["ë¨¹ì—¬", "ë¨¹ì–´", "ë¨¹ê²Œ", "ë¨¹ì„"],
                correct: 0,
                grammar: "ì‚¬ë™ì‚¬ (í–‰ë™ì„ í•˜ê²Œ í•¨)"
            },
            {
                id: 16,
                question: "ê°€: ì–´ë–¤ ì„ ë¬¼ì„ ë°›ê³  ì‹¶ì–´ìš”?<br>ë‚˜: ë§ˆìŒì´ ë‹´ê²¨ ìˆë‹¤ë©´ ______ ë‹¤ ì¢‹ì•„ìš”.",
                options: ["ë¬´ì—‡ì´ë“ ì§€", "ë¬´ì—‡ì´ì–ì•„ìš”", "ë¬´ì—‡ì¼ ìƒê°ì´ì—ìš”", "ë¬´ì—‡ì´ë ¤ë©´"],
                correct: 0,
                grammar: "-ë“ ì§€ (ì„ íƒì˜ ì œí•œ ì—†ìŒ)"
            },
            {
                id: 17,
                question: "ê°€: í•œêµ­ì–´ë¥¼ ì •ë§ ì˜í•˜ì‹œë„¤ìš”!<br>ë‚˜: ì˜í•˜ë ¤ë©´ ì•„ì§ ______.",
                options: ["ë©€ì—ˆì–´ìš”", "ë©€ì–ì•„ìš”", "ë©€ë˜ë°ìš”", "ë©€ ìƒê°ì´ì—ìš”"],
                correct: 0,
                grammar: "-(ìœ¼)ë ¤ë©´ ë©€ì—ˆë‹¤ (ê²¸ì†)"
            },
            {
                id: 18,
                question: "ê°€: ë§Œì•½ ë¶€ìê°€ ______ ë¬´ì—‡ì„ í•˜ê³  ì‹¶ì–´ìš”?<br>ë‚˜: ì„¸ê³„ ì—¬í–‰ì„ ê°€ê³  ì‹¶ì–´ìš”.",
                options: ["ëœë‹¤ë©´", "ë˜ì–ì•„ìš”", "ë˜ë˜", "ë˜ë ¤ë©´ ë©€ì—ˆì–´ìš”"],
                correct: 0,
                grammar: "-(ã„´/ëŠ”)ë‹¤ë©´ (ê°€ì •)"
            },
            {
                id: 19,
                question: "ê°€: ê¹€ì¹˜ì°Œê°œê°€ ë„ˆë¬´ ë§¤ì›Œìš”.<br>ë‚˜: í•œêµ­ ìŒì‹ì€ ì›ë˜ ì¡°ê¸ˆ ______.",
                options: ["ë§µì–ì•„ìš”", "ë§µë˜", "ë§¤ìš¸ ìƒê°ì´ì—ìš”", "ë§µê²Œ ì‹œì¼°ì–´ìš”"],
                correct: 0,
                grammar: "-ì–ì•„ìš” (ì‚¬ì‹¤ í™•ì¸)"
            },
            {
                id: 20,
                question: "ê°€: ì˜·ì´ ë„ˆë¬´ ì»¤ìš”.<br>ë‚˜: ê·¸ëŸ¼ ì‚¬ì´ì¦ˆë¥¼ ì¢€ ______.",
                options: ["ì¤„ì´ì„¸ìš”", "ì¤„ìœ¼ì„¸ìš”", "ì¤„ì–ì•„ìš”", "ì¤„ì¼ ìƒê°ì´ì—ìš”"],
                correct: 0,
                grammar: "ì‚¬ë™ì‚¬ (ì¤„ë‹¤ -> ì¤„ì´ë‹¤)"
            }
        ];

        // --- State ---
        let currentState = {
            currentQuestion: 0,
            score: 0,
            answers: [] // Stores { questionId, userAnswer, isCorrect }
        };

        // --- DOM Elements ---
        const screens = {
            start: document.getElementById('screen-start'),
            quiz: document.getElementById('screen-quiz'),
            result: document.getElementById('screen-result'),
            history: document.getElementById('screen-history')
        };

        const resultFooter = document.getElementById('result-footer');

        // --- Navigation Functions ---
        function showScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(el => el.classList.add('hidden'));
            resultFooter.classList.add('hidden');
            
            // Show target screen
            screens[screenName].classList.remove('hidden');
            
            if (screenName === 'result') {
                resultFooter.classList.remove('hidden');
            }
        }

        function goHome() {
            showScreen('start');
        }

        // --- Quiz Logic ---
        function startQuiz() {
            // Reset State
            currentState = {
                currentQuestion: 0,
                score: 0,
                answers: []
            };
            
            showScreen('quiz');
            renderQuestion();
        }

        function renderQuestion() {
            const qData = quizData[currentState.currentQuestion];
            const total = quizData.length;
            
            // Update UI text
            document.getElementById('question-count').textContent = `Question ${currentState.currentQuestion + 1}/${total}`;
            document.getElementById('question-text').innerHTML = `${currentState.currentQuestion + 1}. ${qData.question}`;
            
            // Update Progress Bar
            const progress = ((currentState.currentQuestion) / total) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // Render Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            qData.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-400 hover:bg-indigo-50 transition-all font-medium text-slate-700 active:scale-[0.99]";
                btn.innerHTML = `<span class="inline-block w-6 h-6 rounded-full bg-slate-200 text-xs text-center leading-6 mr-3 text-slate-500 font-bold">${index + 1}</span> ${opt}`;
                btn.onclick = () => submitAnswer(index);
                optionsContainer.appendChild(btn);
            });
        }

        function submitAnswer(selectedIndex) {
            const qData = quizData[currentState.currentQuestion];
            const isCorrect = selectedIndex === qData.correct;
            
            // 20ë¬¸ì œì´ë¯€ë¡œ 1ë¬¸ì œë‹¹ 5ì 
            if (isCorrect) currentState.score += 5;

            currentState.answers.push({
                question: qData.question,
                options: qData.options,
                userAnswer: selectedIndex,
                correctAnswer: qData.correct,
                isCorrect: isCorrect,
                grammar: qData.grammar
            });

            // Next Question or Finish
            if (currentState.currentQuestion < quizData.length - 1) {
                currentState.currentQuestion++;
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            // Update Progress to 100%
            document.getElementById('progress-bar').style.width = '100%';
            
            // Save Result
            saveResult();

            // Render Result Page
            document.getElementById('final-score').textContent = currentState.score;
            
            const msgEl = document.getElementById('score-message');
            if (currentState.score >= 90) msgEl.innerHTML = "ëŒ€ë‹¨í•´ìš”! ì™„ë²½í•©ë‹ˆë‹¤! ğŸ‰";
            else if (currentState.score >= 70) msgEl.innerHTML = "ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•´ë´ìš”. ğŸ‘";
            else msgEl.innerHTML = "ë³µìŠµì´ í•„ìš”í•´ìš”. í˜ë‚´ì„¸ìš”! ğŸ’ª";

            // Render Review List (Only Wrong Answers)
            const reviewList = document.getElementById('review-list');
            reviewList.innerHTML = '';
            
            const wrongAnswers = currentState.answers.filter(a => !a.isCorrect);

            if (wrongAnswers.length === 0) {
                reviewList.innerHTML = `
                    <div class="text-center py-6 text-green-600 bg-green-50 rounded-lg">
                        <i class="fas fa-check-circle text-3xl mb-2"></i><br>
                        í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì™„ë²½í•´ìš”!
                    </div>
                `;
            } else {
                wrongAnswers.forEach((item, idx) => {
                    const div = document.createElement('div');
                    div.className = "p-3 bg-white rounded border border-red-100 shadow-sm";
                    div.innerHTML = `
                        <p class="font-bold text-slate-800 mb-2">Q. ${item.question}</p>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-red-500 font-bold"><i class="fas fa-times"></i> ${item.options[item.userAnswer]}</span>
                            <span class="text-green-600 font-bold"><i class="fas fa-check"></i> ${item.options[item.correctAnswer]}</span>
                        </div>
                        <p class="text-xs text-slate-400 mt-2 pt-2 border-t border-slate-100 text-right">ë¬¸ë²•: ${item.grammar}</p>
                    `;
                    reviewList.appendChild(div);
                });
            }

            showScreen('result');
        }

        // --- Local Storage & History ---
        function saveResult() {
            const history = JSON.parse(localStorage.getItem('koreanGrammarQuizHistory') || '[]');
            const newRecord = {
                date: new Date().toLocaleString(),
                score: currentState.score,
                id: Date.now()
            };
            history.unshift(newRecord); // Add to top
            localStorage.setItem('koreanGrammarQuizHistory', JSON.stringify(history));
        }

        function showHistory() {
            const history = JSON.parse(localStorage.getItem('koreanGrammarQuizHistory') || '[]');
            const container = document.getElementById('history-list');
            container.innerHTML = '';

            if (history.length === 0) {
                container.innerHTML = '<div class="text-center text-slate-400 py-10"><i class="fas fa-history text-3xl mb-2"></i><br>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
                history.forEach(record => {
                    const div = document.createElement('div');
                    div.className = "bg-white p-4 rounded-xl border border-slate-200 flex justify-between items-center shadow-sm";
                    
                    let scoreClass = "text-slate-600";
                    if(record.score >= 80) scoreClass = "text-green-600";
                    else if(record.score < 60) scoreClass = "text-red-500";

                    div.innerHTML = `
                        <div>
                            <p class="text-sm font-bold text-slate-700">${record.date}</p>
                            <p class="text-xs text-slate-400">Level 3 Test</p>
                        </div>
                        <div class="text-xl font-bold ${scoreClass}">
                            ${record.score}ì 
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
            showScreen('history');
        }
    </script>
</body>
</html>