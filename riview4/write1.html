<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œêµ­ì–´ ì“°ê¸° ì—°ìŠµ (ì£¼ê´€ì‹)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f3f4f6;
        }
        .correct-box { border-color: #10b981 !important; background-color: #f0fdf4 !important; }
        .incorrect-box { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        .vietnamese { color: #64748b; font-size: 0.82rem; line-height: 1.4; margin-top: 4px; border-left: 2px solid #cbd5e1; padding-left: 8px; }
        .blank-title { color: #2563eb; font-weight: 700; border: 2px dashed #2563eb; padding: 4px 12px; border-radius: 6px; background-color: #eff6ff; display: inline-block; }
        .passage-box { background-color: #ffffff; border: 1px solid #e2e8f0; padding: 20px; border-radius: 12px; margin-top: 16px; font-size: 0.95rem; line-height: 1.7; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .highlight-blue { color: #2563eb; font-weight: 700; text-decoration: underline; }
        .highlight-yellow { background-color: #fef08a; padding: 0 4px; border-radius: 4px; font-weight: 700; color: #854d0e; }
        
        /* ì£¼ê´€ì‹ ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        #answer-input {
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }
        #answer-input:focus {
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div id="app" class="w-full max-w-md bg-white min-h-screen shadow-2xl flex flex-col relative">
        <!-- Header -->
        <div class="bg-indigo-600 p-5 text-white sticky top-0 z-30 shadow-md">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-lg font-bold">í•œêµ­ì–´ ì“°ê¸° í€´ì¦ˆ</h1>
                    <p class="text-indigo-200 text-[10px] uppercase tracking-wider">ì£¼ê´€ì‹ ë¹ˆì¹¸ ì±„ìš°ê¸°</p>
                </div>
                <button id="view-text-btn" class="bg-white/20 px-3 py-2 rounded-lg text-xs font-bold border border-white/30 active:bg-white/40 transition">
                    ğŸ“‚ ì§€ë¬¸ ë³´ê¸°
                </button>
            </div>
            <div class="mt-4 bg-indigo-900/40 rounded-full h-1 w-full overflow-hidden">
                <div id="progress-bar" class="bg-yellow-400 h-1 transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quiz-container" class="flex-grow p-5 pb-24 overflow-y-auto">
            <div id="question-area">
                <div class="flex justify-between items-center mb-4">
                    <span id="question-category" class="text-indigo-600 text-[10px] font-black uppercase bg-indigo-50 px-2 py-1 rounded">CATEGORY</span>
                    <span id="q-count" class="text-xs font-bold text-gray-400 font-mono">01/12</span>
                </div>
                
                <!-- Question Section -->
                <div class="mb-6">
                    <h2 id="question-title" class="text-base font-bold text-gray-800 leading-tight"></h2>
                    <p id="question-title-vn" class="vietnamese italic mb-4"></p>
                    
                    <div id="body-display-area">
                        <!-- Content Injected Here -->
                    </div>
                </div>
                
                <!-- Input Area -->
                <div id="input-section" class="mt-6">
                    <label class="block text-sm font-bold text-gray-600 mb-2">ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”:</label>
                    <input type="text" id="answer-input" placeholder="ì—¬ê¸°ì— ì“°ì„¸ìš”..." class="w-full p-4 rounded-xl text-lg font-medium">
                    <button id="submit-btn" class="mt-3 w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg active:bg-indigo-700 transition">
                        í™•ì¸ (Kiá»ƒm tra)
                    </button>
                </div>
            </div>

            <!-- Feedback -->
            <div id="feedback-area" class="hidden mt-8 p-5 rounded-2xl border-2 shadow-sm animate-in fade-in slide-in-from-bottom-2 duration-300">
                <div class="flex items-center mb-2">
                    <span id="feedback-icon" class="text-2xl mr-2"></span>
                    <p id="feedback-status" class="font-bold text-base"></p>
                </div>
                <div class="mb-3">
                    <span class="text-xs font-bold text-gray-400">ì •ë‹µ:</span>
                    <span id="correct-answer-display" class="ml-2 font-bold text-indigo-600"></span>
                </div>
                <p id="feedback-rationale" class="text-gray-700 text-sm mb-1"></p>
                <div id="feedback-rationale-vn" class="vietnamese font-normal border-none"></div>
                <button id="next-btn" class="mt-6 w-full bg-indigo-600 text-white py-4 rounded-xl font-bold shadow-lg active:bg-indigo-700">
                    ë‹¤ìŒ ë¬¸ì œ
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-container" class="hidden flex-grow flex flex-col p-6 overflow-y-auto">
            <div class="text-center py-8">
                <div class="text-7xl mb-4" id="result-emoji">ğŸ‰</div>
                <h2 class="text-2xl font-bold text-gray-800">í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
                <div class="text-5xl font-black text-indigo-600 my-6">
                    <span id="final-score">0</span> / 12
                </div>
            </div>

            <div class="bg-gray-50 rounded-2xl p-4 mb-8">
                <h3 class="font-bold text-gray-700 mb-4 border-b pb-2">ì‘ì„± ë‚´ìš© í™•ì¸</h3>
                <div id="result-list" class="space-y-4">
                    <!-- Results will be injected here -->
                </div>
            </div>

            <button onclick="location.reload()" class="bg-indigo-600 text-white w-full py-4 rounded-2xl font-bold shadow-xl active:bg-indigo-700 mb-10">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>

        <!-- Full Text Modal -->
        <div id="text-modal" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
            <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl max-h-[80vh] flex flex-col shadow-2xl relative">
                <div class="p-6 border-b flex justify-between items-center">
                    <h3 class="font-bold text-gray-800">ì „ì²´ ì§€ë¬¸ ë³´ê¸°</h3>
                    <button id="close-modal-btn" class="p-2 text-gray-400 bg-gray-100 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="modal-content" class="p-8 overflow-y-auto text-sm leading-loose text-gray-700 whitespace-pre-wrap"></div>
            </div>
        </div>
    </div>

    <script>
        const passages = [
            { id: 1, title: "ì—°ì•  ì¹¼ëŸ¼", template: "ì‚¬ë‘ì— ë¹ ì§„ ì—°ì¸ë“¤ì€ ì„œë¡œì˜ ì‚¬ë‘ì´ ì˜ì›í•  ê±°ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‚¬ë‘ì—ë„ {0}ê°€ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. ëœ¨ê²ê²Œ ì‚¬ë‘í•˜ë˜ ì‚¬ëŒë“¤ë„ ì‹œê°„ì´ ì§€ë‚˜ë©´ ì„¤ë ˆëŠ” ë§ˆìŒì´ ì¤„ì–´ë“¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. \n\nì´ ë•Œë¬¸ì— ì‚¬ë‘ì´ ì‹ì—ˆë‹¤ê³  ìƒê°í•´ì„œ í—¤ì–´ì§€ëŠ” ì—°ì¸ë“¤ì´ ë§ìŠµë‹ˆë‹¤. {1} ì´ê²ƒì€ ì‚¬ë‘ì´ ëë‚œ ê²ƒì´ ì•„ë‹ˆë¼ ê¹Šì–´ì§€ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. \n\në³´í†µ ì—¬ìëŠ” ë‚¨ìì˜ ë§ˆìŒì´ ë³€í–ˆë‹¤ê³  ëŠë‚„ ë•Œ {2} ìƒê°ì„ í•˜ê³ , ë‚¨ìëŠ” ì—¬ìì™€ ì„±ê²©ì´ ì•ˆ ë§ì„ ë•Œ ì´ë³„ì„ ê³ ë¯¼í•œë‹¤ê³  í•©ë‹ˆë‹¤.", answers: ["ìœ í†µ ê¸°í•œ", "ê·¸ëŸ¬ë‚˜ ì´ëŸ° ë³€í™”ëŠ”", "í—¤ì–´ì§ˆ"], questionIndices: [0, 1, 2] },
            { id: 2, title: "ëª© ê±´ê°•", template: "ìš”ì¦˜ ë§ì€ ì‚¬ëŒë“¤ì´ ëª©ì˜ í†µì¦ì„ ëŠë‚ë‹ˆë‹¤. ì»´í“¨í„°ë¥¼ ë³¼ ë•Œ ê±°ë¶ì²˜ëŸ¼ {0} ì˜ëª»ëœ ìì„¸ë¥¼ ì˜¤ë˜ ìœ ì§€í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. \n\nì´ëŸ° í†µì¦ì„ ì˜ˆë°©í•˜ë ¤ë©´ ìì„¸ êµì •ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. íŠ¹íˆ ë§‘ì€ ê³µê¸°ë¥¼ ë§ˆì‹œë©° {1} ì „ì‹ ì˜ ìì„¸ë¥¼ ë°”ë¡œì¡ëŠ” ë° ë§¤ìš° íš¨ê³¼ì ì…ë‹ˆë‹¤. \n\në˜í•œ ìŠ¤íŠ¸ë ˆì¹­ì„ {2} ê²ƒë„ ëª© ê±´ê°•ì„ ì§€í‚¤ëŠ” ì¢‹ì€ ìŠµê´€ì…ë‹ˆë‹¤.", answers: ["ëª©ì„ ì•ìœ¼ë¡œ ê¸¸ê²Œ ë¹¼ê³ ", "ê±·ê¸° ìš´ë™ì„ í•˜ë©´", "ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ëŠ”"], questionIndices: [3, 4, 5] },
            { id: 3, title: "ë™ë¬¼ ì‚¬ë‘ ë°”ìíšŒ", template: "ì €í¬ â€˜ë™ì‚¬ëª¨â€™ëŠ” {0} ì‚¬ëŒë“¤ì´ ëª¨ì—¬ì„œ ë²„ë ¤ì§„ ë™ë¬¼ì„ ëŒë³´ëŠ” ì¼ì„ í•©ë‹ˆë‹¤. ë§¤ë…„ ë°”ìíšŒë¥¼ ì—´ì–´ì„œ ë™ë¬¼ ë³´í˜¸ ê¸°ê¸ˆë„ ë§ˆë ¨í•˜ê³  ë²„ë ¤ì§„ ë™ë¬¼ì—ê²Œ ìƒˆ ì£¼ì¸ì„ ì°¾ì•„ ì£¼ê³  ìˆìŠµë‹ˆë‹¤.\n\nê²½í—˜ì´ ì—†ì–´ {1} ì—†ì„ê¹Œ ë´ ê±±ì •í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•´ ì—¬ëŸ¬ ê°€ì§€ ë„ì›€ë„ ë“œë¦½ë‹ˆë‹¤. ì´ë²ˆ ìˆ˜ìµê¸ˆì€ ë²„ë ¤ì§„ ë™ë¬¼ê³¼ {2} ë³´í˜¸í•˜ëŠ” ë° ì“°ì…ë‹ˆë‹¤.", answers: ["ë™ë¬¼ì„ ì‚¬ë‘í•˜ëŠ”", "ë™ë¬¼ì„ ì˜ ëŒë³¼ ìˆ˜", "ë©¸ì¢… ìœ„ê¸° ë™ë¬¼ì„"], questionIndices: [6, 7, 8] },
            { id: 4, title: "ì„±ê³µ ë¹„ê²°", template: "ì§ì¥ì¸ë“¤ì˜ ì„±ê³µ ë¹„ê²°ì€ í¬ê²Œ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.\n\nâ… . {0}\níšŒì‚¬ì—ì„œ ì‘ì€ ì¹œì ˆì„ ë² í‘¸ëŠ” ì‚¬ëŒì´ ë‚˜ì¤‘ì— í° ë„ì›€ì„ ë°›ì•„ ì„±ê³µí•©ë‹ˆë‹¤.\n\nâ…¡. {1}\nì§ì¥ì¸ë“¤ì€ ë§¤ë…„ í‰ê·  16ê¶Œì˜ ì±…ì„ ì½ìœ¼ë©° ì§€ì‹ì„ ìŒ“ìŠµë‹ˆë‹¤. ì§€ì‹ì„ ìŒ“ëŠ” ê²ƒì€ {2} ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.", answers: ["ì¹œì ˆí•œ ì‚¬ëŒì´ ì„±ê³µí•œë‹¤", "ê¾¸ì¤€íˆ ë…ì„œí•˜ëŠ” ì‚¬ëŒì´ ì„±ê³µí•œë‹¤", "ì„±ê³µì„ ìœ„í•´"], questionIndices: [9, 10, 11] }
        ];

        const quizData = [
            { pid: 1, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t tá»« thÃ­ch há»£p cho khoáº£ng trá»‘ng.", displayType: "inline", body: "ì‚¬ë‘ì— ë¹ ì§„ ì—°ì¸ë“¤ì€ ì‚¬ë‘ì´ ì˜ì›í•  ê±°ë¼ê³  ë¯¿ì§€ë§Œ, ì „ë¬¸ê°€ë“¤ì€ ì‚¬ë‘ì—ë„ (      )ê°€ ìˆë‹¤ê³  ë§í•©ë‹ˆë‹¤.", ans: "ìœ í†µ ê¸°í•œ", rat: "ì‹œê°„ì´ ì§€ë‚˜ë©´ ë³€í•˜ëŠ” ê²ƒì„ ìŒì‹ì— ë¹„ìœ í•œ í‘œí˜„ì…ë‹ˆë‹¤.", ratVn: "Sá»­ dá»¥ng tá»« **ìœ í†µ ê¸°í•œ** Ä‘á»ƒ so sÃ¡nh tÃ¬nh yÃªu thay Ä‘á»•i theo thá»i gian." },
            { pid: 1, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p.", displayType: "inline", body: "ì‚¬ë‘ì´ ì‹ì—ˆë‹¤ê³  ìƒê°í•´ì„œ í—¤ì–´ì§€ëŠ” ì—°ì¸ë“¤ì´ ë§ìŠµë‹ˆë‹¤. (      ) ì´ê²ƒì€ ì‚¬ë‘ì´ ëë‚œ ê²ƒì´ ì•„ë‹ˆë¼ ê¹Šì–´ì§€ëŠ” ê³¼ì • ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.", ans: "ê·¸ëŸ¬ë‚˜ ì´ëŸ° ë³€í™”ëŠ”", rat: "ì•ì˜ ë¶€ì •ì ì¸ ìƒê°ê³¼ ë°˜ëŒ€ë˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤.", ratVn: "Giáº£i thÃ­ch vá» **ë³€í™”** tá»± nhiÃªn trÃ¡i ngÆ°á»£c vá»›i Ã½ nghÄ© tiÃªu cá»±c." },
            { pid: 1, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t tá»« thÃ­ch há»£p.", displayType: "inline", body: "ì—¬ìëŠ” ë‚¨ìì˜ ë§ˆìŒì´ ë³€í–ˆë‹¤ê³  ëŠë‚„ ë•Œ (      ) ìƒê°ì„ í•˜ê³ , ë‚¨ìëŠ” ì„±ê²© ì°¨ì´ë¥¼ ëŠë‚„ ë•Œ ì´ë³„ì„ ê³ ë¯¼í•©ë‹ˆë‹¤.", ans: "í—¤ì–´ì§ˆ", rat: "'ì´ë³„'ê³¼ ê°™ì€ ì˜ë¯¸ë¥¼ ê°€ì§„ ë‹¨ì–´ì…ë‹ˆë‹¤.", ratVn: "Tá»« cÃ³ cÃ¹ng nghÄ©a vá»›i viá»‡c chia tay (**í—¤ì–´ì§ˆ**)." },
            { pid: 2, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p.", displayType: "inline", body: "ìš”ì¦˜ ì§ì¥ì¸ë“¤ì€ ëª©ì˜ í†µì¦ì´ ì‹¬í•©ë‹ˆë‹¤. ì»´í“¨í„°ë¥¼ ë³¼ ë•Œ ê±°ë¶ì²˜ëŸ¼ (      ) ì˜ëª»ëœ ìì„¸ë¥¼ ì˜¤ë˜ ìœ ì§€í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.", ans: "ëª©ì„ ì•ìœ¼ë¡œ ê¸¸ê²Œ ë¹¼ê³ ", rat: "'ê±°ë¶'ì˜ ëª¨ìŠµì—ì„œ ì—°ìƒí•  ìˆ˜ ìˆëŠ” ì˜ëª»ëœ ìì„¸ì…ë‹ˆë‹¤.", ratVn: "TÆ° tháº¿ sai mÃ  báº¡n cÃ³ thá»ƒ liÃªn tÆ°á»Ÿng tá»« hÃ¬nh áº£nh con rÃ¹a (**ê±°ë¶**)." },
            { pid: 2, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p.", displayType: "inline", body: "ìì„¸ë¥¼ ê³ ì¹˜ê¸° ìœ„í•´ì„œëŠ” ìš´ë™ì´ í•„ìš”í•©ë‹ˆë‹¤. ë§‘ì€ ê³µê¸°ë¥¼ ë§ˆì‹œë©° (      ) ì „ì‹ ì˜ ìì„¸ë¥¼ ë°”ë¡œì¡ëŠ” ë° ë§¤ìš° íš¨ê³¼ì ì…ë‹ˆë‹¤.", ans: "ê±·ê¸° ìš´ë™ì„ í•˜ë©´", rat: "ë°–ì—ì„œ í•  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ìì„¸ êµì • ìš´ë™ì…ë‹ˆë‹¤.", ratVn: "LÃ  mÃ´n thá»ƒ thao chá»‰nh tÆ° tháº¿ tiÃªu biá»ƒu táº­p á»Ÿ ngoÃ i trá»i (**ê±·ê¸° ìš´ë™**)." },
            { pid: 2, q: "ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p.", displayType: "inline", body: "ì•‰ì€ ìë¦¬ì—ì„œ ëª© ìŠ¤íŠ¸ë ˆì¹­ì„ (      ) ê²ƒë„ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤. ìì£¼ ë°˜ë³µí• ìˆ˜ë¡ ëª© ê±´ê°•ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.", ans: "ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ëŠ”", rat: "'ìì£¼' í•´ì•¼ íš¨ê³¼ê°€ ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.", ratVn: "NghÄ©a lÃ  pháº£i thá»±c hiá»‡n nhiá»u láº§n (**ì—¬ëŸ¬ ë²ˆ ë°˜ë³µí•˜ëŠ”**)." },
            { pid: 3, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ [ ë¹ˆì¹¸ ]ì— ë“¤ì–´ê°ˆ ë§ì€?", vn: "HÃ£y viáº¿t tá»« thÃ­ch há»£p cho [ khoáº£ng trá»‘ng ] bÃªn dÆ°á»›i.", displayType: "blank", body: "ì €í¬ â€˜ë™ì‚¬ëª¨â€™ëŠ” [ ë¹ˆì¹¸ ] ì‚¬ëŒë“¤ì´ ëª¨ì—¬ì„œ ë²„ë ¤ì§„ ë™ë¬¼ì„ ëŒë³´ëŠ” ì¼ì„ í•©ë‹ˆë‹¤.", ans: "ë™ë¬¼ì„ ì‚¬ë‘í•˜ëŠ”", rat: "'ë™ì‚¬ëª¨'ëŠ” 'ë™ë¬¼ì„ ì‚¬ë‘í•˜ëŠ” ì‚¬ëŒë“¤ì˜ ëª¨ì„'ì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.", ratVn: "**ë™ì‚¬ëª¨** nghÄ©a lÃ  'Há»™i nhá»¯ng ngÆ°á»i yÃªu Ä‘á»™ng váº­t'." },
            { pid: 3, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ [ ë¹ˆì¹¸ ]ì— ë“¤ì–´ê°ˆ ë§ì€?", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p cho [ khoáº£ng trá»‘ng ] bÃªn dÆ°á»›i.", displayType: "blank", body: "ê²½í—˜ì´ ì—†ì–´ [ ë¹ˆì¹¸ ] ì—†ì„ê¹Œ ë´ ê±±ì •í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•´ ì—¬ëŸ¬ ê°€ì§€ ë„ì›€ë„ ë“œë¦½ë‹ˆë‹¤.", ans: "ë™ë¬¼ì„ ì˜ ëŒë³¼ ìˆ˜", rat: "ë™ë¬¼ì„ ì²˜ìŒ í‚¤ìš°ëŠ” ì‚¬ëŒë“¤ì´ í•˜ëŠ” ê°€ì¥ í° ê±±ì •ì„ ëœ»í•©ë‹ˆë‹¤.", ratVn: "NghÄ©a lÃ  ná»—i lo láº¯ng lá»›n nháº¥t cá»§a ngÆ°á»i láº§n Ä‘áº§u nuÃ´i Ä‘á»™ng váº­t." },
            { pid: 3, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ [ ë¹ˆì¹¸ ]ì— ë“¤ì–´ê°ˆ ë§ì€?", vn: "HÃ£y viáº¿t cá»¥m tá»« thÃ­ch há»£p cho [ khoáº£ng trá»‘ng ] bÃªn dÆ°á»›i.", displayType: "blank", body: "ìˆ˜ìµê¸ˆì€ ëª¨ë‘ ë²„ë ¤ì§„ ë™ë¬¼ê³¼ ì‚¬ë¼ì§ˆ ìœ„ê¸°ì— ì²˜í•œ [ ë¹ˆì¹¸ ] ë³´í˜¸í•˜ëŠ” ë° ì“°ì…ë‹ˆë‹¤.", ans: "ë©¸ì¢… ìœ„ê¸° ë™ë¬¼ì„", rat: "ë³´í˜¸ê°€ ì‹œê¸‰í•œ, ì‚¬ë¼ì§ˆ ìœ„í—˜ì´ ìˆëŠ” ë™ë¬¼ë“¤ì„ ëœ»í•©ë‹ˆë‹¤.", ratVn: "NghÄ©a lÃ  cÃ¡c loÃ i Ä‘á»™ng váº­t cÃ³ nguy cÆ¡ biáº¿n máº¥t." },
            { pid: 4, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ ì œëª©ìœ¼ë¡œ ì•Œë§ì€ ê²ƒì€?", vn: "TiÃªu Ä‘á» nÃ o phÃ¹ há»£p nháº¥t cho Ä‘oáº¡n vÄƒn ì•„ë˜?", displayType: "title", body: "íšŒì‚¬ì—ì„œ ë™ë£Œë“¤ì—ê²Œ ì»¤í”¼ë¥¼ íƒ€ ì£¼ê±°ë‚˜ ì§ì„ ë“¤ì–´ ì£¼ëŠ” ë“±ì˜ ì‘ì€ í˜¸ì˜ë¥¼ ë² í‘¸ëŠ” ì‚¬ëŒì´ ë‚˜ì¤‘ì— ë™ë£Œë“¤ì˜ ë„ì›€ì„ ë°›ì•„ ì„±ê³µí•˜ê²Œ ë©ë‹ˆë‹¤.", ans: "ì¹œì ˆí•œ ì‚¬ëŒì´ ì„±ê³µí•œë‹¤", rat: "ë™ë£Œë¥¼ ë•ëŠ” í–‰ë™ì€ 'ì¹œì ˆ'ì— í•´ë‹¹í•©ë‹ˆë‹¤.", ratVn: "HÃ nh Ä‘á»™ng giÃºp Ä‘á»¡ Ä‘á»“ng nghiá»‡p thuá»™c vá» **ì¹œì ˆ**." },
            { pid: 4, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ ì œëª©ìœ¼ë¡œ ì•Œë§ì€ ê²ƒì€?", vn: "TiÃªu Ä‘á» nÃ o phÃ¹ há»£p nháº¥t cho Ä‘oáº¡n vÄƒn ì•„ë˜?", displayType: "title", body: "í•œêµ­ì˜ ì§ì¥ì¸ë“¤ì€ í‰ê· ì ìœ¼ë¡œ 1ë…„ì— 16ê¶Œì˜ ì±…ì„ ì½ìœ¼ë©° ì†Œì„¤ì´ë‚˜ ê²½ì œ ì„œì ì„ í†µí•´ ì§€ì‹ì„ ìŒ“ìŠµë‹ˆë‹¤.", ans: "ê¾¸ì¤€íˆ ë…ì„œí•˜ëŠ” ì‚¬ëŒì´ ì„±ê³µí•œë‹¤", rat: "ì±…ì„ ì½ê³  ì§€ì‹ì„ ìŒ“ëŠ” ê²ƒì€ 'ë…ì„œ'ì…ë‹ˆë‹¤.", ratVn: "Viá»‡c Ä‘á»c sÃ¡ch vÃ  tÃ­ch lÅ©y kiáº¿n thá»©c thuá»™c vá» **ë…ì„œ**." },
            { pid: 4, q: "ë¬¸ì œ. ì•„ë˜ ê¸€ì˜ ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ì“°ì„¸ìš”.", vn: "HÃ£y viáº¿t tá»« thÃ­ch há»£p cho khoáº£ng trá»‘ng.", displayType: "inline", body: "ì§€ê¸ˆê¹Œì§€ ì„±ê³µì„ ìœ„í•œ ë‘ ê°€ì§€ ë¹„ê²°ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì§€ì‹ì„ ìŒ“ê³  ì¹œì ˆì„ ë² í‘¸ëŠ” ê²ƒì€ (      ) ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.", ans: "ì„±ê³µì„ ìœ„í•´", rat: "ê¸€ ì „ì²´ì˜ ì£¼ì œì¸ ì§ì¥ì¸ì˜ 'ì„±ê³µ'ì„ ê°•ì¡°í•©ë‹ˆë‹¤.", ratVn: "Nháº¥n máº¡nh vÃ o **ì„±ê³µ** (thÃ nh cÃ´ng)." }
        ];

        let currentIdx = 0;
        let score = 0;
        let userRecords = []; // ì‚¬ìš©ì ì‘ë‹µ ê¸°ë¡ìš©

        const catEl = document.getElementById('question-category');
        const qCountEl = document.getElementById('q-count');
        const qTitleEl = document.getElementById('question-title');
        const qTitleVnEl = document.getElementById('question-title-vn');
        const bodyArea = document.getElementById('body-display-area');
        const inputSec = document.getElementById('input-section');
        const ansInput = document.getElementById('answer-input');
        const submitBtn = document.getElementById('submit-btn');
        const fbArea = document.getElementById('feedback-area');
        const fbStatus = document.getElementById('feedback-status');
        const fbIcon = document.getElementById('feedback-icon');
        const fbRat = document.getElementById('feedback-rationale');
        const fbRatVn = document.getElementById('feedback-rationale-vn');
        const correctAnsDisp = document.getElementById('correct-answer-display');
        const nextBtn = document.getElementById('next-btn');
        const progBar = document.getElementById('progress-bar');
        const quizCont = document.getElementById('quiz-container');
        const resCont = document.getElementById('result-container');
        const finalScoreEl = document.getElementById('final-score');
        const modal = document.getElementById('text-modal');
        const modalContent = document.getElementById('modal-content');

        function render() {
            const data = quizData[currentIdx];
            const passage = passages.find(p => p.id === data.pid);
            
            catEl.textContent = passage.title;
            qCountEl.textContent = `${(currentIdx + 1).toString().padStart(2, '0')}/${quizData.length}`;
            qTitleEl.textContent = data.q;
            qTitleVnEl.textContent = data.vn;
            
            bodyArea.innerHTML = '';
            if (data.displayType === "title") {
                bodyArea.innerHTML = `<div class="mb-3 text-center"><span class="blank-title">1. [ ì œëª© ]</span></div><div class="passage-box">${data.body}</div>`;
            } else if (data.displayType === "blank") {
                bodyArea.innerHTML = `<div class="passage-box">${data.body}</div>`;
            } else {
                bodyArea.innerHTML = `<div class="passage-box bg-slate-50 border-slate-200">${data.body}</div>`;
            }

            fbArea.classList.add('hidden');
            inputSec.classList.remove('hidden');
            ansInput.value = '';
            ansInput.disabled = false;
            submitBtn.disabled = false;
            progBar.style.width = `${(currentIdx / quizData.length) * 100}%`;
            
            setTimeout(() => ansInput.focus(), 100);
            window.scrollTo(0, 0);
        }

        function check() {
            const data = quizData[currentIdx];
            const userAns = ansInput.value.trim();
            if (!userAns) return; // ë¹ˆì¹¸ì´ë©´ ë¬´ì‹œ

            ansInput.disabled = true;
            submitBtn.disabled = true;
            inputSec.classList.add('hidden');

            const isCorrect = userAns.replace(/\s/g, '') === data.ans.replace(/\s/g, '');
            
            userRecords.push({
                question: data.body.substring(0, 50) + "...",
                userAns: userAns,
                correctAns: data.ans,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                fbIcon.innerHTML = "ğŸ¯";
                fbStatus.textContent = "ì •ë‹µì…ë‹ˆë‹¤!";
                fbStatus.className = "font-bold text-green-700";
                fbArea.className = "mt-8 p-5 rounded-2xl border-2 border-green-200 bg-green-50 block shadow-md";
                score++;
            } else {
                fbIcon.innerHTML = "ğŸ’¡";
                fbStatus.textContent = "ì˜¤ë‹µì…ë‹ˆë‹¤.";
                fbStatus.className = "font-bold text-red-700";
                fbArea.className = "mt-8 p-5 rounded-2xl border-2 border-red-200 bg-red-50 block shadow-md";
            }
            
            correctAnsDisp.textContent = data.ans;
            fbRat.textContent = data.rat;
            fbRatVn.innerHTML = data.ratVn;
            
            setTimeout(() => {
                fbArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        submitBtn.onclick = check;
        ansInput.onkeypress = (e) => { if (e.key === 'Enter') check(); };

        nextBtn.onclick = () => {
            currentIdx++;
            if (currentIdx < quizData.length) render();
            else showResults();
        };

        function showResults() {
            progBar.style.width = "100%";
            quizCont.classList.add('hidden');
            resCont.classList.remove('hidden');
            finalScoreEl.textContent = score;
            
            const emoji = document.getElementById('result-emoji');
            if (score >= 11) emoji.textContent = "ğŸ…";
            else if (score >= 8) emoji.textContent = "ğŸ¥ˆ";
            else emoji.textContent = "ğŸ“–";

            const listEl = document.getElementById('result-list');
            listEl.innerHTML = '';
            
            userRecords.forEach((rec, i) => {
                const item = document.createElement('div');
                item.className = `p-4 rounded-xl border ${rec.isCorrect ? 'correct-box' : 'incorrect-box'}`;
                item.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-gray-400">ë¬¸ì œ ${i+1}</span>
                        <span class="text-lg">${rec.isCorrect ? 'âœ…' : 'âŒ'}</span>
                    </div>
                    <div class="text-sm text-gray-600 mb-3 italic">"${rec.question}"</div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-white/50 p-2 rounded">
                            <p class="text-[10px] text-gray-400 font-bold uppercase">ë‚´ ë‹µ</p>
                            <p class="${rec.isCorrect ? 'text-green-700' : 'text-red-700'} font-bold">${rec.userAns || '(ë¹„ì–´ìˆìŒ)'}</p>
                        </div>
                        <div class="bg-white/50 p-2 rounded">
                            <p class="text-[10px] text-gray-400 font-bold uppercase">ì •ë‹µ</p>
                            <p class="text-indigo-700 font-bold">${rec.correctAns}</p>
                        </div>
                    </div>
                `;
                listEl.appendChild(item);
            });
        }

        document.getElementById('view-text-btn').onclick = () => {
            const data = quizData[currentIdx];
            const passage = passages.find(p => p.id === data.pid);
            let text = passage.template;
            const currentSubIdx = passage.questionIndices.indexOf(currentIdx);

            for (let i = 0; i < 3; i++) {
                let rep = "";
                if (i < currentSubIdx) rep = `<span class="highlight-blue">${passage.answers[i]}</span>`;
                else if (i === currentSubIdx) rep = `<span class="highlight-yellow">(        )</span>`;
                else rep = `(        )`;
                text = text.replace(`{${i}}`, rep);
            }

            modalContent.innerHTML = `
                <h4 class="font-black text-indigo-700 mb-4 text-lg border-b-2 border-indigo-100 pb-2">${passage.title}</h4>
                <div class="leading-loose text-gray-700 text-sm">${text}</div>
            `;
            modal.classList.remove('hidden');
        };

        document.getElementById('close-modal-btn').onclick = () => modal.classList.add('hidden');
        window.onclick = (e) => { if (e.target === modal) modal.classList.add('hidden'); };
        
        window.onload = render;
    </script>
</body>
</html>
