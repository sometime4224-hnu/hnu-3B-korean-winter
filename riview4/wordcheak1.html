<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œêµ­ì–´ ì–´íœ˜ í•™ìŠµ: ë¹ˆì¹¸ ì±„ìš°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-tap-highlight-color: transparent; /* ëª¨ë°”ì¼ íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
        }
        
        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ & ì„ íƒ ìŠ¤íƒ€ì¼ */
        .draggable-item {
            cursor: pointer;
            user-select: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
        }
        
        .draggable-item:active {
            transform: scale(0.95);
        }

        .drop-zone {
            transition: all 0.3s ease;
            min-width: 100px;
            height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            margin: 0 4px;
            border-bottom-width: 3px;
            cursor: pointer;
        }

        /* ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .selected-word {
            background-color: #3b82f6 !important; /* Blue-500 */
            color: white !important;
            border-color: #2563eb !important;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            animation: pulse-ring 2s infinite;
        }

        .drop-zone.active-target {
            background-color: #eff6ff; /* Blue-50 */
            border-color: #3b82f6;
            border-style: dashed;
        }

        .drop-zone.correct {
            border-color: #22c55e !important; /* Green-500 */
            background-color: #dcfce7;
            color: #15803d;
            border-style: solid;
            pointer-events: none;
        }

        .drop-zone.incorrect {
            border-color: #ef4444 !important; /* Red-500 */
            background-color: #fee2e2;
            color: #b91c1c;
            border-style: solid;
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        @keyframes pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .pop-in-animation {
            animation: pop-in 0.3s ease-out forwards;
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <!-- ìƒë‹¨ í—¤ë” & ì§„í–‰ë¥  -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center mb-2">
                <h1 class="text-xl md:text-2xl font-black text-slate-800 tracking-tight">
                    <span class="text-blue-600">í•œêµ­ì–´</span> ì–´íœ˜ í•™ìŠµ
                </h1>
                <span id="progress-text" class="text-sm font-bold text-slate-500">0% ì™„ë£Œ</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="flex-grow w-full max-w-4xl mx-auto p-4 md:p-6 pb-40">
        <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
            
            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="p-6 bg-blue-50 border-b border-blue-100">
                <div class="flex items-start gap-3">
                    <div class="bg-blue-100 p-2 rounded-full text-blue-600 shrink-0">
                        <i class="fas fa-info-circle text-xl"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-lg text-slate-800">í•™ìŠµ ë°©ë²•</h2>
                        <p class="text-slate-600 text-sm md:text-base mt-1 leading-relaxed">
                            ì•„ë˜ ë‹¨ì–´ ëª©ë¡ì—ì„œ ì•Œë§ì€ ë§ì„ ì„ íƒ(í„°ì¹˜)í•œ í›„, ë¬¸ì¥ì˜ ë¹ˆì¹¸ì„ ëˆŒëŸ¬ ì™„ì„±í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ë¬¸ì œ ëª©ë¡ -->
            <div id="questions-container" class="divide-y divide-slate-100">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¬¸ì œ ìƒì„± -->
            </div>

            <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì˜ì—­ -->
            <div class="p-6 bg-slate-50 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3 w-full sm:w-auto">
                    <button id="reset-button" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl border border-slate-300 text-slate-600 hover:bg-slate-100 hover:text-slate-900 transition font-medium text-sm">
                        <i class="fas fa-rotate-right"></i> ì´ˆê¸°í™”
                    </button>
                    <button id="save-button" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-white border border-slate-300 text-blue-600 hover:bg-blue-50 hover:border-blue-200 transition font-medium text-sm shadow-sm">
                        <i class="fas fa-save"></i> ì €ì¥
                    </button>
                </div>

                <button id="check-answers" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-blue-200 transition-transform transform hover:-translate-y-0.5 active:translate-y-0 text-base flex items-center justify-center gap-2">
                    <i class="fas fa-check"></i> ê²°ê³¼ í™•ì¸
                </button>
            </div>
            
            <!-- ê²°ê³¼ ë©”ì‹œì§€ ë° í† ìŠ¤íŠ¸ -->
            <div id="result-message" class="hidden p-4 bg-slate-800 text-white text-center font-bold text-lg animate-fade-in"></div>
        </div>
    </main>

    <!-- ë‹¨ì–´ ì„ íƒ ì˜ì—­ (Floating Bottom Sheet) -->
    <div id="word-bank-wrapper" class="fixed bottom-0 left-0 w-full z-50 transition-transform duration-300">
        <!-- ê·¸ë¦¼ì ê·¸ë¼ë°ì´ì…˜ -->
        <div class="h-8 w-full bg-gradient-to-t from-black/5 to-transparent pointer-events-none"></div>
        
        <div id="word-bank" class="bg-white/95 backdrop-blur-md border-t border-slate-200 shadow-[0_-4px_20px_rgba(0,0,0,0.08)] p-4 pb-6 md:pb-8">
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-3 px-1">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Word Bank</span>
                    <span id="selection-hint" class="text-xs text-blue-500 font-medium animate-pulse hidden">ë¹ˆì¹¸ì„ ì„ íƒí•˜ì„¸ìš”</span>
                </div>
                <div id="word-list" class="flex flex-wrap justify-center gap-2 md:gap-3 max-h-[35vh] overflow-y-auto overscroll-contain px-1 py-1">
                    <!-- ë‹¨ì–´ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 pointer-events-none transition-opacity duration-300 z-50 text-sm font-medium flex items-center gap-2">
        <i class="fas fa-info-circle"></i> <span id="toast-msg">ë©”ì‹œì§€</span>
    </div>

    <script>
        // ë°ì´í„°
        const allWords = [
            'ì¤‘ì†Œê¸°ì—…', 'ì†Œê°œíŒ…ì„ í•˜ë‹¤', 'ëª¸ì´ ê°€ë²¼ì›Œì§€ë‹¤', 'ì²­í˜¼ì„ ë°›ë‹¤', 'ë¶€í•˜ ì§ì›', 
            'ì—°ì• ê²°í˜¼', 'ì§ì¥ ìƒì‚¬', 'ì²«ëˆˆì— ë°˜í•˜ë‹¤', 'ì¥ê°€ ë‚˜ë‹¤', 'ëŒ€ê¸°ì—…'
        ];

        const allQuestions = [
            { id: 1, pre: 'ì €ëŠ”', post: 'ì—ì„œ ì¼í•˜ê³  ì‹¶ì–´ìš”. í¬ê³  ìœ ëª…í•œ íšŒì‚¬ì— ë‹¤ë‹ˆë©´ ë°°ìš¸ ì ì´ ë§ì„ ê±°ë¼ê³  ìƒê°í•´ìš”.', answer: 'ëŒ€ê¸°ì—…' },
            { id: 2, pre: 'ë‚¨ì ì¹œêµ¬ì—ê²Œ', post: '. ì‘ë…„ ë´„ì— ê²°í˜¼í•˜ìê³  í•´ì„œ ê·¸ëŸ¬ìê³  í–ˆì–´ìš”.', answer: 'ì²­í˜¼ì„ ë°›ë‹¤' },
            { id: 3, pre: 'ê¾¸ì¤€íˆ ìš”ê°€ë¥¼ í–ˆë”ë‹ˆ', post: 'ê³  ìì„¸ë„ ì¢‹ì•„ì¡Œì–´ìš”.', answer: 'ëª¸ì´ ê°€ë²¼ì›Œì§€ë‹¤' },
            { id: 4, pre: 'ì˜¤ëœë§Œì— ì¹œêµ¬ë“¤ê³¼ ì¶•êµ¬ë¥¼ í•˜ë‹¤ê°€ ë‹¤ë¦¬ì—', post: '. ìš´ë™ ì „ì— ì¤€ë¹„ ìš´ë™ì„ ì¶©ë¶„íˆ í• ê±¸ ê·¸ë¬ì–´ìš”.', answer: 'ì¥ê°€ ë‚˜ë‹¤' },
            { id: 5, pre: 'ì €ëŠ”', post: 'ì„ í–ˆì–´ìš”. ë™ì•„ë¦¬ ëª¨ì„ì—ì„œ ì•Œê²Œ ëœ í•™êµ ì„ ë°°ì™€ ì¡¸ì—…í•˜ìë§ˆì ê²°í˜¼í–ˆì–´ìš”.', answer: 'ì—°ì• ê²°í˜¼' },
            { id: 6, pre: 'ìƒˆë¡œ ë“¤ì–´ì˜¨', post: 'ë•Œë¬¸ì— ì†ìƒí•´ìš”. ì§€ê°ì„ ìì£¼ í•´ì„œ ì•¼ë‹¨ì„ ì³¤ëŠ”ë°ë„ ê³„ì† ëŠ¦ê²Œ ì˜¤ê³  ì‹¤ìˆ˜ë¥¼ í•´ìš”.', answer: 'ë¶€í•˜ ì§ì›' },
            { id: 7, pre: 'ì €ëŠ” í° íšŒì‚¬ë³´ë‹¤ëŠ” ë°œì „ ê°€ëŠ¥ì„±ì´ ë§ì€', post: 'ì—ì„œ ê²½í—˜ì„ ìŒ“ê³  ì‹¶ì–´ìš”.', answer: 'ì¤‘ì†Œê¸°ì—…' },
            { id: 8, pre: 'ì¹œêµ¬ê°€ ì¢‹ì€ ì‚¬ëŒì„ ì†Œê°œí•´ ì¤€ë‹¤ê³  í•´ì„œ ì£¼ë§ì—', post: 'ë¡œ í–ˆì–´ìš”.', answer: 'ì†Œê°œíŒ…ì„ í•˜ë‹¤' },
            { id: 9, pre: 'ìƒˆë¡œ ì˜¤ì‹ ', post: 'ëŠ” ì•„ì£¼ ê¼¼ê¼¼í•˜ê³  ì—„ê²©í•´ì„œ ì¼í•˜ê¸°ê°€ ì¡°ê¸ˆ í˜ë“¤ì–´ìš”.', answer: 'ì§ì¥ ìƒì‚¬' },
            { id: 10, pre: 'ì˜í™” ì† ë‚¨ì ì£¼ì¸ê³µì€ ì—¬ì ì£¼ì¸ê³µì„ ë³´ìë§ˆì', post: '.', answer: 'ì²«ëˆˆì— ë°˜í•˜ë‹¤' },
        ];

        // ìƒíƒœ ê´€ë¦¬
        let selectedWord = null;
        const LOCAL_STORAGE_KEY = 'korean-vocab-v2';

        // DOM ìš”ì†Œ (Null ì•ˆì „ ì ‘ê·¼ì„ ìœ„í•´ ìˆ˜ì •)
        let elements = {};

        function initElements() {
            elements = {
                questionsContainer: document.getElementById('questions-container'),
                wordList: document.getElementById('word-list'),
                checkBtn: document.getElementById('check-answers'),
                saveBtn: document.getElementById('save-button'),
                resetBtn: document.getElementById('reset-button'),
                progressBar: document.getElementById('progress-bar'),
                progressText: document.getElementById('progress-text'),
                wordBankWrapper: document.getElementById('word-bank-wrapper'),
                mainContent: document.querySelector('main'),
                selectionHint: document.getElementById('selection-hint'),
                toast: document.getElementById('toast'),
                toastMsg: document.getElementById('toast-msg')
            };
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function showToast(msg, isError = false) {
            if (!elements.toast || !elements.toastMsg) return;
            elements.toastMsg.textContent = msg;
            elements.toast.classList.remove('opacity-0');
            elements.toast.style.backgroundColor = isError ? '#ef4444' : '#1e293b';
            setTimeout(() => elements.toast?.classList.add('opacity-0'), 2500);
        }

        // ì´ˆê¸°í™” ë° ë Œë”ë§
        function init() {
            initElements();
            if (!elements.questionsContainer) {
                console.error("Critical: DOM elements not found.");
                return;
            }
            renderQuestions();
            renderWordBank();
            loadProgress();
            setupEventListeners();
            updateLayout();
        }

        function renderQuestions() {
            if (!elements.questionsContainer) return;
            elements.questionsContainer.innerHTML = '';
            
            allQuestions.forEach((q, idx) => {
                const div = document.createElement('div');
                div.className = 'p-5 md:p-6 hover:bg-slate-50 transition-colors duration-200';
                div.innerHTML = `
                    <div class="flex flex-wrap items-center leading-loose text-base md:text-lg text-slate-700 font-medium">
                        <span class="mr-2 inline-flex items-center justify-center w-6 h-6 rounded-full bg-slate-200 text-slate-600 text-xs font-bold">${idx + 1}</span>
                        <span>${q.pre}</span>
                        <div class="drop-zone bg-white border-2 border-slate-300 border-dashed rounded-lg mx-2 text-slate-500 font-bold shadow-inner" 
                             data-qid="${q.id}" role="button" aria-label="ë¹ˆì¹¸">
                             <span class="placeholder opacity-30 text-sm">ë¹ˆì¹¸</span>
                        </div>
                        <span>${q.post}</span>
                    </div>
                `;
                elements.questionsContainer.appendChild(div);
            });
        }

        function renderWordBank() {
            if (!elements.wordList) return;
            elements.wordList.innerHTML = '';
            const words = shuffle([...allWords]);
            words.forEach(word => {
                createWordElement(word, elements.wordList);
            });
        }

        function createWordElement(text, parent) {
            const btn = document.createElement('div');
            btn.className = 'draggable-item px-4 py-2.5 bg-white border border-slate-200 rounded-xl shadow-sm text-slate-700 font-bold text-sm md:text-base hover:bg-slate-50 hover:border-blue-300 hover:shadow-md';
            btn.textContent = text;
            btn.dataset.word = text;
            
            // í´ë¦­ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼/PC ê³µí†µ)
            btn.addEventListener('click', (e) => handleWordClick(e, btn));
            parent.appendChild(btn);
        }

        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë¡œì§ ê°œì„  (Null Check ì¶”ê°€)
        function handleWordClick(e, wordEl) {
            e.stopPropagation();

            // ì´ë¯¸ ì„ íƒëœ ë‹¨ì–´ ë‹¤ì‹œ í´ë¦­ ì‹œ ì„ íƒ í•´ì œ
            if (selectedWord === wordEl) {
                deselectWord();
                return;
            }

            // ë‹¤ë¥¸ ë‹¨ì–´ ì„ íƒ
            if (selectedWord) {
                selectedWord.classList.remove('selected-word');
            }

            selectedWord = wordEl;
            wordEl.classList.add('selected-word');
            
            // íŒíŠ¸ í‘œì‹œ ë° ë¹ˆì¹¸ ê°•ì¡°
            if (elements.selectionHint) elements.selectionHint.classList.remove('hidden');
            
            document.querySelectorAll('.drop-zone:empty, .drop-zone .placeholder').forEach(zone => {
                 const target = zone.closest('.drop-zone');
                 if (target) target.classList.add('active-target');
            });
        }

        function deselectWord() {
            if (selectedWord) {
                selectedWord.classList.remove('selected-word');
                selectedWord = null;
            }
            if (elements.selectionHint) elements.selectionHint.classList.add('hidden');
            document.querySelectorAll('.drop-zone').forEach(z => z.classList.remove('active-target'));
        }

        function setupEventListeners() {
            // ë¹ˆì¹¸ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('click', (e) => {
                    const existingWord = zone.querySelector('.draggable-item');
                    
                    // 1. ë‹¨ì–´ê°€ ì„ íƒëœ ìƒíƒœì—ì„œ ë¹ˆì¹¸ í´ë¦­ -> ë‹¨ì–´ ì´ë™
                    if (selectedWord) {
                        // ì´ë¯¸ ë¹ˆì¹¸ì— ë‹¤ë¥¸ ë‹¨ì–´ê°€ ìˆë‹¤ë©´? -> êµì²´ (ê¸°ì¡´ ë‹¨ì–´ëŠ” ë±…í¬ë¡œ)
                        if (existingWord) {
                            elements.wordList.appendChild(existingWord);
                        }
                        
                        // Placeholder ì œê±°
                        const placeholder = zone.querySelector('.placeholder');
                        if (placeholder) placeholder.remove();

                        // ì„ íƒëœ ë‹¨ì–´ ì´ë™
                        zone.appendChild(selectedWord);
                        selectedWord.classList.add('pop-in-animation');
                        setTimeout(() => selectedWord?.classList.remove('pop-in-animation'), 300);
                        
                        deselectWord();
                        autoSave();
                        updateProgress();
                    } 
                    // 2. ë¹ˆì¹¸ì— ìˆëŠ” ë‹¨ì–´ë¥¼ í´ë¦­ -> ë‹¨ì–´ì¥ìœ¼ë¡œ ë°˜í™˜
                    else if (existingWord) {
                        elements.wordList.appendChild(existingWord);
                        
                        // Placeholder ë³µêµ¬
                        if (zone.children.length === 0) {
                            zone.innerHTML = '<span class="placeholder opacity-30 text-sm">ë¹ˆì¹¸</span>';
                        }
                        autoSave();
                        updateProgress();
                    }
                });
            });

            // ë°°ê²½ í´ë¦­ ì‹œ ì„ íƒ í•´ì œ
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.draggable-item') && !e.target.closest('.drop-zone')) {
                    deselectWord();
                }
            });

            if (elements.checkBtn) elements.checkBtn.addEventListener('click', checkAnswers);
            if (elements.saveBtn) elements.saveBtn.addEventListener('click', () => {
                saveData();
                showToast("í•™ìŠµ ë‚´ìš©ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            });
            if (elements.resetBtn) elements.resetBtn.addEventListener('click', resetGame);
            
            // í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€ (ë ˆì´ì•„ì›ƒ ì¡°ì •)
            if (elements.wordBankWrapper) {
                const resizeObserver = new ResizeObserver(() => updateLayout());
                resizeObserver.observe(elements.wordBankWrapper);
            }
        }

        // ë ˆì´ì•„ì›ƒ ì¡°ì • (ë‹¨ì–´ì¥ì´ ì½˜í…ì¸  ê°€ë¦¬ì§€ ì•Šê²Œ)
        function updateLayout() {
            if (!elements.wordBankWrapper || !elements.mainContent) return;
            const height = elements.wordBankWrapper.offsetHeight;
            elements.mainContent.style.paddingBottom = `${height + 40}px`;
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswers() {
            let correctCount = 0;
            let total = allQuestions.length;

            document.querySelectorAll('.drop-zone').forEach(zone => {
                const qId = parseInt(zone.dataset.qid);
                const wordEl = zone.querySelector('.draggable-item');
                const question = allQuestions.find(q => q.id === qId);
                
                // ì´ˆê¸°í™”
                zone.classList.remove('correct', 'incorrect', 'border-slate-300', 'border-dashed');
                
                if (wordEl && wordEl.textContent === question.answer) {
                    // ì •ë‹µ
                    zone.classList.add('correct');
                    // ì•„ì´ì½˜ ì¶”ê°€
                    if(!zone.querySelector('.fa-check')) {
                        const icon = document.createElement('i');
                        icon.className = 'fas fa-check ml-2 text-xs';
                        zone.appendChild(icon);
                    }
                    correctCount++;
                } else {
                    // ì˜¤ë‹µ ë˜ëŠ” ë¹ˆì¹¸
                    zone.classList.add('incorrect');
                }
            });

            // const score = Math.round((correctCount / total) * 100);
            
            if (correctCount === total) {
                showToast(`ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë¬¸ì œë¥¼ ë§í˜”ìŠµë‹ˆë‹¤! ğŸ‰`);
                createConfetti();
            } else {
                showToast(`${total}ë¬¸ì œ ì¤‘ ${correctCount}ê°œ ì •ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.`, true);
            }
        }

        // ë°ì´í„° ì €ì¥/ë¡œë“œ
        function autoSave() {
            saveData();
        }

        function saveData() {
            const data = {};
            document.querySelectorAll('.drop-zone').forEach(zone => {
                const wordEl = zone.querySelector('.draggable-item');
                if (wordEl) {
                    data[zone.dataset.qid] = wordEl.textContent;
                }
            });
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        }

        function loadProgress() {
            const saved = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (!saved) return;

            try {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(qid => {
                    const wordText = data[qid];
                    // ë‹¨ì–´ì¥ì—ì„œ í•´ë‹¹ ë‹¨ì–´ ì°¾ê¸°
                    if (!elements.wordList) return;
                    const wordEl = Array.from(elements.wordList.children).find(el => el.textContent === wordText);
                    const zone = document.querySelector(`.drop-zone[data-qid="${qid}"]`);
                    
                    if (wordEl && zone) {
                        zone.querySelector('.placeholder')?.remove();
                        zone.appendChild(wordEl);
                    }
                });
                updateProgress();
            } catch (e) {
                console.error("Load error", e);
            }
        }

        function updateProgress() {
            if (!elements.progressBar || !elements.progressText) return;
            const total = allQuestions.length;
            const filled = document.querySelectorAll('.drop-zone .draggable-item').length;
            const percent = Math.round((filled / total) * 100);
            
            elements.progressBar.style.width = `${percent}%`;
            elements.progressText.textContent = `${percent}% ì™„ë£Œ`;
        }

        function resetGame() {
            if(!confirm('ëª¨ë“  ì§„í–‰ ìƒí™©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            localStorage.removeItem(LOCAL_STORAGE_KEY);
            location.reload();
        }

        // ê°„ë‹¨í•œ ì¶•í•˜ íš¨ê³¼
        function createConfetti() {
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b'];
            for(let i=0; i<50; i++) {
                const conf = document.createElement('div');
                conf.style.position = 'fixed';
                conf.style.top = '-10px';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.zIndex = '100';
                conf.style.transition = 'top 2s ease-in, transform 2s linear';
                document.body.appendChild(conf);

                setTimeout(() => {
                    conf.style.top = '100vh';
                    conf.style.transform = `rotate(${Math.random() * 360}deg)`;
                }, 100);

                setTimeout(() => conf.remove(), 2100);
            }
        }

        // ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
