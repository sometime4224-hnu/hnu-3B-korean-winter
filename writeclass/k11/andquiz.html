<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œêµ­ì–´ ì ‘ì†ì‚¬ ë§ˆë¼í†¤ V3 (ì •êµí•œ í”¼ë“œë°±)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen relative">

    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col">
        <!-- Content injected by JS -->
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Data Construction (Review for Triangle Answers) ---
        // triangle: { index: { "UserAnswer": "Specific Feedback" } }
        
        const basicQuestions = [
            { 
                id: 1, type: 'basic', 
                sentences: [{ kr: "ë¹„ê°€ ë§ì´ ì˜µë‹ˆë‹¤.", vn: "Trá»i mÆ°a to." }, { kr: "ìš°ì‚°ì„ ì¼ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ che Ã´." }], 
                answers: ["ê·¸ë˜ì„œ"], 
                // ê·¸ë¦¬ê³ : Sequence possible, but 'So' is better for cause-effect.
                triangle: { 0: { "ê·¸ë¦¬ê³ ": "ìˆœì„œë¡œëŠ” ë§ì§€ë§Œ, ì›ì¸ê³¼ ê²°ê³¼ì´ë¯€ë¡œ 'ê·¸ë˜ì„œ'ê°€ ë” ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ë¹„ê°€ ì˜¤ëŠ” 'ì›ì¸' ë•Œë¬¸ì— ìš°ì‚°ì„ ì“°ëŠ” 'ê²°ê³¼'ê°€ ìƒê²¼ìœ¼ë¯€ë¡œ 'ê·¸ë˜ì„œ'ê°€ ê°€ì¥ ì ì ˆí•©ë‹ˆë‹¤." 
            },
            { 
                id: 2, type: 'basic', 
                sentences: [{ kr: "ê¹€ì¹˜ë¥¼ ì¢‹ì•„í•©ë‹ˆë‹¤.", vn: "TÃ´i thÃ­ch Kimchi." }, { kr: "ë„ˆë¬´ ë§µìŠµë‹ˆë‹¤.", vn: "NÃ³ quÃ¡ cay." }], 
                answers: ["í•˜ì§€ë§Œ"], 
                // ê·¸ëŸ°ë°: Weak contrast/topic shift possible.
                triangle: { 0: { "ê·¸ëŸ°ë°": "'ê·¸ëŸ°ë°'ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ì•ë’¤ ë‚´ìš©ì´ ê°•í•˜ê²Œ ë°˜ëŒ€ë  ë•ŒëŠ” 'í•˜ì§€ë§Œ'ì´ ë” ì¢‹ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ì¢‹ì•„í•œë‹¤ëŠ” ê¸ì •ì  ë‚´ìš©ê³¼ ë§µë‹¤ëŠ” ë¶€ì •ì  ë‚´ìš©ì´ ëŒ€ì¡°ë˜ë¯€ë¡œ 'í•˜ì§€ë§Œ'ì„ ì”ë‹ˆë‹¤." 
            },
            { 
                id: 3, type: 'basic', 
                sentences: [{ kr: "ì•„ì¹¨ì— ì¼ì–´ë‚¬ìŠµë‹ˆë‹¤.", vn: "TÃ´i thá»©c dáº­y vÃ o buá»•i sÃ¡ng." }, { kr: "ì„¸ìˆ˜ë¥¼ í–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i rá»­a máº·t." }], 
                answers: ["ê·¸ë¦¬ê³ "], 
                // ê·¸ë˜ì„œ: Weak cause-effect (woke up so I washed), but usually just sequence.
                triangle: { 0: { "ê·¸ë˜ì„œ": "ì¼ì–´ë‚˜ì„œ ì„¸ìˆ˜í•œ ê²ƒì€ ìì—°ìŠ¤ëŸ¬ìš´ ìˆœì„œ(ê·¸ë¦¬ê³ )ì— ê°€ê¹ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "ì™œëƒí•˜ë©´", "ê·¸ë ‡ì§€ë§Œ"]], 
                explanation: "ì‹œê°„ì˜ ìˆœì„œëŒ€ë¡œ ì¼ì–´ë‚˜ëŠ” ì¼ë“¤ì„ ë‚˜ì—´í•  ë•ŒëŠ” 'ê·¸ë¦¬ê³ 'ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤." 
            },
            { 
                id: 4, type: 'basic', 
                sentences: [{ kr: "ë°±í™”ì ì— ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘áº¿n trung tÃ¢m thÆ°Æ¡ng máº¡i." }, { kr: "ì‚¬ëŒì´ ì •ë§ ë§ì•˜ìŠµë‹ˆë‹¤.", vn: "á» Ä‘Ã³ thá»±c sá»± ráº¥t Ä‘Ã´ng ngÆ°á»i." }], 
                answers: ["ê·¸ëŸ°ë°"], 
                // ê·¸ë¦¬ê³ : Simple addition.
                triangle: { 0: { "ê·¸ë¦¬ê³ ": "ë‹¨ìˆœ ë‚˜ì—´ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ìƒí™© ì „ê°œìƒ 'ê·¸ëŸ°ë°'ê°€ í›¨ì”¬ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°", "ê·¸ëŸ¬ë©´"]], 
                explanation: "ê³¼ê±°ì˜ ìƒí™©(ë°°ê²½)ì„ ì œì‹œí•˜ë©´ì„œ ë’¤ì˜ ë‚´ìš©ì„ ì†Œê°œí•  ë•Œ 'ê·¸ëŸ°ë°'ë¥¼ ìì£¼ ì”ë‹ˆë‹¤." 
            },
            { 
                id: 5, type: 'basic', 
                sentences: [{ kr: "ì‹œê°„ì´ ì—†ìŠµë‹ˆë‹¤.", vn: "TÃ´i khÃ´ng cÃ³ thá»i gian." }, { kr: "íƒì‹œë¥¼ íƒ”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i taxi." }], 
                answers: ["ê·¸ë˜ì„œ"], 
                // ê·¸ëŸ¬ë‹ˆê¹Œ: Similar logic.
                triangle: { 0: { "ê·¸ëŸ¬ë‹ˆê¹Œ": "'ê·¸ëŸ¬ë‹ˆê¹Œ'ëŠ” ë³´í†µ ìƒëŒ€ë°©ì—ê²Œ ì œì•ˆí•˜ê±°ë‚˜ ìì‹ ì˜ ì˜ì§€ë¥¼ ë§í•  ë•Œ ë” ë§ì´ ì”ë‹ˆë‹¤." } },
                options: [["í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë‹ˆê¹Œ", "ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ì‹œê°„ì´ ì—†ëŠ” ê²ƒì´ ì§ì ‘ì ì¸ ì›ì¸ì´ ë˜ì–´ íƒì‹œë¥¼ íƒ”ìœ¼ë¯€ë¡œ 'ê·¸ë˜ì„œ'ê°€ ì ì ˆí•©ë‹ˆë‹¤." 
            },
            { 
                id: 6, type: 'basic', 
                sentences: [{ kr: "í•œêµ­ì–´ë¥¼ ê³µë¶€í•©ë‹ˆë‹¤.", vn: "TÃ´i há»c tiáº¿ng HÃ n." }, { kr: "ì–´ë µìŠµë‹ˆë‹¤.", vn: "NÃ³ khÃ³." }], 
                answers: ["í•˜ì§€ë§Œ"], 
                triangle: { 0: { "ê·¸ëŸ°ë°": "ë°°ê²½ ì„¤ëª…ìœ¼ë¡œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, 'ì–´ë µë‹¤'ëŠ” ëŒ€ì¡°ì  ì˜ë¯¸ê°€ ê°•í•´ 'í•˜ì§€ë§Œ'ì´ ì¢‹ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë¦¬ê³ ", "í•˜ì§€ë§Œ", "ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ê³µë¶€í•œë‹¤ëŠ” ì‚¬ì‹¤ê³¼ ì–´ë µë‹¤ëŠ” ì‚¬ì‹¤ì€ ì„œë¡œ ìƒë°˜ë˜ëŠ” ëŠë‚Œì´ ìˆìœ¼ë¯€ë¡œ 'í•˜ì§€ë§Œ'ì„ ì”ë‹ˆë‹¤." 
            },
            { 
                id: 7, type: 'basic', 
                sentences: [{ kr: "í˜•ì€ í‚¤ê°€ í½ë‹ˆë‹¤.", vn: "Anh trai tÃ´i cao." }, { kr: "ë™ìƒì€ í‚¤ê°€ ì‘ìŠµë‹ˆë‹¤.", vn: "Em trai tÃ´i tháº¥p." }], 
                answers: ["ê·¸ëŸ°ë°"], 
                // í•˜ì§€ë§Œ: Contrast.
                triangle: { 0: { "í•˜ì§€ë§Œ": "ëŒ€ì¡°ì˜ ì˜ë¯¸ë¡œ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ë‘ ëŒ€ìƒì„ ë¹„êµ/ë‚˜ì—´í•  ë• 'ê·¸ëŸ°ë°'ê°€ ë§¤ìš° ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤." } },
                options: [["ê·¸ë˜ì„œ", "ê·¸ëŸ¬ë‹ˆê¹Œ", "ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°"]], 
                explanation: "ë‘ ëŒ€ìƒì„ ëŒ€ì¡°í•˜ì—¬ ë¹„êµ ì„¤ëª…í•  ë•ŒëŠ” 'ê·¸ëŸ°ë°'ë‚˜ 'ë°˜ë©´ì—'ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤." 
            },
            { 
                id: 8, type: 'basic', 
                sentences: [{ kr: "ë…¸ë˜ë¥¼ ë¶€ë¦…ë‹ˆë‹¤.", vn: "TÃ´i hÃ¡t." }, { kr: "ì¶¤ì„ ì¶¥ë‹ˆë‹¤.", vn: "TÃ´i nháº£y." }], 
                answers: ["ê·¸ë¦¬ê³ "], 
                triangle: {},
                options: [["í•˜ì§€ë§Œ", "ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "ì™œëƒí•˜ë©´"]], 
                explanation: "ë…¸ë˜ì™€ ì¶¤, ë‘ ê°€ì§€ í–‰ë™ì„ ë™ì‹œì— í•˜ê±°ë‚˜ ë‚˜ì—´í•˜ëŠ” ìƒí™©ì´ë¯€ë¡œ 'ê·¸ë¦¬ê³ 'ì…ë‹ˆë‹¤." 
            },
            { 
                id: 9, type: 'basic', 
                sentences: [{ kr: "ì•½ì†ì´ ìˆìŠµë‹ˆë‹¤.", vn: "TÃ´i cÃ³ háº¹n." }, { kr: "ë¨¼ì € ê°€ê² ìŠµë‹ˆë‹¤.", vn: "TÃ´i sáº½ Ä‘i trÆ°á»›c." }], 
                answers: ["ê·¸ëŸ¬ë‹ˆê¹Œ"], 
                // ê·¸ë˜ì„œ: Very common in speech.
                triangle: { 0: { "ê·¸ë˜ì„œ": "ë§í•˜ê¸°ì—ì„œëŠ” 'ê·¸ë˜ì„œ'ë„ ë§ì´ ì“°ì§€ë§Œ, ë’¤ì— ì˜ì§€/í–‰ë™ì´ ì˜¬ ë• 'ê·¸ëŸ¬ë‹ˆê¹Œ'ê°€ ë…¼ë¦¬ì ì…ë‹ˆë‹¤." } },
                options: [["í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°", "ê·¸ëŸ¬ë‹ˆê¹Œ", "ê·¸ë¦¬ê³ "]], 
                explanation: "ì•ì˜ ì‚¬ì‹¤ì´ ë’¤ì˜ í–‰ë™(ê°€ê² ë‹¤)ì˜ íŒë‹¨ ê·¼ê±°ê°€ ë  ë•ŒëŠ” 'ê·¸ëŸ¬ë‹ˆê¹Œ'ê°€ ê°€ì¥ ì •í™•í•©ë‹ˆë‹¤." 
            },
            { 
                id: 10, type: 'basic', 
                sentences: [{ kr: "ì´ ì˜·ì€ ë¹„ìŒ‰ë‹ˆë‹¤.", vn: "CÃ¡i Ã¡o nÃ y Ä‘áº¯t." }, { kr: "ì˜ˆì˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", vn: "NÃ³ khÃ´ng Ä‘áº¹p." }], 
                answers: ["ê²Œë‹¤ê°€"], 
                // ê·¸ë¦¬ê³ : Listing.
                triangle: { 0: { "ê·¸ë¦¬ê³ ": "ë‹¨ìˆœ ë‚˜ì—´ë„ ë§ì§€ë§Œ, ë¶€ì •ì ì¸ ì ì„ 'ë”í•˜ëŠ”' ëŠë‚Œì„ ì‚´ë¦¬ë ¤ë©´ 'ê²Œë‹¤ê°€'ê°€ ì¢‹ìŠµë‹ˆë‹¤." } },
                options: [["ê²Œë‹¤ê°€", "í•˜ì§€ë§Œ", "ê·¸ë˜ì„œ", "ì™œëƒí•˜ë©´"]], 
                explanation: "ì•ˆ ì¢‹ì€ ì (ë¹„ìŒˆ)ì— ë˜ ë‹¤ë¥¸ ì•ˆ ì¢‹ì€ ì (ì•ˆ ì˜ˆì¨)ì„ ë§ë¶™ì¼ ë•ŒëŠ” 'ê²Œë‹¤ê°€'ë¥¼ ì”ë‹ˆë‹¤." 
            }
        ];

        const advancedQuestions = [
            { 
                id: 11, type: 'advanced', 
                sentences: [{ kr: "ëŠ¦ì ì„ ì¤ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ ngá»§ dáº­y muá»™n." }, { kr: "ë²„ìŠ¤ë¥¼ ë†“ì³¤ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ lá»¡ xe buÃ½t." }, { kr: "íƒì‹œë¥¼ íƒ”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i taxi." }, { kr: "ì§€ê°í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ khÃ´ng Ä‘i trá»…." }], 
                answers: ["ê·¸ë˜ì„œ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ"], 
                triangle: { 
                    0: { "ê·¸ë¦¬ê³ ": "ì›ì¸ê³¼ ê²°ê³¼ ê´€ê³„ì´ë¯€ë¡œ 'ê·¸ë˜ì„œ'ê°€ ë” ì¢‹ìŠµë‹ˆë‹¤." },
                    2: { "ê·¸ëŸ°ë°": "ìƒí™© ì „í™˜ë„ ë˜ì§€ë§Œ, ê¸°ëŒ€ì™€ ë°˜ëŒ€ë˜ëŠ” ê²°ê³¼ì´ë¯€ë¡œ 'í•˜ì§€ë§Œ'ì´ ëª…í™•í•©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "ì™œëƒí•˜ë©´", "í•˜ì§€ë§Œ"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë‹ˆê¹Œ"]], 
                explanation: "ëŠ¦ì â†’ë†“ì¹¨(ì›ì¸/ê²°ê³¼ 'ê·¸ë˜ì„œ'), ë†“ì¹¨â†’íƒì‹œ(ì›ì¸/ê²°ê³¼ 'ê·¸ë˜ì„œ'), íƒì‹œ íƒâ†”ì§€ê° ì•ˆ í•¨(ë°˜ëŒ€ 'í•˜ì§€ë§Œ')." 
            },
            { 
                id: 12, type: 'advanced', 
                sentences: [{ kr: "ë¶ˆê³ ê¸°ë¥¼ ë§Œë“¤ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i muá»‘n lÃ m mÃ³n Bulgogi." }, { kr: "ê³ ê¸°ë¥¼ ìƒ€ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ mua thá»‹t." }, { kr: "ê°„ì¥ì´ ì—†ì—ˆìŠµë‹ˆë‹¤.", vn: "KhÃ´ng cÃ³ nÆ°á»›c tÆ°Æ¡ng." }, { kr: "ë§ˆíŠ¸ì— ë‹¤ì‹œ ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i láº¡i siÃªu thá»‹." }], 
                answers: ["ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ"], 
                triangle: {
                    1: { "í•˜ì§€ë§Œ": "ëŒ€ì¡°ë³´ë‹¤ëŠ” ìƒí™©ì˜ ë°œê²¬/ì „í™˜ì´ë¯€ë¡œ 'ê·¸ëŸ°ë°'ê°€ ì¡°ê¸ˆ ë” ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"]], 
                explanation: "í•˜ê³  ì‹¶ì–´ì„œ ìƒ€ê³ (ê·¸ë˜ì„œ), ìƒ€ëŠ”ë° ì—†ëŠ” ìƒí™©ì„ ë°œê²¬í–ˆê³ (ê·¸ëŸ°ë°), ì—†ì–´ì„œ ë‹¤ì‹œ ê°”ìŠµë‹ˆë‹¤(ê·¸ë˜ì„œ)." 
            },
            { 
                id: 13, type: 'advanced', 
                sentences: [{ kr: "ì†Œí’ì„ ê°€ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘á»‹nh Ä‘i dÃ£ ngoáº¡i." }, { kr: "ë¹„ê°€ ë§ì´ ì™”ìŠµë‹ˆë‹¤.", vn: "Trá»i mÆ°a to." }, { kr: "ì†Œí’ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ há»§y chuyáº¿n dÃ£ ngoáº¡i." }, { kr: "ì§‘ì—ì„œ ì˜í™”ë¥¼ ë´¤ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ xem phim á»Ÿ nhÃ ." }], 
                answers: ["ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ", "ëŒ€ì‹ ì—"], 
                triangle: {
                    0: { "í•˜ì§€ë§Œ": "ì˜ë„ì™€ ë‹¤ë¥¸ ìƒí™© ë°œìƒì´ë¯€ë¡œ 'í•˜ì§€ë§Œ'ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤." },
                    2: { "ê·¸ë¦¬ê³ ": "ë‹¨ìˆœ ìˆœì„œë¡œ ë³¼ ìˆ˜ë„ ìˆì§€ë§Œ, ì†Œí’ 'ëŒ€ì‹ ' ì˜í™”ë¥¼ ë³¸ ê²ƒì´ë¯€ë¡œ 'ëŒ€ì‹ ì—'ê°€ ê°€ì¥ ì ì ˆí•©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ", "ê·¸ëŸ¬ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ"], ["ê·¸ë¦¬ê³ ", "í•˜ì§€ë§Œ", "ëŒ€ì‹ ì—", "ì™œëƒí•˜ë©´"]], 
                explanation: "ê°€ë ¤ í–ˆëŠ”ë° ë¹„ê°€ ì™”ê³ (ê·¸ëŸ°ë°), ê·¸ë˜ì„œ ì·¨ì†Œí–ˆê³ (ê·¸ë˜ì„œ), ì†Œí’ ëŒ€ì‹  ì˜í™”ë¥¼ ë´¤ìŠµë‹ˆë‹¤(ëŒ€ì‹ ì—)." 
            },
            { 
                id: 14, type: 'advanced', 
                sentences: [{ kr: "ì—´ì‹¬íˆ ê³µë¶€í–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ há»c chÄƒm chá»‰." }, { kr: "ì‹œí—˜ì´ ì‰¬ì› ìŠµë‹ˆë‹¤.", vn: "Ká»³ thi dá»…." }, { kr: "100ì ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘Æ°á»£c 100 Ä‘iá»ƒm." }, { kr: "ê¸°ë¶„ì´ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤.", vn: "TÃ¢m tráº¡ng tÃ´i ráº¥t tá»‘t." }], 
                answers: ["ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ", "ê·¸ë˜ì„œ"], 
                triangle: {
                    0: { "ê·¸ë¦¬ê³ ": "ë‚˜ì—´ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, 'ê³µë¶€í–ˆëŠ”ë°(ì˜ˆìƒ ì™¸ë¡œ) ì‰¬ì› ë‹¤'ëŠ” ë‰˜ì•™ìŠ¤ì¸ 'ê·¸ëŸ°ë°'ê°€ ë§›ê¹”ë‚©ë‹ˆë‹¤." },
                    0: { "í•˜ì§€ë§Œ": "ê³µë¶€í•œ ê²ƒê³¼ ì‰¬ìš´ ê²ƒì´ ê¼­ ë°˜ëŒ€ëŠ” ì•„ë‹ˆì§€ë§Œ ëŒ€ì¡°ë  ìˆ˜ ìˆì–´ í—ˆìš©ë©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ê³µë¶€í–ˆëŠ”ë° ì˜ì™¸ë¡œ ì‹œí—˜ë„ ì‰¬ì› ìŠµë‹ˆë‹¤(ê·¸ëŸ°ë°/ë°°ê²½). ê·¸ë˜ì„œ ì ìˆ˜ë¥¼ ì˜ ë°›ì•˜ê³ (ê·¸ë˜ì„œ), ê²°ê³¼ì ìœ¼ë¡œ ê¸°ì©ë‹ˆë‹¤(ê·¸ë˜ì„œ)." 
            },
            { 
                id: 15, type: 'advanced', 
                sentences: [{ kr: "ì¹œêµ¬ë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ gáº·p báº¡n." }, { kr: "ì ì‹¬ì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Äƒn trÆ°a." }, { kr: "ì¹´í˜ì— ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i cÃ  phÃª." }, { kr: "ìë¦¬ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.", vn: "KhÃ´ng cÃ³ chá»— ngá»“i." }], 
                answers: ["ê·¸ë¦¬ê³ ", "ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°"], 
                triangle: {
                    0: { "ê·¸ë˜ì„œ": "ë§Œë‚˜ì„œ(ì›ì¸) ë¨¹ì—ˆë‹¤? ë³´í†µì€ ë§Œë‚˜ì„œ(ìˆœì„œ) ë¨¹ìŠµë‹ˆë‹¤. 'ê·¸ë¦¬ê³ 'ê°€ ì¢‹ìŠµë‹ˆë‹¤." },
                    2: { "í•˜ì§€ë§Œ": "ìë¦¬ê°€ ì—†ëŠ” ë¶€ì •ì  ìƒí™©ì´ë¯€ë¡œ 'í•˜ì§€ë§Œ'ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ë§Œë‚˜ê³  ë°¥ ë¨¹ê³ (ê·¸ë¦¬ê³ ), ê·¸ ë‹¤ìŒ ì¹´í˜ì— ê°”ëŠ”ë°(ê·¸ë¦¬ê³ ), ìë¦¬ê°€ ì—†ëŠ” ìƒí™©(ê·¸ëŸ°ë°)ì…ë‹ˆë‹¤." 
            },
            { 
                id: 16, type: 'advanced', 
                sentences: [{ kr: "ë¨¸ë¦¬ê°€ ì•„íŒ ìŠµë‹ˆë‹¤.", vn: "TÃ´i bá»‹ Ä‘au Ä‘áº§u." }, { kr: "ì•½ì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ uá»‘ng thuá»‘c." }, { kr: "ê³„ì† ì•„íŒ ìŠµë‹ˆë‹¤.", vn: "NÃ³ váº«n Ä‘au." }, { kr: "ë³‘ì›ì— ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘áº¿n bá»‡nh viá»‡n." }], 
                answers: ["ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ë˜ì„œ"], 
                triangle: {
                    1: { "ê·¸ëŸ°ë°": "ì•½ ë¨¹ì—ˆëŠ”ë° ê³„ì† ì•„í”ˆ ìƒí™© ì œì‹œë¡œ 'ê·¸ëŸ°ë°'ë„ í›Œë¥­í•œ ë‹µì…ë‹ˆë‹¤." },
                    1: { "ê·¸ë ‡ì§€ë§Œ": "'í•˜ì§€ë§Œ'ê³¼ ê°™ìŠµë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë ‡ì§€ë§Œ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"]], 
                explanation: "ì•„íŒŒì„œ ì•½ì„ ë¨¹ì—ˆê³ (ê·¸ë˜ì„œ), ë¨¹ì—ˆì§€ë§Œ íš¨ê³¼ê°€ ì—†ì—ˆê³ (í•˜ì§€ë§Œ), ê²°êµ­ ë³‘ì›ì— ê°”ìŠµë‹ˆë‹¤(ê·¸ë˜ì„œ)." 
            },
            { 
                id: 17, type: 'advanced', 
                sentences: [{ kr: "ì œì£¼ë„ì— ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i Ä‘áº£o Jeju." }, { kr: "ë‚ ì”¨ê°€ ì¢‹ì•˜ìŠµë‹ˆë‹¤.", vn: "Thá»i tiáº¿t Ä‘áº¹p." }, { kr: "ì‚¬ì§„ì„ ë§ì´ ì°ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ chá»¥p nhiá»u áº£nh." }, { kr: "ì¹´ë©”ë¼ë¥¼ ìƒì–´ë²„ë ¸ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ lÃ m máº¥t mÃ¡y áº£nh." }], 
                answers: ["ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°"], 
                triangle: {
                    0: { "ê·¸ë¦¬ê³ ": "ë‹¨ìˆœ ë‚˜ì—´ ê°€ëŠ¥." },
                    2: { "í•˜ì§€ë§Œ": "ì¢‹ì€ ì¼ ë’¤ì— ë‚˜ìœ ì¼ì´ ìƒê²¼ìœ¼ë¯€ë¡œ 'í•˜ì§€ë§Œ'ë„ ì •ë‹µì…ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ê°”ëŠ”ë°(ë°°ê²½) ë‚ ì”¨ê°€ ì¢‹ì•˜ê³ (ê·¸ëŸ°ë°), ì¢‹ì•„ì„œ ì°ì—ˆê³ (ê·¸ë˜ì„œ), ê·¸ëŸ°ë° ìƒì–´ë²„ë¦¬ëŠ” ì‚¬ê±´ ë°œìƒ(ê·¸ëŸ°ë°)." 
            },
            { 
                id: 18, type: 'advanced', 
                sentences: [{ kr: "ìƒì¼ì´ì—ˆìŠµë‹ˆë‹¤.", vn: "ÄÃ³ lÃ  sinh nháº­t cá»§a tÃ´i." }, { kr: "ì„ ë¬¼ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ nháº­n Ä‘Æ°á»£c quÃ ." }, { kr: "ìƒìë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ má»Ÿ há»™p." }, { kr: "ì•„ë¬´ê²ƒë„ ì—†ì—ˆìŠµë‹ˆë‹¤.", vn: "KhÃ´ng cÃ³ gÃ¬ cáº£." }], 
                answers: ["ê·¸ë˜ì„œ", "ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°"], 
                triangle: {
                    2: { "í•˜ì§€ë§Œ": "ë°˜ì „ì´ ê°•í•˜ë¯€ë¡œ 'í•˜ì§€ë§Œ'ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"]], 
                explanation: "ìƒì¼ì´ë¼ ë°›ì•˜ê³ (ê·¸ë˜ì„œ), ë°›ê³  ì—´ì—ˆê³ (ê·¸ë¦¬ê³ ), ì—´ì—ˆëŠ”ë° ë¹„ì–´ ìˆì—ˆìŠµë‹ˆë‹¤(ê·¸ëŸ°ë°)." 
            },
            { 
                id: 19, type: 'advanced', 
                sentences: [{ kr: "ë²„ìŠ¤ë¥¼ íƒ”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ lÃªn xe buÃ½t." }, { kr: "ì ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ ngá»§ thiáº¿p Ä‘i." }, { kr: "ì¢…ì ê¹Œì§€ ê°”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i Ä‘áº¿n tráº¡m cuá»‘i." }, { kr: "ì§‘ì— ëŠ¦ê²Œ ì™”ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ vá» nhÃ  muá»™n." }], 
                answers: ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "ê·¸ë˜ì„œ"], 
                triangle: {
                    0: { "ê·¸ëŸ°ë°": "íƒ”ëŠ”ë° ì ë“¤ì—ˆë‹¤ëŠ” ìƒí™© ë¬˜ì‚¬ë¡œ 'ê·¸ëŸ°ë°'ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ëŸ°ë°", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë©´"]], 
                explanation: "íƒ€ê³  ë‚˜ì„œ ì ë“¤ì—ˆê³ (ê·¸ë¦¬ê³ /ê·¸ëŸ°ë°), ì ë“¤ì–´ì„œ ì¢…ì ê¹Œì§€ ê°”ê³ (ê·¸ë˜ì„œ), ê·¸ ê²°ê³¼ ëŠ¦ì—ˆìŠµë‹ˆë‹¤(ê·¸ë˜ì„œ)." 
            },
            { 
                id: 20, type: 'advanced', 
                sentences: [{ kr: "ì‡¼í•‘ì„ í–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ Ä‘i mua sáº¯m." }, { kr: "ëˆì„ ë‹¤ ì¼ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ tiÃªu háº¿t tiá»n." }, { kr: "ë°°ê°€ ê³ íŒ ìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã³i bá»¥ng." }, { kr: "ë°¥ì„ ë¨¹ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", vn: "TÃ´i Ä‘Ã£ khÃ´ng thá»ƒ Äƒn cÆ¡m." }], 
                answers: ["ê·¸ë˜ì„œ", "ê·¸ëŸ°ë°", "ê·¸ë˜ì„œ"], 
                triangle: {
                    0: { "ê·¸ë¦¬ê³ ": "ì‡¼í•‘í•˜ê³  ëˆì„ ì¼ë‹¤(ìˆœì„œ)ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ì‡¼í•‘í•´ì„œ ì¼ë‹¤(ì¸ê³¼)ê°€ ë” ê°•í•©ë‹ˆë‹¤." },
                    1: { "í•˜ì§€ë§Œ": "ëˆ ì—†ëŠ”ë° ë°°ê³ í”ˆ ì—­ì„¤ì  ìƒí™©." }
                },
                options: [["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ¬ë©´"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ê·¸ëŸ°ë°"], ["ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ", "í•˜ì§€ë§Œ", "ì™œëƒí•˜ë©´"]], 
                explanation: "ì‡¼í•‘ì„ í•´ì„œ ë‹¤ ì¼ê³ (ê·¸ë˜ì„œ), ë‹¤ ì¼ëŠ”ë° ë°°ê°€ ê³ í”ˆ ìƒí™©ì´ê³ (ê·¸ëŸ°ë°), ëˆì´ ì—†ì–´ì„œ ëª» ë¨¹ì—ˆìŠµë‹ˆë‹¤(ê·¸ë˜ì„œ)." 
            }
        ];

        const allQuestions = [...basicQuestions, ...advancedQuestions];

        // --- State ---
        let state = {
            currentStep: 0,
            score: 0,
            showFeedback: false,
            resultStatus: 'correct', // 'correct' (O), 'triangle' (â–³), 'wrong' (X)
            selectedOptions: {}, 
            answerHistory: []
        };

        const app = document.getElementById('app');

        // --- Logic ---
        function handleSelect(option, index) {
            if (state.showFeedback) return;
            state.selectedOptions[index] = option;
            render();
        }

        function checkAnswer() {
            const currentQ = allQuestions[state.currentStep];
            const slotsNeeded = currentQ.type === 'basic' ? 1 : 3;
            
            if (Object.keys(state.selectedOptions).length < slotsNeeded) return;

            let allCorrect = true;
            let anyWrong = false;
            let triangleMessages = [];
            let userSelectionArray = [];

            for (let i = 0; i < slotsNeeded; i++) {
                const userChoice = state.selectedOptions[i];
                const bestAnswer = currentQ.answers[i];
                userSelectionArray.push(userChoice);

                if (userChoice === bestAnswer) {
                    // Correct slot
                } else if (currentQ.triangle && currentQ.triangle[i] && currentQ.triangle[i][userChoice]) {
                    // Triangle slot
                    allCorrect = false;
                    triangleMessages.push(currentQ.triangle[i][userChoice]);
                } else {
                    // Wrong slot
                    allCorrect = false;
                    anyWrong = true;
                }
            }

            // Determine final status
            let finalStatus = 'wrong';
            let scoreAdd = 0;

            if (allCorrect) {
                finalStatus = 'correct';
                scoreAdd = 1;
            } else if (!anyWrong) { // Mixed Correct and Triangle, NO Wrong
                finalStatus = 'triangle';
                scoreAdd = 0.5;
            } else {
                finalStatus = 'wrong';
                scoreAdd = 0;
            }

            // Save history
            state.answerHistory.push({
                id: currentQ.id,
                type: currentQ.type,
                status: finalStatus, // correct, triangle, wrong
                userSelection: userSelectionArray,
                correctSelection: currentQ.answers,
                explanation: currentQ.explanation,
                triangleInfos: triangleMessages,
                title: currentQ.sentences[0].kr
            });

            state.resultStatus = finalStatus;
            state.score += scoreAdd;
            state.showFeedback = true;
            render();
            
            setTimeout(() => {
                const feedbackEl = document.getElementById('feedback-section');
                if(feedbackEl) feedbackEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function nextQuestion() {
            state.showFeedback = false;
            state.selectedOptions = {};
            state.currentStep += 1;
            window.scrollTo(0, 0);
            render();
        }

        function restartQuiz() {
            state.currentStep = 0;
            state.score = 0;
            state.showFeedback = false;
            state.selectedOptions = {};
            state.answerHistory = [];
            window.scrollTo(0, 0);
            render();
        }

        // --- Render Views ---
        
        function renderHeader() {
            const progress = ((state.currentStep + 1) / allQuestions.length) * 100;
            return `
                <div class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm z-50 px-4 py-3 border-b border-slate-200 shadow-sm flex items-center justify-between max-w-md mx-auto">
                    <span class="font-bold text-slate-800 text-lg">
                        ë¬¸ì œ ${state.currentStep + 1}
                        <span class="text-slate-400 text-sm font-normal ml-1">/ ${allQuestions.length}</span>
                    </span>
                    <div class="h-2 w-24 bg-slate-200 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-600 transition-all duration-300" style="width: ${progress}%"></div>
                    </div>
                </div>
            `;
        }

        function renderConnector(index, currentQ) {
            const userAns = state.selectedOptions[index];
            const correctAns = currentQ.answers[index];
            
            if (state.showFeedback) {
                // Determine slot specific status
                let slotStatus = 'wrong';
                let triangleMsg = null;

                if (userAns === correctAns) {
                    slotStatus = 'correct';
                } else if (currentQ.triangle && currentQ.triangle[index] && currentQ.triangle[index][userAns]) {
                    slotStatus = 'triangle';
                    triangleMsg = currentQ.triangle[index][userAns];
                }

                let borderColor = 'border-red-500 bg-red-50 text-red-700';
                if (slotStatus === 'correct') borderColor = 'border-green-500 bg-green-50 text-green-700';
                if (slotStatus === 'triangle') borderColor = 'border-yellow-500 bg-yellow-50 text-yellow-800';

                return `
                    <div class="relative z-20 my-2 flex flex-col items-center">
                        <div class="px-4 py-2 rounded-lg border-2 font-bold text-lg shadow-sm ${borderColor}">
                            ${userAns}
                            ${slotStatus === 'correct' ? '<i data-lucide="check" class="inline w-4 h-4 ml-1"></i>' : ''}
                            ${slotStatus === 'triangle' ? '<span class="ml-1 text-sm">â–³</span>' : ''}
                        </div>
                        ${slotStatus !== 'correct' ? `
                            <div class="mt-1 text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">
                                ì •ë‹µ: ${correctAns}
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                const optionsHtml = currentQ.options[index].map(opt => {
                    const isSelected = state.selectedOptions[index] === opt;
                    return `
                        <button onclick="handleSelect('${opt}', ${index})" 
                            class="py-3 px-1 rounded-lg text-base font-bold transition-all ${isSelected ? 'bg-blue-600 text-white shadow-md transform scale-105' : 'bg-white text-slate-600 border border-slate-200 active:bg-slate-100'}">
                            ${opt}
                        </button>
                    `;
                }).join('');

                return `
                    <div class="relative z-20 my-2">
                        <div class="grid grid-cols-2 gap-2 bg-slate-100 p-2 rounded-xl">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
            }
        }

        function renderQuestionCard(currentQ) {
            const arrowIcon = `<div class="flex justify-center items-center py-2 text-slate-300"><i data-lucide="arrow-down" class="w-5 h-5"></i></div>`;
            
            // Build parts dynamically based on type
            let parts = [];
            
            // Sentence 1
            parts.push(`
                <div class="relative z-10 bg-blue-50/50 p-4 rounded-xl border border-blue-100 mb-2 text-center shadow-sm">
                    <p class="text-xl font-bold text-slate-800 mb-1 break-keep">${currentQ.sentences[0].kr}</p>
                    <p class="text-sm text-slate-500">${currentQ.sentences[0].vn}</p>
                </div>
            `);

            // Loop for connectors and subsequent sentences
            const slots = currentQ.type === 'basic' ? 1 : 3;
            // Sentences count is slots + 1
            for (let i = 0; i < slots; i++) {
                parts.push(`
                    <div class="relative z-10">
                        ${arrowIcon}
                        ${renderConnector(i, currentQ)}
                        ${arrowIcon}
                    </div>
                `);
                
                // Next Sentence
                const sentenceIndex = i + 1;
                const style = i >= 1 ? 'bg-purple-50/50 border-purple-100' : 'bg-blue-50/50 border-blue-100';
                
                parts.push(`
                    <div class="relative z-10 ${style} p-4 rounded-xl border mb-2 text-center shadow-sm">
                        <p class="text-xl font-bold text-slate-800 mb-1 break-keep">${currentQ.sentences[sentenceIndex].kr}</p>
                        <p class="text-sm text-slate-500">${currentQ.sentences[sentenceIndex].vn}</p>
                    </div>
                `);
            }

            return `
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mt-20 mb-4 mx-4">
                    <div class="p-5 flex flex-col relative">
                        <div class="absolute left-1/2 top-10 bottom-10 w-0.5 bg-slate-100 -translate-x-1/2 z-0 hidden sm:block"></div>
                        ${parts.join('')}
                    </div>
                </div>
            `;
        }

        function renderFeedback(currentQ) {
            if (!state.showFeedback) return '';
            
            const status = state.resultStatus; // correct, triangle, wrong
            let bgClass, borderClass, textClass, icon, title;
            
            if (status === 'correct') {
                bgClass = 'bg-green-50'; borderClass = 'border-green-200'; textClass = 'text-green-700';
                icon = 'circle-check'; title = "ì •ë‹µì…ë‹ˆë‹¤! (O)";
            } else if (status === 'triangle') {
                bgClass = 'bg-yellow-50'; borderClass = 'border-yellow-200'; textClass = 'text-yellow-700';
                icon = 'triangle-alert'; title = "ì•„ì‰¬ì›Œìš”! (â–³)";
            } else {
                bgClass = 'bg-red-50'; borderClass = 'border-red-200'; textClass = 'text-red-700';
                icon = 'circle-x'; title = "ì˜¤ë‹µì…ë‹ˆë‹¤. (X)";
            }

            // Collect specific feedback messages for Triangles
            let triangleFeedbackHtml = '';
            const lastHistory = state.answerHistory[state.answerHistory.length - 1];
            if (lastHistory && lastHistory.triangleInfos && lastHistory.triangleInfos.length > 0) {
                 triangleFeedbackHtml = `
                    <div class="mt-3 bg-white/60 p-3 rounded-lg border border-yellow-200 text-sm text-yellow-800">
                        <p class="font-bold mb-1">ğŸ’¡ ì™œ ì„¸ëª¨(â–³)ì¸ê°€ìš”?</p>
                        <ul class="list-disc list-inside space-y-1">
                            ${lastHistory.triangleInfos.map(msg => `<li>${msg}</li>`).join('')}
                        </ul>
                    </div>
                 `;
            }

            return `
                <div id="feedback-section" class="mx-4 mb-24 rounded-xl p-5 border-2 animate-fade-in ${bgClass} ${borderClass}">
                    <div class="flex items-center gap-2 mb-2">
                        <i data-lucide="${icon}" class="${textClass} w-6 h-6"></i>
                        <span class="font-bold text-lg ${textClass}">${title}</span>
                    </div>
                    
                    ${triangleFeedbackHtml}

                    <div class="mt-3 text-slate-700 text-sm leading-relaxed bg-white/60 p-3 rounded-lg border border-black/5">
                        <p class="font-bold text-slate-800 mb-1">í•´ì„¤:</p>
                        ${currentQ.explanation}
                    </div>
                </div>
            `;
        }

        function renderBottomBar(currentQ) {
            const slotsNeeded = currentQ.type === 'basic' ? 1 : 3;
            const isReady = Object.keys(state.selectedOptions).length >= slotsNeeded;
            
            let buttonHtml = '';

            if (!state.showFeedback) {
                buttonHtml = `
                    <button onclick="checkAnswer()" ${!isReady ? 'disabled' : ''}
                        class="w-full py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-bold rounded-xl text-lg shadow-lg active:scale-95 transition-all">
                        ì •ë‹µ í™•ì¸
                    </button>
                `;
            } else {
                const status = state.resultStatus;
                let btnColor = status === 'correct' ? 'bg-green-600' : (status === 'triangle' ? 'bg-yellow-600' : 'bg-red-500');
                
                buttonHtml = `
                    <button onclick="nextQuestion()"
                        class="w-full py-4 rounded-xl font-bold text-white text-lg flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all ${btnColor}">
                        ë‹¤ìŒ ë¬¸ì œ <i data-lucide="chevron-right"></i>
                    </button>
                `;
            }

            return `
                <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-slate-200 z-50 max-w-md mx-auto">
                    ${buttonHtml}
                </div>
            `;
        }

        function renderCompletion() {
            // Calculate final score
            const finalScore = state.score;
            const maxScore = allQuestions.length; // 20
            const percentage = (finalScore / maxScore) * 100;
            
            let gradeIcon, gradeColor;
            if (percentage >= 90) { gradeIcon = 'ğŸ†'; gradeColor = 'bg-yellow-100'; }
            else if (percentage >= 70) { gradeIcon = 'ğŸ‘'; gradeColor = 'bg-blue-100'; }
            else { gradeIcon = 'ğŸ’ª'; gradeColor = 'bg-slate-100'; }

            // Render History List
            const historyHtml = state.answerHistory.map((item, idx) => {
                let statusIcon, statusClass, borderColor, bgClass;
                
                if (item.status === 'correct') {
                    statusIcon = 'check'; statusClass = 'text-blue-500'; 
                    borderColor = 'border-blue-100'; bgClass = 'bg-blue-50';
                } else if (item.status === 'triangle') {
                    statusIcon = 'triangle-alert'; statusClass = 'text-yellow-500';
                    borderColor = 'border-yellow-200'; bgClass = 'bg-yellow-50';
                } else {
                    statusIcon = 'x'; statusClass = 'text-red-500';
                    borderColor = 'border-red-200'; bgClass = 'bg-red-50';
                }

                // Comparison block for non-perfect answers
                let detailHtml = '';
                if (item.status !== 'correct') {
                    detailHtml = `
                        <div class="mt-2 bg-white/60 p-2 rounded text-sm space-y-1">
                            <div class="flex gap-2"><span class="font-bold text-red-500 w-12">ì„ íƒ:</span> <span>${item.userSelection.join(', ')}</span></div>
                            <div class="flex gap-2"><span class="font-bold text-green-600 w-12">ì •ë‹µ:</span> <span>${item.correctSelection.join(', ')}</span></div>
                        </div>
                    `;
                    // If triangle, add why
                    if (item.status === 'triangle' && item.triangleInfos.length > 0) {
                        detailHtml += `
                            <div class="mt-2 text-xs text-yellow-800 font-medium">
                                ğŸ‘‰ ${item.triangleInfos[0]}
                            </div>
                        `;
                    }
                }

                return `
                    <div class="border ${borderColor} ${bgClass} rounded-xl p-4 mb-3">
                        <div class="flex justify-between items-start mb-1">
                            <div class="flex items-center gap-2">
                                <span class="text-slate-500 font-bold text-sm">#${idx + 1}</span>
                                <i data-lucide="${statusIcon}" class="${statusClass} w-4 h-4"></i>
                            </div>
                        </div>
                        <p class="font-medium text-slate-800 text-sm truncate">${item.title}...</p>
                        ${detailHtml}
                    </div>
                `;
            }).join('');

            return `
                <div class="min-h-screen bg-white flex flex-col p-6 font-sans">
                    <div class="w-full max-w-sm mx-auto text-center pt-8 pb-24">
                        <div class="w-24 h-24 ${gradeColor} rounded-full flex items-center justify-center text-5xl mx-auto mb-4 animate-bounce">
                            ${gradeIcon}
                        </div>
                        <h2 class="text-2xl font-bold text-slate-800 mb-1">í•™ìŠµ ì™„ë£Œ!</h2>
                        
                        <div class="bg-slate-50 rounded-2xl p-6 border border-slate-100 mb-8 mt-4">
                            <p class="text-slate-600 mb-1 text-sm">ì´ ì ìˆ˜</p>
                            <p class="text-4xl font-bold text-blue-600">${finalScore} <span class="text-lg text-slate-400 font-normal">/ ${maxScore}</span></p>
                        </div>

                        <div class="text-left">
                            <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
                                <i data-lucide="book-open" class="w-5 h-5 text-blue-600"></i>
                                ìƒì„¸ ë¦¬ë·°
                            </h3>
                            ${historyHtml}
                        </div>
                    </div>
                    
                    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-slate-200 z-50 max-w-md mx-auto">
                        <button onclick="restartQuiz()"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 text-lg shadow-lg active:scale-95 transition-transform">
                            <i data-lucide="refresh-cw"></i>
                            ë‹¤ì‹œ ì‹œì‘í•˜ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        // --- Main Render ---
        function render() {
            if (state.currentStep >= allQuestions.length) {
                app.innerHTML = renderCompletion();
            } else {
                const currentQ = allQuestions[state.currentStep];
                app.innerHTML = `
                    ${renderHeader()}
                    ${renderQuestionCard(currentQ)}
                    ${renderFeedback(currentQ)}
                    ${renderBottomBar(currentQ)}
                `;
            }
            lucide.createIcons();
        }

        render();
    </script>
</body>
</html>

