<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>'Në§Œí•˜ë‹¤' í¬ê¸° ë¹„êµ ê²Œì„</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --success-color: #2ECC71;
            --warning-color: #F1C40F;
            --bg-color: #F0F4F8;
            --text-color: #333;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* ë“œë˜ê·¸ ì‹œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            -webkit-user-select: none;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Header */
        header {
            padding: 15px 20px;
            background: var(--primary-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        h1 { margin: 0; font-size: 1.2rem; }
        .level-indicator { font-weight: bold; }

        /* Question Area */
        .question-area {
            padding: 20px;
            text-align: center;
            background: #E8F0FE;
            border-bottom: 2px solid #D2E3FC;
        }

        .sentence {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 10px;
            word-break: keep-all;
        }

        .instruction {
            font-size: 0.9rem;
            color: #666;
        }

        /* Play Area */
        #play-area {
            flex: 1;
            position: relative;
            background-color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: space-between;
        }

        .side-panel {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            width: 150px;
            background: #fafafa;
            border-right: 1px dashed #ccc;
        }
        
        .side-panel.right-panel {
            border-right: none;
            border-left: 1px dashed #ccc;
            width: 150px;
            background: #fafafa;
            justify-content: center;
        }

        /* Objects */
        .object-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px 0;
            transition: transform 0.2s;
        }

        .object-emoji {
            font-size: 3rem; /* ê¸°ë³¸ ì‚¬ì´ì¦ˆ */
            line-height: 1;
            cursor: pointer;
        }

        .object-label {
            margin-top: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
            background: rgba(255,255,255,0.8);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* Draggable Target */
        #draggable-target {
            position: absolute;
            font-size: 3rem;
            cursor: grab;
            z-index: 100;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
            /* ì´ˆê¸° ìœ„ì¹˜ëŠ” JSë¡œ ì„¤ì • */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            touch-action: none; /* ëª¨ë°”ì¼ í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        #draggable-target:active {
            cursor: grabbing;
        }

        /* Controls Area */
        .controls {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type=range] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }

        button#check-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #27ae60;
            transition: all 0.1s;
        }

        button#check-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 400px;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal h2 { margin-top: 0; color: var(--primary-color); }
        .modal p { font-size: 1.1rem; margin: 20px 0; }
        .modal button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
        }

        /* Success/Fail styles within modal */
        .success-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .fail-icon { font-size: 3rem; margin-bottom: 10px; display: block; }

        /* Responsive */
        @media (max-width: 600px) {
            .sentence { font-size: 1.2rem; }
            .side-panel { width: 100px; padding: 10px; }
            .object-emoji { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>'Në§Œí•˜ë‹¤' ìµíˆê¸°</h1>
        <div class="level-indicator">ë‹¨ê³„: <span id="current-level">1</span>/5</div>
    </header>

    <div class="question-area">
        <div class="sentence" id="sentence-text">ë¬¸ì¥ì„ ë¡œë”© ì¤‘...</div>
        <div class="instruction">ì˜¤ë¥¸ìª½ì˜ ë¬¼ê±´ì„ ë“œë˜ê·¸í•´ì„œ ì •ë‹µ ì˜†ì— ë†“ê³ , ìŠ¬ë¼ì´ë”ë¡œ í¬ê¸°ë¥¼ ë¹„ìŠ·í•˜ê²Œ ë§ì¶”ì„¸ìš”!</div>
    </div>

    <div id="play-area">
        <!-- Left Side: Reference Objects -->
        <div class="side-panel" id="reference-area">
            <!-- Items injected by JS -->
        </div>

        <!-- The Draggable Target -->
        <div id="draggable-target" class="object-container">
            <div class="object-emoji" id="target-emoji">â“</div>
            <div class="object-label" id="target-label">ëŒ€ìƒ</div>
        </div>
    </div>

    <div class="controls">
        <div class="slider-container">
            <span>ì‘ê²Œ</span>
            <input type="range" id="size-slider" min="0.5" max="2.5" step="0.1" value="1">
            <span>í¬ê²Œ</span>
        </div>
        <button id="check-btn">í™•ì¸</button>
    </div>

    <!-- Feedback Modal -->
    <div id="modal-feedback" class="modal">
        <div class="modal-content">
            <span id="modal-icon"></span>
            <h2 id="modal-title">ê²°ê³¼</h2>
            <p id="modal-msg">ë©”ì‹œì§€</p>
            <button id="next-btn">ë‹¤ìŒ ë¬¸ì œ</button>
        </div>
    </div>
    
    <!-- Game Clear Modal -->
    <div id="modal-clear" class="modal">
        <div class="modal-content">
            <span class="success-icon">ğŸ‰</span>
            <h2>ì°¸ ì˜í–ˆì–´ìš”!</h2>
            <p>'Në§Œí•˜ë‹¤' ê°œë…ì„ ì™„ë²½í•˜ê²Œ ì´í•´í–ˆêµ°ìš”!</p>
            <button onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    /* --- Game Data --- */
    const levels = [
        {
            sentence: "<span style='color:#E74C3C'>ëˆˆì‚¬ëŒ</span>ì´ <span style='color:#2980B9'>ì‚¬ëŒ</span>ë§Œ í•´ìš”.",
            target: { emoji: "â˜ƒï¸", label: "ëˆˆì‚¬ëŒ", id: "snowman" },
            references: [
                { emoji: "ğŸ ", label: "ì§‘", scale: 2.5, id: "house" }, // ë„ˆë¬´ í¼
                { emoji: "ğŸ§‘", label: "ì‚¬ëŒ", scale: 1.2, id: "person", isCorrect: true }, // ì •ë‹µ
                { emoji: "ğŸœ", label: "ê°œë¯¸", scale: 0.5, id: "ant" } // ë„ˆë¬´ ì‘ìŒ
            ],
            targetStartScale: 0.5, // ì‚¬ìš©ìê°€ í‚¤ì›Œì•¼ í•¨
            description: "ëˆˆì‚¬ëŒì˜ í¬ê¸°ë¥¼ ì‚¬ëŒê³¼ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ì–´ë³´ì„¸ìš”."
        },
        {
            sentence: "<span style='color:#E74C3C'>ìˆ˜ë°•</span>ì´ <span style='color:#2980B9'>ì¶•êµ¬ê³µ</span>ë§Œ í•´ìš”.",
            target: { emoji: "ğŸ‰", label: "ìˆ˜ë°•", id: "watermelon" },
            references: [
                { emoji: "âš½", label: "ì¶•êµ¬ê³µ", scale: 1.0, id: "soccer", isCorrect: true },
                { emoji: "ğŸ”ï¸", label: "ì‚°", scale: 3.0, id: "mountain" },
                { emoji: "âœï¸", label: "ì§€ìš°ê°œ", scale: 0.4, id: "eraser" }
            ],
            targetStartScale: 2.0, // ì‚¬ìš©ìê°€ ì¤„ì—¬ì•¼ í•¨
            description: "ìˆ˜ë°•ì´ ë„ˆë¬´ ì»¤ìš”! ì¶•êµ¬ê³µ í¬ê¸°ë¡œ ì¤„ì—¬ì£¼ì„¸ìš”."
        },
        {
            sentence: "<span style='color:#E74C3C'>ê°•ì•„ì§€</span>ê°€ <span style='color:#2980B9'>ê³ ì–‘ì´</span>ë§Œ í•´ìš”.",
            target: { emoji: "ğŸ•", label: "ê°•ì•„ì§€", id: "dog" },
            references: [
                { emoji: "ğŸ˜", label: "ì½”ë¼ë¦¬", scale: 2.8, id: "elephant" },
                { emoji: "ğŸ", label: "ìƒì¥", scale: 0.6, id: "mouse" },
                { emoji: "ğŸˆ", label: "ê³ ì–‘ì´", scale: 1.1, id: "cat", isCorrect: true }
            ],
            targetStartScale: 0.6, // í‚¤ì›Œì•¼ í•¨
            description: "ê°•ì•„ì§€ê°€ ê³ ì–‘ì´ë‘ ë¹„ìŠ·í•œ í¬ê¸°ê°€ ë˜ê²Œ í•´ì£¼ì„¸ìš”."
        },
        {
            sentence: "<span style='color:#E74C3C'>ì‚¬ê³¼</span>ê°€ <span style='color:#2980B9'>ì£¼ë¨¹</span>ë§Œ í•´ìš”.",
            target: { emoji: "ğŸ", label: "ì‚¬ê³¼", id: "apple" },
            references: [
                { emoji: "ğŸ‘Š", label: "ì£¼ë¨¹", scale: 0.9, id: "fist", isCorrect: true },
                { emoji: "ğŸ™†", label: "ë¨¸ë¦¬", scale: 1.8, id: "head" },
                { emoji: "ğŸ¢", label: "ë¹Œë”©", scale: 3.0, id: "building" }
            ],
            targetStartScale: 2.5, // ì¤„ì—¬ì•¼ í•¨
            description: "ì‚¬ê³¼ê°€ ì£¼ë¨¹ í¬ê¸°ì™€ ë¹„ìŠ·í•´ì•¼ í•´ìš”."
        },
        {
            sentence: "<span style='color:#E74C3C'>ë°”ìœ„</span>ê°€ <span style='color:#2980B9'>ìë™ì°¨</span>ë§Œ í•´ìš”.",
            target: { emoji: "ğŸª¨", label: "ë°”ìœ„", id: "rock" },
            references: [
                { emoji: "ğŸ", label: "ë¬´ë‹¹ë²Œë ˆ", scale: 0.3, id: "bug" },
                { emoji: "ğŸš—", label: "ìë™ì°¨", scale: 1.8, id: "car", isCorrect: true },
                { emoji: "ğŸª", label: "í–‰ì„±", scale: 4.0, id: "planet" }
            ],
            targetStartScale: 0.5, // í‚¤ì›Œì•¼ í•¨
            description: "ì—„ì²­ í° ë°”ìœ„ë„¤ìš”! ìë™ì°¨ë§Œí¼ í¬ê²Œ ë§Œë“¤ì–´ì£¼ì„¸ìš”."
        }
    ];

    /* --- State --- */
    let currentLevelIdx = 0;
    let currentScale = 1.0;
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;

    /* --- DOM Elements --- */
    const sentenceEl = document.getElementById('sentence-text');
    const instructionEl = document.querySelector('.instruction');
    const refAreaEl = document.getElementById('reference-area');
    const targetEl = document.getElementById('draggable-target');
    const targetEmojiEl = document.getElementById('target-emoji');
    const targetLabelEl = document.getElementById('target-label');
    const slider = document.getElementById('size-slider');
    const levelInd = document.getElementById('current-level');
    const checkBtn = document.getElementById('check-btn');
    const modalFeedback = document.getElementById('modal-feedback');
    const modalClear = document.getElementById('modal-clear');
    const modalMsg = document.getElementById('modal-msg');
    const modalTitle = document.getElementById('modal-title');
    const modalIcon = document.getElementById('modal-icon');
    const nextBtn = document.getElementById('next-btn');

    /* --- Game Logic --- */

    function initGame() {
        loadLevel(currentLevelIdx);
        
        // Event Listeners
        slider.addEventListener('input', updateSize);
        checkBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', nextLevel);

        // Drag Events (Mouse)
        targetEl.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        // Drag Events (Touch)
        targetEl.addEventListener('touchstart', dragStart, {passive: false});
        document.addEventListener('touchmove', drag, {passive: false});
        document.addEventListener('touchend', dragEnd);
    }

    function loadLevel(idx) {
        const level = levels[idx];
        levelInd.textContent = idx + 1;
        sentenceEl.innerHTML = level.sentence;
        
        // Reset Inputs
        currentScale = level.targetStartScale;
        slider.value = currentScale;
        
        // Setup Reference Objects
        refAreaEl.innerHTML = '';
        level.references.forEach(ref => {
            const wrapper = document.createElement('div');
            wrapper.className = 'object-container';
            wrapper.dataset.id = ref.id;
            wrapper.dataset.isCorrect = ref.isCorrect || false;
            
            const emoji = document.createElement('div');
            emoji.className = 'object-emoji';
            emoji.textContent = ref.emoji;
            emoji.style.transform = `scale(${ref.scale})`; // Set fixed visual scale
            
            const label = document.createElement('div');
            label.className = 'object-label';
            label.textContent = ref.label;

            wrapper.appendChild(emoji);
            wrapper.appendChild(label);
            refAreaEl.appendChild(wrapper);
        });

        // Setup Target
        targetEmojiEl.textContent = level.target.emoji;
        targetLabelEl.textContent = level.target.label;
        updateSize();

        // Reset Position to center right area
        const playAreaRect = document.getElementById('play-area').getBoundingClientRect();
        targetEl.style.left = '75%'; // Right side
        targetEl.style.top = '50%';
        targetEl.style.transform = `translate(-50%, -50%) scale(${currentScale})`;
    }

    function updateSize() {
        currentScale = parseFloat(slider.value);
        // Keep translate for centering anchor
        targetEl.style.transform = `translate(-50%, -50%) scale(${currentScale})`;
    }

    /* --- Drag & Drop Logic --- */
    function dragStart(e) {
        isDragging = true;
        
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        startX = clientX;
        startY = clientY;

        // Get current positions (percentage or px)
        const rect = targetEl.getBoundingClientRect();
        const parentRect = targetEl.parentElement.getBoundingClientRect();

        // Convert current Left/Top to pixels relative to parent
        initialLeft = targetEl.offsetLeft;
        initialTop = targetEl.offsetTop;

        targetEl.style.cursor = 'grabbing';
    }

    function drag(e) {
        if (!isDragging) return;
        e.preventDefault(); // Prevent scrolling on touch

        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        const deltaX = clientX - startX;
        const deltaY = clientY - startY;

        let newLeft = initialLeft + deltaX;
        let newTop = initialTop + deltaY;

        // Boundary Check (Simple)
        const parentRect = document.getElementById('play-area').getBoundingClientRect();
        // Allow some overflow but keep mostly inside
        newLeft = Math.max(0, Math.min(newLeft, parentRect.width));
        newTop = Math.max(0, Math.min(newTop, parentRect.height));

        targetEl.style.left = `${newLeft}px`;
        targetEl.style.top = `${newTop}px`;
    }

    function dragEnd() {
        isDragging = false;
        targetEl.style.cursor = 'grab';
    }

    /* --- Checking Logic --- */
    function checkAnswer() {
        const level = levels[currentLevelIdx];
        const targetRect = targetEl.getBoundingClientRect();
        const refElements = Array.from(refAreaEl.children);
        
        let correctRefEl = null;
        let correctData = null;

        // Find the DOM element for the correct reference
        refElements.forEach(el => {
            if (el.dataset.isCorrect === "true") {
                correctRefEl = el;
                // Find data object
                correctData = level.references.find(r => r.isCorrect);
            }
        });

        if (!correctRefEl) return;

        const refRect = correctRefEl.getBoundingClientRect();

        // 1. Proximity Check (Distance between centers)
        const targetCx = targetRect.left + targetRect.width / 2;
        const targetCy = targetRect.top + targetRect.height / 2;
        const refCx = refRect.left + refRect.width / 2;
        const refCy = refRect.top + refRect.height / 2;

        const distance = Math.sqrt(Math.pow(targetCx - refCx, 2) + Math.pow(targetCy - refCy, 2));
        const maxDist = (refRect.width + targetRect.width) / 1.5; // Allow generous proximity

        // 2. Size Check (Visual Height Comparison)
        // We compare the rendered height of the emoji part mostly.
        // Simplified: Compare bounding box heights.
        // Target Visual Scale vs Reference Scale logic:
        // Since base font-size is same, we can compare slider value vs reference scale defined in data.
        
        const sizeDiff = Math.abs(currentScale - correctData.scale);
        const sizeTolerance = 0.4; // Allow +/- 0.4 scale difference

        let isPosCorrect = distance < maxDist;
        let isSizeCorrect = sizeDiff < sizeTolerance;

        // Special handling: If user drags near WRONG object
        let nearWrongObj = false;
        refElements.forEach(el => {
            if (el.dataset.isCorrect !== "true") {
                const wRect = el.getBoundingClientRect();
                const wCx = wRect.left + wRect.width/2;
                const wCy = wRect.top + wRect.height/2;
                const dist = Math.sqrt(Math.pow(targetCx - wCx, 2) + Math.pow(targetCy - wCy, 2));
                if (dist < (wRect.width + targetRect.width)/2) nearWrongObj = true;
            }
        });

        if (isPosCorrect && isSizeCorrect) {
            showFeedback(true, "ì •ë‹µì…ë‹ˆë‹¤! ì™„ë²½í•´ìš”.");
        } else if (!isPosCorrect) {
            if (nearWrongObj) {
                showFeedback(false, "ë¹„êµ ëŒ€ìƒì´ í‹€ë ¸ì–´ìš”. ë¬¸ì¥ì„ ë‹¤ì‹œ ì½ì–´ë³´ì„¸ìš”.<br>ë¬´ì—‡ê³¼ í¬ê¸°ê°€ ë¹„ìŠ·í•œê°€ìš”?");
            } else {
                showFeedback(false, "ëŒ€ìƒì„ ì •ë‹µ ë¬¼ê±´ ì˜†ìœ¼ë¡œ ë” ê°€ê¹Œì´ ê°€ì ¸ê°€ì„¸ìš”.");
            }
        } else if (!isSizeCorrect) {
             if (currentScale < correctData.scale) {
                 showFeedback(false, "ìœ„ì¹˜ëŠ” ë§ì§€ë§Œ, í¬ê¸°ê°€ ë„ˆë¬´ ì‘ì•„ìš”!<br>ì¡°ê¸ˆ ë” í¬ê²Œ ë§Œë“¤ì–´ë³¼ê¹Œìš”?");
             } else {
                 showFeedback(false, "ìœ„ì¹˜ëŠ” ë§ì§€ë§Œ, í¬ê¸°ê°€ ë„ˆë¬´ ì»¤ìš”!<br>ì¡°ê¸ˆ ë” ì‘ê²Œ ë§Œë“¤ì–´ë³¼ê¹Œìš”?");
             }
        }
    }

    function showFeedback(isSuccess, msg) {
        modalFeedback.style.display = 'flex';
        modalMsg.innerHTML = msg;
        
        if (isSuccess) {
            modalTitle.textContent = "ì„±ê³µ!";
            modalTitle.style.color = "#2ECC71";
            modalIcon.textContent = "â­•";
            modalIcon.className = "success-icon";
            nextBtn.style.display = 'inline-block';
            nextBtn.onclick = () => {
                modalFeedback.style.display = 'none';
                nextLevel();
            };
        } else {
            modalTitle.textContent = "ì•„ì‰¬ì›Œìš”!";
            modalTitle.style.color = "#E74C3C";
            modalIcon.textContent = "âŒ";
            modalIcon.className = "fail-icon";
            nextBtn.textContent = "ë‹¤ì‹œ ì‹œë„";
            nextBtn.onclick = () => {
                modalFeedback.style.display = 'none';
            };
        }
    }

    function nextLevel() {
        currentLevelIdx++;
        if (currentLevelIdx >= levels.length) {
            modalClear.style.display = 'flex';
        } else {
            loadLevel(currentLevelIdx);
        }
    }

    // Start
    initGame();

</script>
</body>
</html>

