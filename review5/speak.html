<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ë§í•˜ê¸° í…ŒìŠ¤íŠ¸(ì¸í„°ë·°) ì¤€ë¹„ Â· ê³ í–¥ (KO-VI) Â· UIê°œì„ </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4F46E5; /* Indigo 600 */
      --primary-light: #EEF2FF; /* Indigo 50 */
      --vi-color: #BE185D; /* Pink 700 for Vietnamese distinctness */
    }
    body { font-family: "Noto Sans KR", -apple-system, sans-serif; background-color: #F8FAFC; color: #1E293B; }
    .font-eng { font-family: "Nunito", sans-serif; }
    
    /* Custom Scrollbar for Textareas */
    textarea::-webkit-scrollbar { width: 8px; }
    textarea::-webkit-scrollbar-track { background: transparent; }
    textarea::-webkit-scrollbar-thumb { background-color: #CBD5E1; border-radius: 4px; }
    
    /* Utilities */
    .safe-bottom { padding-bottom: max(100px, env(safe-area-inset-bottom)); }
    .card { @apply bg-white rounded-2xl border border-slate-100 shadow-sm transition-all duration-300; }
    .card:hover { @apply shadow-md border-slate-200; }
    
    /* Input Styles */
    .textarea-custom {
      @apply w-full rounded-xl border border-slate-200 bg-slate-50 p-4 text-base leading-relaxed transition-all resize-none;
    }
    .textarea-custom:focus {
      @apply outline-none border-indigo-400 ring-4 ring-indigo-50 bg-white;
    }

    /* Buttons */
    .btn-base { @apply inline-flex items-center justify-center gap-1.5 rounded-xl font-bold transition-transform active:scale-95; }
    .btn-primary { @apply btn-base bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg shadow-indigo-200; }
    .btn-ghost { @apply btn-base text-slate-600 hover:bg-slate-100; }
    .btn-soft { @apply btn-base bg-indigo-50 text-indigo-700 hover:bg-indigo-100; }
    .btn-vi { @apply btn-base bg-pink-50 text-pink-700 hover:bg-pink-100 border border-pink-100; }

    /* Chips & Badges */
    .badge { @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold; }
    .badge-dark { @apply bg-slate-800 text-white; }
    .badge-soft { @apply bg-slate-100 text-slate-600; }

    /* Custom Animations */
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .anim-slide-up { animation: slideUp 0.3s ease-out forwards; }
  </style>
</head>

<body class="safe-bottom selection:bg-indigo-100 selection:text-indigo-800">

  <!-- Top Navigation & Header -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200">
    <div class="max-w-3xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
        <div class="flex flex-col">
          <div class="flex items-center gap-2">
            <h1 class="text-lg font-bold text-slate-800 tracking-tight">ë§í•˜ê¸° í…ŒìŠ¤íŠ¸ ì¤€ë¹„</h1>
            <span id="saveChip" class="hidden sm:inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 text-[10px] font-bold border border-emerald-100 transition-colors duration-300">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
              <span id="saveStatus">ì €ì¥ë¨</span>
            </span>
          </div>
          <p class="text-xs text-slate-500 font-eng">Topic: Hometown (ê³ í–¥)</p>
        </div>

        <div class="flex items-center gap-1">
          <button id="toggleVI" class="btn-ghost p-2 rounded-lg" title="ë² íŠ¸ë‚¨ì–´ ë„ì›€ë§ í† ê¸€">
            <div class="flex flex-col items-center leading-none">
              <span class="text-[10px] text-pink-600 font-bold">VN</span>
              <span id="viState" class="text-xs font-extrabold text-slate-700">ON</span>
            </div>
          </button>
          <button id="openHelp" class="btn-ghost p-2 rounded-lg">
            <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
          </button>
          <button id="resetAll" class="btn-ghost p-2 text-rose-500 hover:bg-rose-50 rounded-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
          </button>
        </div>
      </div>

      <!-- Stepper Progress -->
      <div class="mt-3 flex items-center justify-between relative px-2">
        <div class="absolute top-1/2 left-2 right-2 h-0.5 bg-slate-200 -z-10 -translate-y-1/2 rounded"></div>
        <!-- Steps will be generated dynamically or static placeholders -->
        <button class="step-dot active w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-indigo-600 text-white shadow-lg shadow-indigo-200 ring-4 ring-white transition-all" data-q="1">1</button>
        <button class="step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-300 text-slate-400 transition-all hover:border-indigo-400" data-q="2">2</button>
        <button class="step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-300 text-slate-400 transition-all hover:border-indigo-400" data-q="3">3</button>
        <button class="step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-300 text-slate-400 transition-all hover:border-indigo-400" data-q="4">4</button>
        <button class="step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-300 text-slate-400 transition-all hover:border-indigo-400" data-q="5">5</button>
        <button class="step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-300 text-slate-400 transition-all hover:border-indigo-400" data-q="6">6</button>
      </div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6 space-y-6">
    
    <!-- Question Cards Area -->
    <div id="qPanel" class="space-y-8">
      <!-- Cards will be injected here via JS -->
    </div>

    <!-- Quick Tools Dashboard -->
    <section class="card p-5 border-t-4 border-t-indigo-500">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-sm font-bold text-slate-800 flex items-center gap-2">
          <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
          í•™ìŠµ ë„êµ¬ ëª¨ìŒ
        </h2>
        <span class="text-[10px] text-slate-400 font-eng">TOOLS</span>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-4">
        <button id="copyAll" class="btn-ghost bg-slate-50 justify-start px-4 py-3 text-sm border border-slate-200">
          <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
          ì „ì²´ ë‹µë³€ ë³µì‚¬
        </button>
        <button id="downloadTxt" class="btn-ghost bg-slate-50 justify-start px-4 py-3 text-sm border border-slate-200">
          <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
          íŒŒì¼ ì €ì¥ (.txt)
        </button>
      </div>
      
      <div class="flex items-center gap-2">
         <button id="downloadJSON" class="text-xs text-slate-400 underline decoration-slate-300 hover:text-slate-600">ë°±ì—…(.json)</button>
         <span class="text-slate-300">|</span>
         <button id="focusMode" class="text-xs text-indigo-500 font-bold hover:text-indigo-700">ì§‘ì¤‘ ëª¨ë“œ(í•˜ë‚˜ì”© ë³´ê¸°)</button>
      </div>
    </section>

    <!-- Essential Phrases (Collapsible) -->
    <details class="card group">
      <summary class="flex items-center justify-between p-4 cursor-pointer select-none">
        <div class="flex items-center gap-2">
          <div class="bg-amber-100 p-1.5 rounded-lg text-amber-600">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
          </div>
          <span class="font-bold text-sm text-slate-800">ì¸í„°ë·° í•„ìˆ˜ ì—°ê²°í‘œí˜„</span>
        </div>
        <svg class="w-5 h-5 text-slate-400 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
      </summary>
      <div class="px-4 pb-4 pt-0 grid gap-2">
        <div class="text-xs text-slate-500 mb-2">ë§í•˜ê¸° ì ìˆ˜ë¥¼ ë†’ì—¬ì£¼ëŠ” ì ‘ì†ì‚¬ë“¤ì…ë‹ˆë‹¤. ë¬¸ì¥ ì‚¬ì´ì— ìì—°ìŠ¤ëŸ½ê²Œ ë„£ìœ¼ì„¸ìš”.</div>
        <!-- Items -->
        <div class="bg-slate-50 p-3 rounded-xl border border-slate-100">
            <div class="flex justify-between items-start">
                <span class="text-sm font-bold text-slate-800">ì‹œì‘í•  ë•Œ</span>
                <span class="viHelp text-[10px] text-pink-600 font-medium bg-pink-50 px-1.5 py-0.5 rounded">TrÆ°á»›c tiÃªn...</span>
            </div>
            <p class="text-sm text-slate-600 mt-1">"ë¨¼ì € ì œ ê³ í–¥ì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤." / "ì œ ê³ í–¥ì€ ~ì— ìˆìŠµë‹ˆë‹¤."</p>
        </div>
        <div class="bg-slate-50 p-3 rounded-xl border border-slate-100">
            <div class="flex justify-between items-start">
                <span class="text-sm font-bold text-slate-800">ì´ìœ ë¥¼ ë§í•  ë•Œ</span>
                <span class="viHelp text-[10px] text-pink-600 font-medium bg-pink-50 px-1.5 py-0.5 rounded">Bá»Ÿi vÃ¬...</span>
            </div>
            <p class="text-sm text-slate-600 mt-1">"ì™œëƒí•˜ë©´ ~ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤." / "~ ë•Œë¬¸ì— ~í•©ë‹ˆë‹¤."</p>
        </div>
        <div class="bg-slate-50 p-3 rounded-xl border border-slate-100">
            <div class="flex justify-between items-start">
                <span class="text-sm font-bold text-slate-800">ì˜ˆì‹œë¥¼ ë“¤ ë•Œ</span>
                <span class="viHelp text-[10px] text-pink-600 font-medium bg-pink-50 px-1.5 py-0.5 rounded">VÃ­ dá»¥...</span>
            </div>
            <p class="text-sm text-slate-600 mt-1">"ì˜ˆë¥¼ ë“¤ë©´ ~ì…ë‹ˆë‹¤." / "íŠ¹íˆ ~ê°€ ìœ ëª…í•©ë‹ˆë‹¤."</p>
        </div>
      </div>
    </details>

    <!-- Final Script Preview -->
    <section class="card overflow-hidden">
      <div class="bg-slate-800 p-4 flex items-center justify-between">
        <h2 class="text-white font-bold text-sm flex items-center gap-2">
            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
            ìµœì¢… ì—°ìŠµ ìŠ¤í¬ë¦½íŠ¸
        </h2>
        <button id="makeScript" class="text-xs bg-indigo-500 hover:bg-indigo-400 text-white px-3 py-1.5 rounded-lg transition-colors font-bold">ìƒˆë¡œê³ ì¹¨</button>
      </div>
      <div class="p-0">
        <textarea id="scriptOut" class="w-full h-64 p-5 bg-slate-50 text-slate-800 text-sm leading-7 resize-y focus:outline-none font-medium" placeholder="ìœ„ ì§ˆë¬¸ì— ë‹µë³€ì„ ì‘ì„±í•˜ë©´ ì´ê³³ì— ì „ì²´ ëŒ€ë³¸ì´ ìƒì„±ë©ë‹ˆë‹¤." readonly></textarea>
      </div>
      <div class="bg-slate-50 p-3 border-t border-slate-200 flex gap-2">
        <button id="copyScript" class="flex-1 btn-white border border-slate-300 bg-white hover:bg-slate-50 text-slate-700 py-2 rounded-lg text-sm font-bold">ë³µì‚¬í•˜ê¸°</button>
        <button id="clearScript" class="px-4 text-xs text-slate-400 hover:text-red-500">ì§€ìš°ê¸°</button>
      </div>
    </section>

    <!-- Spacer for Bottom Nav -->
    <div class="h-8"></div>
  </main>

  <!-- Help Modal -->
  <div id="helpModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
    <div class="relative bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden anim-slide-up">
      <div class="bg-indigo-600 p-5 text-white flex justify-between items-center">
        <h3 class="font-bold text-lg">ì‚¬ìš© ê°€ì´ë“œ</h3>
        <button id="closeHelp" class="bg-white/20 hover:bg-white/30 rounded-full p-1"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
      </div>
      <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
        <div class="flex gap-4">
            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600 flex-shrink-0">1</div>
            <div>
                <p class="font-bold text-slate-800 text-sm">ì§ˆë¬¸ ìˆœì„œëŒ€ë¡œ ë‹µí•˜ê¸°</p>
                <p class="text-xs text-slate-500 mt-1">Q1ë¶€í„° Q6ê¹Œì§€ ë…¼ë¦¬ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
        <div class="flex gap-4">
            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-600 flex-shrink-0">2</div>
            <div>
                <p class="font-bold text-slate-800 text-sm">ì§§ê²Œ ë§í•˜ê¸° (Short Sentences)</p>
                <p class="text-xs text-slate-500 mt-1">ì¸í„°ë·°ëŠ” ì½ê¸°ê°€ ì•„ë‹™ë‹ˆë‹¤. 2-3 ë¬¸ì¥ìœ¼ë¡œ ì§§ê²Œ ëŠì–´ì„œ ë§í•˜ì„¸ìš”.</p>
            </div>
        </div>
        <div class="flex gap-4">
            <div class="w-8 h-8 rounded-full bg-indigo-50 flex items-center justify-center font-bold text-indigo-600 flex-shrink-0">Tip</div>
            <div>
                <p class="font-bold text-indigo-700 text-sm">ì˜ˆë¬¸ í™œìš© ê¸°ëŠ¥</p>
                <p class="text-xs text-slate-500 mt-1">'ì˜ˆë¬¸ ì‚½ì…' ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„, ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œëœ ë‹¨ì–´(ì§€ì—­ëª…, ì´ìœ  ë“±)ë§Œ ë³¸ì¸ì˜ ì´ì•¼ê¸°ë¡œ ë°”ê¾¸ì„¸ìš”.</p>
            </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation (Mobile Friendly) -->
  <nav class="fixed left-0 right-0 bottom-0 z-50 bg-white border-t border-slate-200 pb-safe shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
    <div class="max-w-3xl mx-auto px-2 py-2">
        <div class="flex items-center justify-between gap-1">
            <button class="flex-1 btn-ghost flex-col gap-1 py-2 rounded-xl" id="jumpPrev">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                <span class="text-[10px] font-bold">ì´ì „</span>
            </button>

            <!-- Quick Q Jumps -->
            <div class="flex gap-1 bg-slate-100 p-1 rounded-xl overflow-x-auto no-scrollbar">
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center bg-white text-slate-700 shadow-sm" data-q="1">Q1</button>
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center text-slate-500 hover:bg-white" data-q="2">Q2</button>
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center text-slate-500 hover:bg-white" data-q="3">Q3</button>
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center text-slate-500 hover:bg-white" data-q="4">Q4</button>
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center text-slate-500 hover:bg-white" data-q="5">Q5</button>
                <button class="bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center text-slate-500 hover:bg-white" data-q="6">Q6</button>
            </div>

            <button class="flex-1 btn-ghost flex-col gap-1 py-2 rounded-xl" id="jumpNext">
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                <span class="text-[10px] font-bold">ë‹¤ìŒ</span>
            </button>
        </div>
    </div>
  </nav>

  <!-- Toast Notification -->
  <div id="toast" class="pointer-events-none fixed top-4 left-1/2 -translate-x-1/2 z-[80] transition-all duration-300 opacity-0 translate-y-[-20px]">
    <div id="toastBox" class="pointer-events-auto bg-slate-800 text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-3">
        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        <span class="text-sm font-bold">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</span>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  // =========================
  // Data: 6 interview questions
  // =========================
  const QUESTIONS = [
    {
      id: 1,
      title: "Q1. ê³ í–¥ì€ ì–´ë””ì…ë‹ˆê¹Œ? ê°„ë‹¨íˆ ì†Œê°œí•´ ì£¼ì„¸ìš”.",
      meta: "1-2ë¬¸ì¥",
      vi: "QuÃª báº¡n á»Ÿ Ä‘Ã¢u? HÃ£y giá»›i thiá»‡u ngáº¯n gá»n.",
      prompt: "ì˜ˆ: ì œ ê³ í–¥ì€ [ë‹¤ë‚­]ì— ìˆìŠµë‹ˆë‹¤. [ë°”ë‹¤]ë¡œ ìœ ëª…í•©ë‹ˆë‹¤.",
      grammar: [
        { g:"N(ì€/ëŠ”) â€¦ì— ìˆë‹¤", ex:["ì œ ê³ í–¥ì€ í•˜ë…¸ì´ì— ìˆìŠµë‹ˆë‹¤."] },
        { g:"N(ìœ¼)ë¡œ ìœ ëª…í•˜ë‹¤", ex:["ì œ ê³ í–¥ì€ ë°”ë‹¤ë¡œ ìœ ëª…í•©ë‹ˆë‹¤."] }
      ],
      model: [
        "ì œ ê³ í–¥ì€ ë‹¤ë‚­ì— ìˆìŠµë‹ˆë‹¤.",
        "ë°”ë‹¤ì™€ ê´€ê´‘ì§€ë¡œ ìœ ëª…í•©ë‹ˆë‹¤."
      ],
      examples: [
        "ì œ ê³ í–¥ì€ í•˜ë…¸ì´ì— ìˆìŠµë‹ˆë‹¤.",
        "ì œ ê³ í–¥ì€ ë°”ë‹¤ë¡œ ìœ ëª…í•©ë‹ˆë‹¤."
      ]
    },
    {
      id: 2,
      title: "Q2. ì–´ë ¸ì„ ë•Œ ê³ í–¥ì€ ì–´ë• ìŠµë‹ˆê¹Œ?",
      meta: "2-3ë¬¸ì¥",
      vi: "Khi cÃ²n nhá», quÃª báº¡n nhÆ° tháº¿ nÃ o?",
      prompt: "ì˜ˆ: ì–´ë ¸ì„ ë•ŒëŠ” [ì¡°ìš©í•œ ë§ˆì„]ì´ì—ˆìŠµë‹ˆë‹¤. ì´ì›ƒë¼ë¦¬ [ë„ì™€ì£¼]ê³¤ í–ˆìŠµë‹ˆë‹¤.",
      grammar: [
        { g:"ì–´ë ¸ì„ ë•ŒëŠ” N(ì´)ì—ˆë‹¤", ex:["ì–´ë ¸ì„ ë•Œ ì œ ê³ í–¥ì€ ì¡°ìš©í•œ ë§ˆì„ì´ì—ˆìŠµë‹ˆë‹¤."] },
        { g:"V-ê³¤ í–ˆë‹¤", ex:["ì´ì›ƒë¼ë¦¬ ì„œë¡œ ë„ì™€ì£¼ê³¤ í–ˆìŠµë‹ˆë‹¤."] },
        { g:"A/V-ì•˜ë‹¤/ì—ˆë‹¤", ex:["ê³µê¸°ê°€ ê¹¨ë—í–ˆìŠµë‹ˆë‹¤."] }
      ],
      model: [
        "ì–´ë ¸ì„ ë•Œ ì œ ê³ í–¥ì€ ì§€ê¸ˆë³´ë‹¤ ì¡°ìš©í–ˆìŠµë‹ˆë‹¤.",
        "ê³µê¸°ê°€ ê¹¨ë—í–ˆê³  ì‚¬ëŒë“¤ì´ ì¹œì ˆí–ˆìŠµë‹ˆë‹¤.",
        "ì´ì›ƒë¼ë¦¬ ì„œë¡œ ë„ì™€ì£¼ê³¤ í–ˆìŠµë‹ˆë‹¤."
      ],
      examples: [
        "ì–´ë ¸ì„ ë•Œ ì œ ê³ í–¥ì€ ì¡°ìš©í•œ ë§ˆì„ì´ì—ˆìŠµë‹ˆë‹¤.",
        "ì´ì›ƒë¼ë¦¬ ì„œë¡œ ë„ì™€ì£¼ê³¤ í–ˆìŠµë‹ˆë‹¤."
      ]
    },
    {
      id: 3,
      title: "Q3. ì§€ê¸ˆ ê³ í–¥ì—ì„œ ê°€ì¥ í¬ê²Œ ë³€í•œ ê²ƒì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?",
      meta: "2-3ë¬¸ì¥",
      vi: "BÃ¢y giá» quÃª báº¡n thay Ä‘á»•i lá»›n nháº¥t lÃ  gÃ¬?",
      prompt: "ì˜ˆ: ìš”ì¦˜ì€ [ì•„íŒŒíŠ¸]ê°€ ëŠ˜ì—ˆìŠµë‹ˆë‹¤. ê¸¸ì´ ë„“ì–´ì ¸ì„œ [í¸í•´]ì¡ŒìŠµë‹ˆë‹¤.",
      grammar: [
        { g:"ìš”ì¦˜ì€/ì§€ê¸ˆì€", ex:["ìš”ì¦˜ì€ ì°¨ê°€ ì •ë§ ë§ìŠµë‹ˆë‹¤."] },
        { g:"N(ì´/ê°€) ëŠ˜ì—ˆë‹¤/ì¤„ì—ˆë‹¤", ex:["ì•„íŒŒíŠ¸ê°€ ë§ì´ ëŠ˜ì—ˆìŠµë‹ˆë‹¤."] },
        { g:"V-ê²Œ ë˜ë‹¤", ex:["ê¸¸ì´ ë„“ì–´ì ¸ì„œ ì´ë™ì´ í¸í•´ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤."] }
      ],
      model: [
        "ì§€ê¸ˆ ê³ í–¥ì—ì„œëŠ” ê±´ë¬¼ì´ ë§ì´ ëŠ˜ì—ˆìŠµë‹ˆë‹¤.",
        "ê¸¸ì´ ë„“ì–´ì ¸ì„œ ì´ë™ì´ í¸í•´ì¡ŒìŠµë‹ˆë‹¤.",
        "í•˜ì§€ë§Œ ì‚¬ëŒë„ ë§ì•„ì¡ŒìŠµë‹ˆë‹¤."
      ],
      examples: [
        "ì•„íŒŒíŠ¸ê°€ ë§ì´ ëŠ˜ì—ˆìŠµë‹ˆë‹¤.",
        "ì´ë™ì´ í¸í•´ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤."
      ]
    },
    {
      id: 4,
      title: "Q4. ë³€í™”ì˜ ì¥ì ê³¼ ë‹¨ì (ë¶ˆí¸)ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?",
      meta: "3-4ë¬¸ì¥",
      vi: "Æ¯u Ä‘iá»ƒm vÃ  báº¥t tiá»‡n cá»§a sá»± thay Ä‘á»•i lÃ  gÃ¬?",
      prompt: "ì˜ˆ: [ì§€í•˜ì² ] ë•ë¶„ì— ë¹¨ë¦¬ ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ [êµí†µì²´ì¦]ì´ ì‹¬í•©ë‹ˆë‹¤.",
      grammar: [
        { g:"ë•ë¶„ì—", ex:["ëŒ€ì¤‘êµí†µì´ ì¢‹ì•„ì§„ ë•ë¶„ì— ë¹¨ë¦¬ ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤."] },
        { g:"V-(ìœ¼)ã„¹ ìˆ˜ ìˆë‹¤", ex:["í¸í•˜ê²Œ ì‡¼í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."] },
        { g:"A/V-ì§€ë§Œ", ex:["í¸ë¦¬í•˜ì§€ë§Œ êµí†µì²´ì¦ì´ ì‹¬í•©ë‹ˆë‹¤."] }
      ],
      model: [
        "ì¥ì ì€ ìƒí™œì´ ë” í¸ë¦¬í•´ì§„ ê²ƒì…ë‹ˆë‹¤.",
        "ì§€í•˜ì² ì´ ìƒê¸´ ë•ë¶„ì— ë¹¨ë¦¬ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "í•˜ì§€ë§Œ êµí†µì²´ì¦ì´ ì‹¬í•´ì¡ŒìŠµë‹ˆë‹¤.",
        "ê·¸ë˜ì„œ ê³µê¸°ê°€ ë‚˜ë¹ ì§„ ëŠë‚Œë„ ìˆìŠµë‹ˆë‹¤."
      ],
      examples: [
        "ì§€í•˜ì² ì´ ìƒê¸´ ë•ë¶„ì— ë¹¨ë¦¬ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        "í¸ë¦¬í•˜ì§€ë§Œ êµí†µì²´ì¦ì´ ì‹¬í•´ì¡ŒìŠµë‹ˆë‹¤."
      ]
    },
    {
      id: 5,
      title: "Q5. ê³ í–¥ì—ì„œ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì¥ì†ŒëŠ” ì–´ë””ì´ê³ , ì™œ ê·¸ë ‡ìŠµë‹ˆê¹Œ?",
      meta: "3-4ë¬¸ì¥",
      vi: "Báº¡n thÃ­ch nÆ¡i nÃ o nháº¥t á»Ÿ quÃª vÃ  vÃ¬ sao?",
      prompt: "ì˜ˆ: ì €ëŠ” [ì‹œì¥]ì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ [í™œê¸°ì°¨ê¸°] ë•Œë¬¸ì…ë‹ˆë‹¤.",
      grammar: [
        { g:"N(ì´/ê°€) ê°€ì¥ ì¢‹ë‹¤", ex:["ì €ëŠ” ì‹œì¥ì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤."] },
        { g:"ì™œëƒí•˜ë©´ A/V-ê¸° ë•Œë¬¸", ex:["ì™œëƒí•˜ë©´ ë¶„ìœ„ê¸°ê°€ í™œê¸°ì°¨ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤."] },
        { g:"ì˜ˆë¥¼ ë“¤ë©´", ex:["ì˜ˆë¥¼ ë“¤ë©´, ì£¼ë§ì— ì‚¬ëŒë“¤ì´ ë§ì´ ëª¨ì…ë‹ˆë‹¤."] }
      ],
      model: [
        "ì €ëŠ” ê³ í–¥ì—ì„œ ì‹œì¥ì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.",
        "ì™œëƒí•˜ë©´ ë¶„ìœ„ê¸°ê°€ í™œê¸°ì°¨ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.",
        "ì˜ˆë¥¼ ë“¤ë©´, ì£¼ë§ì— ì‚¬ëŒë“¤ì´ ë§ì´ ëª¨ì—¬ì„œ ì¬ë¯¸ìˆìŠµë‹ˆë‹¤."
      ],
      examples: [
        "ì €ëŠ” ì‹œì¥ì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.",
        "ì™œëƒí•˜ë©´ ë¶„ìœ„ê¸°ê°€ í™œê¸°ì°¨ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤."
      ]
    },
    {
      id: 6,
      title: "Q6. ì•ìœ¼ë¡œ ê³ í–¥ì´ ì–´ë–»ê²Œ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆê¹Œ?",
      meta: "3-4ë¬¸ì¥",
      vi: "Báº¡n mong quÃª mÃ¬nh sáº½ nhÆ° tháº¿ nÃ o trong tÆ°Æ¡ng lai?",
      prompt: "ì˜ˆ: [ê³µê¸°]ê°€ ë” ê¹¨ë—í•´ì¡Œìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤. [ê³µì›]ì„ ë” ë§Œë“¤ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.",
      grammar: [
        { g:"V-ì•˜/ì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤", ex:["ì•ìœ¼ë¡œ ê³µê¸°ê°€ ë” ê¹¨ë—í•´ì¡Œìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤."] },
        { g:"ì™œëƒí•˜ë©´ A/V-ê¸° ë•Œë¬¸", ex:["ì™œëƒí•˜ë©´ ì£¼ë¯¼ë“¤ì´ ë” ê±´ê°•í•´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤."] },
        { g:"V-(ìœ¼)ã„¹ í•„ìš”ê°€ ìˆë‹¤", ex:["ê³µì›ì„ ë” ë§Œë“¤ í•„ìš”ê°€ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤."] }
      ],
      model: [
        "ì•ìœ¼ë¡œ ê³µê¸°ê°€ ë” ê¹¨ë—í•´ì¡Œìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.",
        "ì™œëƒí•˜ë©´ ì£¼ë¯¼ë“¤ì´ ë” ê±´ê°•í•´ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.",
        "ê³µì›ì„ ë” ë§Œë“¤ í•„ìš”ê°€ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.",
        "ê·¸ë¦¬ê³  ëŒ€ì¤‘êµí†µë„ ë” ëŠ˜ë¦¬ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤."
      ],
      examples: [
        "ì•ìœ¼ë¡œ ê³µê¸°ê°€ ë” ê¹¨ë—í•´ì¡Œìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.",
        "ê³µì›ì„ ë” ë§Œë“¤ í•„ìš”ê°€ ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤."
      ]
    }
  ];

  // =========================
  // Render Q panels (New UI)
  // =========================
  function renderPanels() {
    const container = $("qPanel");
    container.innerHTML = "";

    QUESTIONS.forEach(q => {
      const card = document.createElement("section");
      card.id = `Q${q.id}`;
      card.className = "card overflow-hidden scroll-mt-24"; // scroll-mt handles sticky header

      card.innerHTML = `
        <div class="bg-indigo-600 px-5 py-4 flex items-start justify-between">
          <div class="text-white">
            <h2 class="text-lg font-bold leading-tight">${q.title}</h2>
            <div class="flex flex-wrap items-center gap-2 mt-2">
                <span class="bg-white/20 text-white text-[10px] px-2 py-0.5 rounded backdrop-blur-sm">ê¸¸ì´: ${q.meta}</span>
                <span class="bg-white/20 text-white text-[10px] px-2 py-0.5 rounded backdrop-blur-sm">ë§í•˜ê¸° ì—°ìŠµ</span>
            </div>
          </div>
          <span class="text-6xl font-black text-white/10 absolute right-4 top-0 pointer-events-none">${q.id}</span>
        </div>
        
        <div class="p-5">
            <!-- VI Help Block -->
            <div class="viHelp bg-pink-50 border border-pink-100 rounded-xl p-3 mb-5 flex gap-3 items-start">
                <span class="bg-white text-pink-600 text-[10px] font-extrabold px-1.5 py-0.5 rounded border border-pink-100 shadow-sm mt-0.5">VI</span>
                <p class="text-sm text-pink-800 font-medium leading-relaxed">${q.vi}</p>
            </div>

            <!-- Input Area -->
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between items-end mb-2">
                        <label class="text-sm font-bold text-slate-700 flex items-center gap-1">
                            ë‚˜ì˜ ë‹µë³€
                            <span class="text-[10px] font-normal text-slate-400 ml-1">(í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì“°ê³  ë¬¸ì¥ìœ¼ë¡œ ë§Œë“œì„¸ìš”)</span>
                        </label>
                    </div>
                    
                    <!-- Keyword Input (Collapsible idea, but kept inline for simplicity) -->
                    <div class="mb-2 relative">
                         <input id="k${q.id}" class="w-full bg-slate-50 border-b border-slate-200 text-sm py-2 px-3 focus:outline-none focus:border-indigo-400 transition-colors text-slate-600" placeholder="ğŸ’¡ í‚¤ì›Œë“œ ë©”ëª¨ (ì˜ˆ: ë‹¤ë‚­, ë°”ë‹¤, ê´€ê´‘ì§€)">
                         <button class="kwToAns absolute right-2 top-1.5 text-[10px] bg-slate-200 hover:bg-slate-300 text-slate-700 px-2 py-1 rounded" data-q="${q.id}">â–¼ ë¬¸ì¥ìœ¼ë¡œ</button>
                    </div>

                    <textarea id="a${q.id}" class="textarea-custom" rows="4" placeholder="${q.prompt}"></textarea>
                </div>

                <!-- Action Buttons (Chips) -->
                <div class="flex flex-wrap gap-2">
                    <button class="exInsert btn-vi px-3 py-1.5 text-xs rounded-full" data-target="a${q.id}" data-text="${q.model.join(" ")}">
                        âœ¨ ëª¨ë²”ë‹µë³€ ë„£ê¸°
                    </button>
                    <button class="exInsert btn-soft bg-slate-100 text-slate-600 hover:bg-slate-200 px-3 py-1.5 text-xs rounded-full" data-target="a${q.id}" data-text="${q.examples[0]}">
                        ì˜ˆë¬¸ 1
                    </button>
                    <button class="exInsert btn-soft bg-slate-100 text-slate-600 hover:bg-slate-200 px-3 py-1.5 text-xs rounded-full" data-target="a${q.id}" data-text="${q.examples[1] || q.examples[0]}">
                        ì˜ˆë¬¸ 2
                    </button>
                </div>
            </div>

            <!-- Grammar Accordion -->
            <details class="group mt-6 border-t border-slate-100 pt-4">
                <summary class="flex items-center text-xs font-bold text-slate-500 cursor-pointer hover:text-indigo-600 transition-colors list-none">
                    <svg class="w-4 h-4 mr-1 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    ì¶”ì²œ ë¬¸ë²• ë³´ê¸° (Grammar)
                </summary>
                <div class="mt-3 pl-2 space-y-2 border-l-2 border-slate-100">
                    ${q.grammar.map(x => `
                        <div class="text-sm">
                            <span class="font-bold text-indigo-700 bg-indigo-50 px-1 rounded">${x.g}</span>
                            <p class="text-xs text-slate-600 mt-1 pl-1">${x.ex.join(" / ")}</p>
                        </div>
                    `).join("")}
                    <p class="viHelp text-[10px] text-pink-500 mt-2 pl-1 italic">Má»Ÿ pháº§n nÃ y Ä‘á»ƒ dÃ¹ng máº«u cÃ¢u rá»“i thay tá»«.</p>
                </div>
            </details>

            <!-- Nav within Card -->
            <div class="flex justify-between items-center mt-6 pt-4 border-t border-slate-100">
                 <button class="clearOne text-xs text-slate-400 hover:text-red-500 flex items-center gap-1" data-q="${q.id}">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    ì§€ìš°ê¸°
                 </button>
                 <button class="makeScriptOne btn-primary px-4 py-2 text-xs rounded-lg shadow-none bg-slate-800 hover:bg-slate-900" data-q="${q.id}">
                    ìŠ¤í¬ë¦½íŠ¸ ì €ì¥
                 </button>
            </div>
        </div>
      `;

      container.appendChild(card);
    });
  }

  // =========================
  // Logic (Keep original core logic)
  // =========================
  const STORAGE_KEY = "speaking_interview_hometown_KO-VI_v2"; // Changed key version
  const SAVE_DELAY_MS = 500;
  let saveTimer = null;

  function setSaveStatus(text, state="ok") {
    const el = $("saveStatus");
    const chip = $("saveChip");
    if(!el || !chip) return;

    el.textContent = text;
    chip.className = "hidden sm:inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold border transition-colors duration-300";
    
    if (state === "saving") {
      chip.classList.add("bg-amber-50", "text-amber-700", "border-amber-200");
    } else if (state === "error") {
      chip.classList.add("bg-red-50", "text-red-700", "border-red-200");
    } else {
      chip.classList.add("bg-emerald-50", "text-emerald-700", "border-emerald-200");
    }
  }

  function scheduleSave() {
    setSaveStatus("ì €ì¥ ì¤‘...", "saving");
    if (saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(() => {
      try {
        const payload = {
          savedAt: Date.now(),
          viHelpOn: localStorage.getItem("viHelpOn_speaking_v2") || "1",
          activeQ: window.__activeQ || 1,
          answers: getAllAnswers(),
          script: $("scriptOut").value || ""
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        setSaveStatus("ì €ì¥ë¨", "ok");
      } catch (e) {
        console.error(e);
        setSaveStatus("ì˜¤ë¥˜", "error");
      }
      saveTimer = null;
    }, SAVE_DELAY_MS);
  }

  function restore() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return false;
      const p = JSON.parse(raw);
      if (p?.answers) {
        Object.keys(p.answers).forEach(k => {
          const el = $(k);
          if (el) el.value = p.answers[k];
        });
      }
      if (p?.script && $("scriptOut")) $("scriptOut").value = p.script;
      if (p?.viHelpOn) localStorage.setItem("viHelpOn_speaking_v2", p.viHelpOn);
      window.__restoreQ = p?.activeQ || 1;
      return true;
    } catch (e) { return false; }
  }

  function getAllAnswers() {
    const ans = {};
    for (let i=1;i<=6;i++) {
      ans[`a${i}`] = $(`a${i}`)?.value || "";
      ans[`k${i}`] = $(`k${i}`)?.value || "";
    }
    return ans;
  }

  // Toast Functionality
  function toast(msg, kind="info") {
    const t = $("toast");
    const box = $("toastBox");
    if (!t || !box) return;
    
    // Style based on kind
    box.className = "pointer-events-auto px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 font-bold text-sm transform transition-all";
    if(kind === "ok") box.classList.add("bg-slate-800", "text-white");
    else if(kind === "warn") box.classList.add("bg-amber-100", "text-amber-800");
    else box.classList.add("bg-white", "text-slate-800", "border", "border-slate-200");

    box.querySelector("span").textContent = msg;
    
    // Show
    t.classList.remove("opacity-0", "translate-y-[-20px]");
    
    // Hide after 2s
    setTimeout(() => {
        t.classList.add("opacity-0", "translate-y-[-20px]");
    }, 2000);
  }

  function toggleVI(on) {
    document.querySelectorAll(".viHelp").forEach(el => el.style.display = on ? "" : "none");
    $("viState").textContent = on ? "ON" : "OFF";
    $("viState").className = on ? "text-xs font-extrabold text-pink-600" : "text-xs font-extrabold text-slate-400";
    localStorage.setItem("viHelpOn_speaking_v2", on ? "1" : "0");
  }

  function buildFullScript() {
    const lines = [];
    for (const q of QUESTIONS) {
      const a = ($(`a${q.id}`)?.value || "").trim();
      lines.push(`Q${q.id}. ${q.title}`);
      lines.push(a ? a : "(ë‹µë³€ì„ ì‘ì„±í•˜ì„¸ìš”)");
      lines.push(""); // spacer
    }
    return lines.join("\n");
  }

  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
      toast("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    } catch (e) {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      toast("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    }
  }

  // =========================
  // Navigation & Highlighting
  // =========================
  function setActiveQ(qNum, scroll=true) {
    window.__activeQ = qNum;

    // 1. Stepper dots
    document.querySelectorAll(".step-dot").forEach(btn => {
      const bQ = parseInt(btn.dataset.q);
      if(bQ === qNum) {
        // Active
        btn.className = "step-dot active w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold bg-indigo-600 text-white shadow-lg shadow-indigo-200 ring-4 ring-white transition-all transform scale-110 z-10";
      } else if (bQ < qNum) {
        // Passed
        btn.className = "step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-indigo-100 text-indigo-600 border-none transition-all";
      } else {
        // Future
        btn.className = "step-dot w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold bg-white border-2 border-slate-200 text-slate-300 transition-all";
      }
    });

    // 2. Bottom Nav
    document.querySelectorAll(".bottomBtn").forEach(btn => {
        const bQ = parseInt(btn.dataset.q);
        if(bQ === qNum) {
            btn.className = "bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center bg-slate-800 text-white shadow-md transform scale-105 transition-all";
        } else {
            btn.className = "bottomBtn w-9 h-9 rounded-lg text-xs font-bold flex items-center justify-center bg-transparent text-slate-400 hover:bg-white hover:text-slate-600 transition-all";
        }
    });

    // 3. Scroll
    if (scroll) {
      const sec = $(`Q${qNum}`);
      if (sec) {
          // Calculate offset for sticky header
          const y = sec.getBoundingClientRect().top + window.pageYOffset - 110; 
          window.scrollTo({top: y, behavior: 'smooth'});
      }
    }
    scheduleSave();
  }

  // =========================
  // Initialization & Event Binding
  // =========================
  renderPanels();
  restore();

  // VI toggle init
  let viOn = localStorage.getItem("viHelpOn_speaking_v2");
  viOn = viOn === null ? true : (viOn === "1");
  toggleVI(viOn);

  $("toggleVI").addEventListener("click", () => {
    viOn = !viOn;
    toggleVI(viOn);
    toast(viOn ? "ë² íŠ¸ë‚¨ì–´ ë„ì›€ë§ ON" : "ë² íŠ¸ë‚¨ì–´ ë„ì›€ë§ OFF", "ok");
  });

  // Global inputs listener for autosave
  document.addEventListener("input", (e) => {
    if(e.target.tagName === "TEXTAREA" || e.target.tagName === "INPUT") {
        scheduleSave();
    }
  });

  // Click Delegations (Better performance)
  document.addEventListener("click", (e) => {
    const target = e.target;
    
    // Jump Buttons (Stepper & Bottom)
    if(target.closest(".step-dot") || target.closest(".bottomBtn")) {
        const btn = target.closest(".step-dot") || target.closest(".bottomBtn");
        setActiveQ(parseInt(btn.dataset.q));
    }

    // Example Insert
    if(target.closest(".exInsert")) {
        const btn = target.closest(".exInsert");
        const area = $(btn.dataset.target);
        if(area) {
            area.value = btn.dataset.text;
            scheduleSave();
            toast("ì˜ˆë¬¸ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”.", "ok");
            area.focus();
        }
    }

    // Keyword to Answer
    if(target.closest(".kwToAns")) {
        const btn = target.closest(".kwToAns");
        const q = btn.dataset.q;
        const kw = $(`k${q}`).value.trim();
        if(!kw) { toast("í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.", "warn"); return; }
        
        const area = $(`a${q}`);
        area.value = (area.value ? area.value + "\n" : "") + `(${kw})`;
        scheduleSave();
        toast("í‚¤ì›Œë“œê°€ ë‹µë³€ì°½ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
    }

    // Clear One
    if(target.closest(".clearOne")) {
        const btn = target.closest(".clearOne");
        if(confirm("ì •ë§ ì´ ë‹µë³€ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const q = btn.dataset.q;
            $(`a${q}`).value = "";
            $(`k${q}`).value = "";
            scheduleSave();
            toast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
        }
    }

    // Make Script One
    if(target.closest(".makeScriptOne")) {
        $("scriptOut").value = buildFullScript();
        scheduleSave();
        toast("ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.", "ok");
        // Optional: scroll to script?
    }
  });

  // Main Nav Buttons
  $("jumpPrev").addEventListener("click", () => setActiveQ(Math.max(1, (window.__activeQ||1)-1)));
  $("jumpNext").addEventListener("click", () => setActiveQ(Math.min(6, (window.__activeQ||1)+1)));
  
  // Script Tools
  $("makeScript").addEventListener("click", () => {
      $("scriptOut").value = buildFullScript();
      toast("ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ", "ok");
  });
  $("copyScript").addEventListener("click", () => copyToClipboard($("scriptOut").value));
  $("clearScript").addEventListener("click", () => {
      if(confirm("ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ? (ë‹µë³€ì€ ìœ ì§€ë©ë‹ˆë‹¤)")) {
        $("scriptOut").value = "";
        scheduleSave();
      }
  });

  // Global Tools
  $("copyAll").addEventListener("click", () => {
     $("scriptOut").value = buildFullScript(); // ensure up to date
     copyToClipboard($("scriptOut").value);
  });
  
  $("downloadTxt").addEventListener("click", () => {
    const text = buildFullScript();
    const blob = new Blob([text], { type:"text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "Speaking_Hometown_Script.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    toast("ë‹¤ìš´ë¡œë“œ ì™„ë£Œ", "ok");
  });

  $("downloadJSON").addEventListener("click", () => {
     const payload = {
          exportedAt: new Date().toISOString(),
          activeQ: window.__activeQ || 1,
          answers: getAllAnswers(),
          script: $("scriptOut").value || ""
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "Speaking_Backup.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    toast("ë°±ì—… íŒŒì¼ ì €ì¥ ì™„ë£Œ", "ok");
  });

  // Focus Mode Logic
  let focusMode = false;
  $("focusMode").addEventListener("click", () => {
    focusMode = !focusMode;
    const container = $("qPanel");
    if(focusMode) {
        container.childNodes.forEach(node => {
            if(node.nodeType === 1) { // element node
                if(node.id !== `Q${window.__activeQ}`) node.style.display = 'none';
            }
        });
        $("focusMode").textContent = "ì „ì²´ ë³´ê¸°";
        $("focusMode").classList.add("text-rose-500");
    } else {
        container.childNodes.forEach(node => {
            if(node.nodeType === 1) node.style.display = '';
        });
        $("focusMode").textContent = "ì§‘ì¤‘ ëª¨ë“œ(í•˜ë‚˜ì”© ë³´ê¸°)";
        $("focusMode").classList.remove("text-rose-500");
        // Re-scroll to active
        setActiveQ(window.__activeQ);
    }
  });

  // Help Modal
  $("openHelp").addEventListener("click", () => $("helpModal").classList.remove("hidden"));
  $("closeHelp").addEventListener("click", () => $("helpModal").classList.add("hidden"));
  $("helpModal").addEventListener("click", (e) => {
      if(e.target.id === "helpModal" || e.target.classList.contains("absolute")) $("helpModal").classList.add("hidden");
  });

  // Reset
  $("resetAll").addEventListener("click", () => {
      if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
          localStorage.removeItem(STORAGE_KEY);
          location.reload();
      }
  });

  // Initial Set
  const startQ = window.__restoreQ || 1;
  setTimeout(() => setActiveQ(startQ, false), 100);

</script>
</body>
</html>

